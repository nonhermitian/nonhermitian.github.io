
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>plotly.basedatatypes &#8212; Kaleidoscope 0.0.10 0.0.10 documentation</title>
    
  <link rel="stylesheet" href="../../_static/css/index.d431a4ee1c1efae0e38bdfebc22debff.css">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/jupyter-sphinx.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.30270b6e4c972e43c488.js">

    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.18.0/dist/embed-amd.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main">
<div class="container-xl">

    
    <a class="navbar-brand" href="../../index.html">
      <img src="../../_static/kal_logo.png" class="logo" alt="logo">
    </a>
    
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-menu" aria-controls="navbar-menu" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar-menu" class="col-lg-9 collapse navbar-collapse">
      <ul id="navbar-main-elements" class="navbar-nav mr-auto">
        
        
        <li class="nav-item ">
            <a class="nav-link" href="../../install.html">Installation</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../../guide/index.html">Guide</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../../tutorials/index.html">Tutorials</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../../api.html">API reference</a>
        </li>
        
        
      </ul>


      

      <ul class="navbar-nav">
        
          <li class="nav-item">
            <a class="nav-link" href="https://github.com/nonhermitian/kaleidoscope" target="_blank" rel="noopener">
              <span><i class="fab fa-github-square"></i></span>
            </a>
          </li>
        
        
      </ul>
    </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
          <div class="col-12 col-md-3 bd-sidebar">

<form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form>


<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">

  <div class="bd-toc-item active">
  

  <ul class="nav bd-sidenav">
      
      
      
      
      
      
      
      
      
    </ul>

</nav>
          </div>
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
              

<nav id="bd-toc-nav">
    <ul class="nav section-nav flex-column">
    
    </ul>
</nav>


              
          </div>
          

          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <h1>Source code for plotly.basedatatypes</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span>

<span class="kn">import</span> <span class="nn">collections</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">OrderedDict</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">six</span>
<span class="kn">from</span> <span class="nn">six</span> <span class="kn">import</span> <span class="n">string_types</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">contextlib</span> <span class="kn">import</span> <span class="n">contextmanager</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span><span class="p">,</span> <span class="n">copy</span>

<span class="kn">from</span> <span class="nn">_plotly_utils.utils</span> <span class="kn">import</span> <span class="n">_natural_sort_strings</span><span class="p">,</span> <span class="n">_get_int_type</span>
<span class="kn">from</span> <span class="nn">.optional_imports</span> <span class="kn">import</span> <span class="n">get_module</span>

<span class="c1"># Create Undefined sentinel value</span>
<span class="c1">#   - Setting a property to None removes any existing value</span>
<span class="c1">#   - Setting a property to Undefined leaves existing value unmodified</span>
<span class="n">Undefined</span> <span class="o">=</span> <span class="nb">object</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">BaseFigure</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for all figure types (both widget and non-widget)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_bracket_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^(.*)\[(\d+)\]$&quot;</span><span class="p">)</span>

    <span class="n">_valid_underscore_properties</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;error_x&quot;</span><span class="p">:</span> <span class="s2">&quot;error-x&quot;</span><span class="p">,</span>
        <span class="s2">&quot;error_y&quot;</span><span class="p">:</span> <span class="s2">&quot;error-y&quot;</span><span class="p">,</span>
        <span class="s2">&quot;error_z&quot;</span><span class="p">:</span> <span class="s2">&quot;error-z&quot;</span><span class="p">,</span>
        <span class="s2">&quot;copy_xstyle&quot;</span><span class="p">:</span> <span class="s2">&quot;copy-xstyle&quot;</span><span class="p">,</span>
        <span class="s2">&quot;copy_ystyle&quot;</span><span class="p">:</span> <span class="s2">&quot;copy-ystyle&quot;</span><span class="p">,</span>
        <span class="s2">&quot;copy_zstyle&quot;</span><span class="p">:</span> <span class="s2">&quot;copy-zstyle&quot;</span><span class="p">,</span>
        <span class="s2">&quot;paper_bgcolor&quot;</span><span class="p">:</span> <span class="s2">&quot;paper-bgcolor&quot;</span><span class="p">,</span>
        <span class="s2">&quot;plot_bgcolor&quot;</span><span class="p">:</span> <span class="s2">&quot;plot-bgcolor&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">_set_trace_uid</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">_allow_disable_validation</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># Constructor</span>
    <span class="c1"># -----------</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">layout_plotly</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">frames</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">skip_invalid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Construct a BaseFigure object</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data</span>
<span class="sd">            One of:</span>
<span class="sd">            - A list or tuple of trace objects (or dicts that can be coerced</span>
<span class="sd">            into trace objects)</span>

<span class="sd">            - If `data` is a dict that contains a &#39;data&#39;,</span>
<span class="sd">            &#39;layout&#39;, or &#39;frames&#39; key then these values are used to</span>
<span class="sd">            construct the figure.</span>

<span class="sd">            - If `data` is a `BaseFigure` instance then the `data`, `layout`,</span>
<span class="sd">            and `frames` properties are extracted from the input figure</span>
<span class="sd">        layout_plotly</span>
<span class="sd">            The plotly layout dict.</span>

<span class="sd">            Note: this property is named `layout_plotly` rather than `layout`</span>
<span class="sd">            to deconflict it with the `layout` constructor parameter of the</span>
<span class="sd">            `widgets.DOMWidget` ipywidgets class, as the `BaseFigureWidget`</span>
<span class="sd">            class is a subclass of both BaseFigure and widgets.DOMWidget.</span>

<span class="sd">            If the `data` property is a BaseFigure instance, or a dict that</span>
<span class="sd">            contains a &#39;layout&#39; key, then this property is ignored.</span>
<span class="sd">        frames</span>
<span class="sd">            A list or tuple of `plotly.graph_objs.Frame` objects (or dicts</span>
<span class="sd">            that can be coerced into Frame objects)</span>

<span class="sd">            If the `data` property is a BaseFigure instance, or a dict that</span>
<span class="sd">            contains a &#39;frames&#39; key, then this property is ignored.</span>

<span class="sd">        skip_invalid: bool</span>
<span class="sd">            If True, invalid properties in the figure specification will be</span>
<span class="sd">            skipped silently. If False (default) invalid properties in the</span>
<span class="sd">            figure specification will result in a ValueError</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            if a property in the specification of data, layout, or frames</span>
<span class="sd">            is invalid AND skip_invalid is False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">.validators</span> <span class="kn">import</span> <span class="n">DataValidator</span><span class="p">,</span> <span class="n">LayoutValidator</span><span class="p">,</span> <span class="n">FramesValidator</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">BaseFigure</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="c1"># Initialize validation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;_validate&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Assign layout_plotly to layout</span>
        <span class="c1"># ------------------------------</span>
        <span class="c1"># See docstring note for explanation</span>
        <span class="n">layout</span> <span class="o">=</span> <span class="n">layout_plotly</span>

        <span class="c1"># Subplot properties</span>
        <span class="c1"># ------------------</span>
        <span class="c1"># These properties are used by the tools.make_subplots logic.</span>
        <span class="c1"># We initialize them to None here, before checking if the input data</span>
        <span class="c1"># object is a BaseFigure, or a dict with _grid_str and _grid_ref</span>
        <span class="c1"># properties, in which case we bring over the _grid* properties of</span>
        <span class="c1"># the input</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_grid_str</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_grid_ref</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Handle case where data is a Figure or Figure-like dict</span>
        <span class="c1"># ------------------------------------------------------</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">BaseFigure</span><span class="p">):</span>
            <span class="c1"># Bring over subplot fields</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_grid_str</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">_grid_str</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_grid_ref</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">_grid_ref</span>

            <span class="c1"># Extract data, layout, and frames</span>
            <span class="n">data</span><span class="p">,</span> <span class="n">layout</span><span class="p">,</span> <span class="n">frames</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">layout</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">frames</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
            <span class="s2">&quot;data&quot;</span> <span class="ow">in</span> <span class="n">data</span> <span class="ow">or</span> <span class="s2">&quot;layout&quot;</span> <span class="ow">in</span> <span class="n">data</span> <span class="ow">or</span> <span class="s2">&quot;frames&quot;</span> <span class="ow">in</span> <span class="n">data</span>
        <span class="p">):</span>

            <span class="c1"># Bring over subplot fields</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_grid_str</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;_grid_str&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_grid_ref</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;_grid_ref&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

            <span class="c1"># Extract data, layout, and frames</span>
            <span class="n">data</span><span class="p">,</span> <span class="n">layout</span><span class="p">,</span> <span class="n">frames</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;layout&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;frames&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="p">)</span>

        <span class="c1"># Handle data (traces)</span>
        <span class="c1"># --------------------</span>
        <span class="c1"># ### Construct data validator ###</span>
        <span class="c1"># This is the validator that handles importing sequences of trace</span>
        <span class="c1"># objects</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data_validator</span> <span class="o">=</span> <span class="n">DataValidator</span><span class="p">(</span><span class="n">set_uid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_set_trace_uid</span><span class="p">)</span>

        <span class="c1"># ### Import traces ###</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_validator</span><span class="o">.</span><span class="n">validate_coerce</span><span class="p">(</span>
            <span class="n">data</span><span class="p">,</span> <span class="n">skip_invalid</span><span class="o">=</span><span class="n">skip_invalid</span><span class="p">,</span> <span class="n">_validate</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_validate</span>
        <span class="p">)</span>

        <span class="c1"># ### Save tuple of trace objects ###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data_objs</span> <span class="o">=</span> <span class="n">data</span>

        <span class="c1"># ### Import clone of trace properties ###</span>
        <span class="c1"># The _data property is a list of dicts containing the properties</span>
        <span class="c1"># explicitly set by the user for each trace.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">trace</span><span class="o">.</span><span class="n">_props</span><span class="p">)</span> <span class="k">for</span> <span class="n">trace</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>

        <span class="c1"># ### Create data defaults ###</span>
        <span class="c1"># _data_defaults is a tuple of dicts, one for each trace. When</span>
        <span class="c1"># running in a widget context, these defaults are populated with</span>
        <span class="c1"># all property values chosen by the Plotly.js library that</span>
        <span class="c1"># aren&#39;t explicitly specified by the user.</span>
        <span class="c1">#</span>
        <span class="c1"># Note: No property should exist in both the _data and</span>
        <span class="c1"># _data_defaults for the same trace.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data_defaults</span> <span class="o">=</span> <span class="p">[{}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>

        <span class="c1"># ### Reparent trace objects ###</span>
        <span class="k">for</span> <span class="n">trace_ind</span><span class="p">,</span> <span class="n">trace</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
            <span class="c1"># By setting the trace&#39;s parent to be this figure, we tell the</span>
            <span class="c1"># trace object to use the figure&#39;s _data and _data_defaults</span>
            <span class="c1"># dicts to get/set it&#39;s properties, rather than using the trace</span>
            <span class="c1"># object&#39;s internal _orphan_props dict.</span>
            <span class="n">trace</span><span class="o">.</span><span class="n">_parent</span> <span class="o">=</span> <span class="bp">self</span>

            <span class="c1"># We clear the orphan props since the trace no longer needs then</span>
            <span class="n">trace</span><span class="o">.</span><span class="n">_orphan_props</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

            <span class="c1"># Set trace index</span>
            <span class="n">trace</span><span class="o">.</span><span class="n">_trace_ind</span> <span class="o">=</span> <span class="n">trace_ind</span>

        <span class="c1"># Layout</span>
        <span class="c1"># ------</span>
        <span class="c1"># ### Construct layout validator ###</span>
        <span class="c1"># This is the validator that handles importing Layout objects</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_layout_validator</span> <span class="o">=</span> <span class="n">LayoutValidator</span><span class="p">()</span>

        <span class="c1"># ### Import Layout ###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_layout_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_layout_validator</span><span class="o">.</span><span class="n">validate_coerce</span><span class="p">(</span>
            <span class="n">layout</span><span class="p">,</span> <span class="n">skip_invalid</span><span class="o">=</span><span class="n">skip_invalid</span><span class="p">,</span> <span class="n">_validate</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_validate</span>
        <span class="p">)</span>

        <span class="c1"># ### Import clone of layout properties ###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_layout</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_layout_obj</span><span class="o">.</span><span class="n">_props</span><span class="p">)</span>

        <span class="c1"># ### Initialize layout defaults dict ###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_layout_defaults</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># ### Reparent layout object ###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_layout_obj</span><span class="o">.</span><span class="n">_orphan_props</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_layout_obj</span><span class="o">.</span><span class="n">_parent</span> <span class="o">=</span> <span class="bp">self</span>

        <span class="c1"># Config</span>
        <span class="c1"># ------</span>
        <span class="c1"># Pass along default config to the front end. For now this just</span>
        <span class="c1"># ensures that the plotly domain url gets passed to the front end.</span>
        <span class="c1"># In the future we can extend this to allow the user to supply</span>
        <span class="c1"># arbitrary config options like in plotly.offline.plot/iplot.  But</span>
        <span class="c1"># this will require a fair amount of testing to determine which</span>
        <span class="c1"># options are compatible with FigureWidget.</span>
        <span class="kn">from</span> <span class="nn">plotly.offline.offline</span> <span class="kn">import</span> <span class="n">_get_jconfig</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_config</span> <span class="o">=</span> <span class="n">_get_jconfig</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

        <span class="c1"># Frames</span>
        <span class="c1"># ------</span>

        <span class="c1"># ### Construct frames validator ###</span>
        <span class="c1"># This is the validator that handles importing sequences of frame</span>
        <span class="c1"># objects</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_frames_validator</span> <span class="o">=</span> <span class="n">FramesValidator</span><span class="p">()</span>

        <span class="c1"># ### Import frames ###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_frame_objs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_frames_validator</span><span class="o">.</span><span class="n">validate_coerce</span><span class="p">(</span>
            <span class="n">frames</span><span class="p">,</span> <span class="n">skip_invalid</span><span class="o">=</span><span class="n">skip_invalid</span>
        <span class="p">)</span>

        <span class="c1"># Note: Because frames are not currently supported in the widget</span>
        <span class="c1"># context, we don&#39;t need to follow the pattern above and create</span>
        <span class="c1"># _frames and _frame_defaults properties and then reparent the</span>
        <span class="c1"># frames. The figure doesn&#39;t need to be notified of</span>
        <span class="c1"># changes to the properties in the frames object hierarchy.</span>

        <span class="c1"># Context manager</span>
        <span class="c1"># ---------------</span>

        <span class="c1"># ### batch mode indicator ###</span>
        <span class="c1"># Flag that indicates whether we&#39;re currently inside a batch_*()</span>
        <span class="c1"># context</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_in_batch_mode</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># ### Batch trace edits ###</span>
        <span class="c1"># Dict from trace indexes to trace edit dicts. These trace edit dicts</span>
        <span class="c1"># are suitable as `data` elements of Plotly.animate, but not</span>
        <span class="c1"># the Plotly.update (See `_build_update_params_from_batch`)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_batch_trace_edits</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>

        <span class="c1"># ### Batch layout edits ###</span>
        <span class="c1"># Dict from layout properties to new layout values. This dict is</span>
        <span class="c1"># directly suitable for use in Plotly.animate and Plotly.update</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_batch_layout_edits</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>

        <span class="c1"># Animation property validators</span>
        <span class="c1"># -----------------------------</span>
        <span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">animation</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_animation_duration_validator</span> <span class="o">=</span> <span class="n">animation</span><span class="o">.</span><span class="n">DurationValidator</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_animation_easing_validator</span> <span class="o">=</span> <span class="n">animation</span><span class="o">.</span><span class="n">EasingValidator</span><span class="p">()</span>

        <span class="c1"># Template</span>
        <span class="c1"># --------</span>
        <span class="c1"># ### Check for default template ###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_layout_template</span><span class="p">()</span>

        <span class="c1"># Process kwargs</span>
        <span class="c1"># --------------</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">skip_invalid</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;invalid Figure property: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>

    <span class="c1"># Magic Methods</span>
    <span class="c1"># -------------</span>
    <span class="k">def</span> <span class="nf">__reduce__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Custom implementation of reduce is used to support deep copying</span>
<span class="sd">        and pickling</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">props</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
        <span class="n">props</span><span class="p">[</span><span class="s2">&quot;_grid_str&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_grid_str</span>
        <span class="n">props</span><span class="p">[</span><span class="s2">&quot;_grid_ref&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_grid_ref</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="p">(</span><span class="n">props</span><span class="p">,))</span>

    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>

        <span class="c1"># Normalize prop</span>
        <span class="c1"># --------------</span>
        <span class="c1"># Convert into a property tuple</span>
        <span class="n">orig_prop</span> <span class="o">=</span> <span class="n">prop</span>
        <span class="n">prop</span> <span class="o">=</span> <span class="n">BaseFigure</span><span class="o">.</span><span class="n">_str_to_dict_path</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>

        <span class="c1"># Handle empty case</span>
        <span class="c1"># -----------------</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">orig_prop</span><span class="p">)</span>

        <span class="c1"># Handle scalar case</span>
        <span class="c1"># ------------------</span>
        <span class="c1"># e.g. (&#39;foo&#39;,)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># ### Unwrap scalar tuple ###</span>
            <span class="n">prop</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">prop</span> <span class="o">==</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">elif</span> <span class="n">prop</span> <span class="o">==</span> <span class="s2">&quot;layout&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">elif</span> <span class="n">prop</span> <span class="o">==</span> <span class="s2">&quot;frames&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">frames</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>

        <span class="c1"># Handle non-scalar case</span>
        <span class="c1"># ----------------------</span>
        <span class="c1"># e.g. (&#39;foo&#39;, 1)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">prop</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="n">p</span><span class="p">]</span>

            <span class="n">res</span><span class="o">.</span><span class="n">_validate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate</span>

            <span class="n">res</span><span class="p">[</span><span class="n">prop</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        prop : str</span>
<span class="sd">            The name of a direct child of this object</span>
<span class="sd">        value</span>
<span class="sd">            New property value</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">prop</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop</span><span class="p">):</span>
            <span class="c1"># Let known properties and private properties through</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">BaseFigure</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">prop</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Raise error on unknown public properties</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop</span><span class="p">):</span>

        <span class="c1"># Normalize prop</span>
        <span class="c1"># --------------</span>
        <span class="c1"># Convert into a property tuple</span>
        <span class="n">orig_prop</span> <span class="o">=</span> <span class="n">prop</span>
        <span class="n">prop</span> <span class="o">=</span> <span class="n">BaseFigure</span><span class="o">.</span><span class="n">_str_to_dict_path</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>

        <span class="c1"># Handle scalar case</span>
        <span class="c1"># ------------------</span>
        <span class="c1"># e.g. (&#39;foo&#39;,)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># Unwrap scalar tuple</span>
            <span class="n">prop</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">prop</span> <span class="o">==</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_validator</span><span class="o">.</span><span class="n">present</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_objs</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">prop</span> <span class="o">==</span> <span class="s2">&quot;layout&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_layout_validator</span><span class="o">.</span><span class="n">present</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_layout_obj</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">prop</span> <span class="o">==</span> <span class="s2">&quot;frames&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_frames_validator</span><span class="o">.</span><span class="n">present</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_frame_objs</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">orig_prop</span><span class="p">)</span>

        <span class="c1"># Handle non-scalar case</span>
        <span class="c1"># ----------------------</span>
        <span class="c1"># e.g. (&#39;foo&#39;, 1)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">prop</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="n">p</span><span class="p">]</span>

            <span class="k">return</span> <span class="n">res</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">((</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;layout&quot;</span><span class="p">,</span> <span class="s2">&quot;frames&quot;</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop</span><span class="p">):</span>
        <span class="n">prop</span> <span class="o">=</span> <span class="n">BaseFigure</span><span class="o">.</span><span class="n">_str_to_dict_path</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">prop</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;layout&quot;</span><span class="p">,</span> <span class="s2">&quot;frames&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">prop</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="n">prop</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">BaseFigure</span><span class="p">):</span>
            <span class="c1"># Require objects to both be BaseFigure instances</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Compare plotly_json representations</span>

            <span class="c1"># Use _vals_equal instead of `==` to handle cases where</span>
            <span class="c1"># underlying dicts contain numpy arrays</span>
            <span class="k">return</span> <span class="n">BasePlotlyType</span><span class="o">.</span><span class="n">_vals_equal</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">to_plotly_json</span><span class="p">(),</span> <span class="n">other</span><span class="o">.</span><span class="n">to_plotly_json</span><span class="p">()</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Customize Figure representation when displayed in the</span>
<span class="sd">        terminal/notebook</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">props</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_plotly_json</span><span class="p">()</span>

        <span class="c1"># Elide template</span>
        <span class="n">template_props</span> <span class="o">=</span> <span class="n">props</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;layout&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;template&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="k">if</span> <span class="n">template_props</span><span class="p">:</span>
            <span class="n">props</span><span class="p">[</span><span class="s2">&quot;layout&quot;</span><span class="p">][</span><span class="s2">&quot;template&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;...&quot;</span>

        <span class="n">repr_str</span> <span class="o">=</span> <span class="n">BasePlotlyType</span><span class="o">.</span><span class="n">_build_repr_for_class</span><span class="p">(</span>
            <span class="n">props</span><span class="o">=</span><span class="n">props</span><span class="p">,</span> <span class="n">class_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">repr_str</span>

    <span class="k">def</span> <span class="nf">_repr_html_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Customize html representation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">bundle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_repr_mimebundle_</span><span class="p">()</span>
        <span class="k">if</span> <span class="s2">&quot;text/html&quot;</span> <span class="ow">in</span> <span class="n">bundle</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">bundle</span><span class="p">[</span><span class="s2">&quot;text/html&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_html</span><span class="p">(</span><span class="n">full_html</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">include_plotlyjs</span><span class="o">=</span><span class="s2">&quot;cdn&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_repr_mimebundle_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">include</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return mimebundle corresponding to default renderer.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">plotly.io</span> <span class="k">as</span> <span class="nn">pio</span>

        <span class="n">renderer_str</span> <span class="o">=</span> <span class="n">pio</span><span class="o">.</span><span class="n">renderers</span><span class="o">.</span><span class="n">default</span>
        <span class="n">renderers</span> <span class="o">=</span> <span class="n">pio</span><span class="o">.</span><span class="n">_renderers</span><span class="o">.</span><span class="n">renderers</span>
        <span class="n">renderer_names</span> <span class="o">=</span> <span class="n">renderers</span><span class="o">.</span><span class="n">_validate_coerce_renderers</span><span class="p">(</span><span class="n">renderer_str</span><span class="p">)</span>
        <span class="n">renderers_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">renderers</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">renderer_names</span><span class="p">]</span>
        <span class="kn">from</span> <span class="nn">plotly.io._utils</span> <span class="kn">import</span> <span class="n">validate_coerce_fig_to_dict</span>
        <span class="kn">from</span> <span class="nn">plotly.io._renderers</span> <span class="kn">import</span> <span class="n">MimetypeRenderer</span>

        <span class="n">fig_dict</span> <span class="o">=</span> <span class="n">validate_coerce_fig_to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">validate</span><span class="p">)</span>
        <span class="c1"># Mimetype renderers</span>
        <span class="n">bundle</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">renderer</span> <span class="ow">in</span> <span class="n">renderers_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">renderer</span><span class="p">,</span> <span class="n">MimetypeRenderer</span><span class="p">):</span>
                <span class="n">bundle</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">renderer</span><span class="o">.</span><span class="n">to_mimebundle</span><span class="p">(</span><span class="n">fig_dict</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">bundle</span>

    <span class="k">def</span> <span class="nf">_ipython_display_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handle rich display of figures in ipython contexts</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">plotly.io</span> <span class="k">as</span> <span class="nn">pio</span>

        <span class="k">if</span> <span class="n">pio</span><span class="o">.</span><span class="n">renderers</span><span class="o">.</span><span class="n">render_on_display</span> <span class="ow">and</span> <span class="n">pio</span><span class="o">.</span><span class="n">renderers</span><span class="o">.</span><span class="n">default</span><span class="p">:</span>
            <span class="n">pio</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dict1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the properties of the figure with a dict and/or with</span>
<span class="sd">        keyword arguments.</span>

<span class="sd">        This recursively updates the structure of the figure</span>
<span class="sd">        object with the values in the input dict / keyword arguments.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dict1 : dict</span>
<span class="sd">            Dictionary of properties to be updated</span>
<span class="sd">        overwrite: bool</span>
<span class="sd">            If True, overwrite existing properties. If False, apply updates</span>
<span class="sd">            to existing properties recursively, preserving existing</span>
<span class="sd">            properties that are not specified in the update operation.</span>
<span class="sd">        kwargs :</span>
<span class="sd">            Keyword/value pair of properties to be updated</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import plotly.graph_objs as go</span>
<span class="sd">        &gt;&gt;&gt; fig = go.Figure(data=[{&#39;y&#39;: [1, 2, 3]}])</span>
<span class="sd">        &gt;&gt;&gt; fig.update(data=[{&#39;y&#39;: [4, 5, 6]}]) # doctest: +ELLIPSIS</span>
<span class="sd">        Figure(...)</span>
<span class="sd">        &gt;&gt;&gt; fig.to_plotly_json() # doctest: +SKIP</span>
<span class="sd">            {&#39;data&#39;: [{&#39;type&#39;: &#39;scatter&#39;,</span>
<span class="sd">               &#39;uid&#39;: &#39;e86a7c7a-346a-11e8-8aa8-a0999b0c017b&#39;,</span>
<span class="sd">               &#39;y&#39;: array([4, 5, 6], dtype=int32)}],</span>
<span class="sd">             &#39;layout&#39;: {}}</span>

<span class="sd">        &gt;&gt;&gt; fig = go.Figure(layout={&#39;xaxis&#39;:</span>
<span class="sd">        ...                         {&#39;color&#39;: &#39;green&#39;,</span>
<span class="sd">        ...                          &#39;range&#39;: [0, 1]}})</span>
<span class="sd">        &gt;&gt;&gt; fig.update({&#39;layout&#39;: {&#39;xaxis&#39;: {&#39;color&#39;: &#39;pink&#39;}}}) # doctest: +ELLIPSIS</span>
<span class="sd">        Figure(...)</span>
<span class="sd">        &gt;&gt;&gt; fig.to_plotly_json() # doctest: +SKIP</span>
<span class="sd">            {&#39;data&#39;: [],</span>
<span class="sd">             &#39;layout&#39;: {&#39;xaxis&#39;:</span>
<span class="sd">                        {&#39;color&#39;: &#39;pink&#39;,</span>
<span class="sd">                         &#39;range&#39;: [0, 1]}}}</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        BaseFigure</span>
<span class="sd">            Updated figure</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_update</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="p">[</span><span class="n">dict1</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">d</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="n">update_target</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">update_target</span> <span class="o">==</span> <span class="p">()</span> <span class="ow">or</span> <span class="n">overwrite</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span>
                                <span class="c1"># Overwrite all traces as special due to</span>
                                <span class="c1"># restrictions on trace assignment</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">()</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">add_traces</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="c1"># Accept v</span>
                                <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
                        <span class="k">elif</span> <span class="p">(</span>
                            <span class="nb">isinstance</span><span class="p">(</span><span class="n">update_target</span><span class="p">,</span> <span class="n">BasePlotlyType</span><span class="p">)</span>
                            <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="n">BasePlotlyType</span><span class="p">))</span>
                        <span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
                            <span class="nb">isinstance</span><span class="p">(</span><span class="n">update_target</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span>
                            <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">update_target</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">BasePlotlyType</span><span class="p">)</span>
                        <span class="p">):</span>
                            <span class="n">BaseFigure</span><span class="o">.</span><span class="n">_perform_update</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">v</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">pop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove the value associated with the specified key and return it</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        key: str</span>
<span class="sd">            Property name</span>
<span class="sd">        dflt</span>
<span class="sd">            The default value to return if key was not found in figure</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        value</span>
<span class="sd">            The removed value that was previously associated with key</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        KeyError</span>
<span class="sd">            If key is not in object and no dflt argument specified</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Handle default</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span> <span class="ow">and</span> <span class="n">args</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">return</span> <span class="n">val</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

    <span class="c1"># Data</span>
    <span class="c1"># ----</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The `data` property is a tuple of the figure&#39;s trace objects</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tuple[BaseTraceType]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span>

    <span class="nd">@data</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_data</span><span class="p">):</span>

        <span class="c1"># Validate new_data</span>
        <span class="c1"># -----------------</span>
        <span class="n">err_header</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;The data property of a figure may only be assigned </span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;a list or tuple that contains a permutation of a &quot;</span>
            <span class="s2">&quot;subset of itself.</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="p">)</span>

        <span class="c1"># ### Treat None as empty ###</span>
        <span class="k">if</span> <span class="n">new_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">new_data</span> <span class="o">=</span> <span class="p">()</span>

        <span class="c1"># ### Check valid input type ###</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_data</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="n">err_msg</span> <span class="o">=</span> <span class="n">err_header</span> <span class="o">+</span> <span class="s2">&quot;    Received value with type </span><span class="si">{typ}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">typ</span><span class="o">=</span><span class="nb">type</span><span class="p">(</span><span class="n">new_data</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>

        <span class="c1"># ### Check valid element types ###</span>
        <span class="k">for</span> <span class="n">trace</span> <span class="ow">in</span> <span class="n">new_data</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">BaseTraceType</span><span class="p">):</span>
                <span class="n">err_msg</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">err_header</span>
                    <span class="o">+</span> <span class="s2">&quot;    Received element value of type </span><span class="si">{typ}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">typ</span><span class="o">=</span><span class="nb">type</span><span class="p">(</span><span class="n">trace</span><span class="p">))</span>
                <span class="p">)</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>

        <span class="c1"># ### Check trace objects ###</span>
        <span class="c1"># Require that no new traces are introduced</span>
        <span class="n">orig_uids</span> <span class="o">=</span> <span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span> <span class="k">for</span> <span class="n">trace</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">]</span>
        <span class="n">new_uids</span> <span class="o">=</span> <span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span> <span class="k">for</span> <span class="n">trace</span> <span class="ow">in</span> <span class="n">new_data</span><span class="p">]</span>

        <span class="n">invalid_uids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">new_uids</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">orig_uids</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">invalid_uids</span><span class="p">:</span>
            <span class="n">err_msg</span> <span class="o">=</span> <span class="n">err_header</span>

            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>

        <span class="c1"># ### Check for duplicates in assignment ###</span>
        <span class="n">uid_counter</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">Counter</span><span class="p">(</span><span class="n">new_uids</span><span class="p">)</span>
        <span class="n">duplicate_uids</span> <span class="o">=</span> <span class="p">[</span><span class="n">uid</span> <span class="k">for</span> <span class="n">uid</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">uid_counter</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">duplicate_uids</span><span class="p">:</span>
            <span class="n">err_msg</span> <span class="o">=</span> <span class="n">err_header</span> <span class="o">+</span> <span class="s2">&quot;    Received duplicated traces&quot;</span>

            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>

        <span class="c1"># Remove traces</span>
        <span class="c1"># -------------</span>
        <span class="n">remove_uids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">orig_uids</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">new_uids</span><span class="p">))</span>
        <span class="n">delete_inds</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># ### Unparent removed traces ###</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">trace</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">id</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span> <span class="ow">in</span> <span class="n">remove_uids</span><span class="p">:</span>
                <span class="n">delete_inds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

                <span class="c1"># Unparent trace object to be removed</span>
                <span class="n">old_trace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">old_trace</span><span class="o">.</span><span class="n">_orphan_props</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">old_trace</span><span class="o">.</span><span class="n">_props</span><span class="p">))</span>
                <span class="n">old_trace</span><span class="o">.</span><span class="n">_parent</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">old_trace</span><span class="o">.</span><span class="n">_trace_ind</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># ### Compute trace props / defaults after removal ###</span>
        <span class="n">traces_props_post_removal</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">]</span>
        <span class="n">traces_prop_defaults_post_removal</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_defaults</span><span class="p">]</span>
        <span class="n">uids_post_removal</span> <span class="o">=</span> <span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">trace_data</span><span class="p">)</span> <span class="k">for</span> <span class="n">trace_data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">delete_inds</span><span class="p">):</span>
            <span class="k">del</span> <span class="n">traces_props_post_removal</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">del</span> <span class="n">traces_prop_defaults_post_removal</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">del</span> <span class="n">uids_post_removal</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

            <span class="c1"># Modify in-place so we don&#39;t trigger serialization</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">delete_inds</span><span class="p">:</span>
            <span class="c1"># Update widget, if any</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_send_deleteTraces_msg</span><span class="p">(</span><span class="n">delete_inds</span><span class="p">)</span>

        <span class="c1"># Move traces</span>
        <span class="c1"># -----------</span>

        <span class="c1"># ### Compute new index for each remaining trace ###</span>
        <span class="n">new_inds</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">uid</span> <span class="ow">in</span> <span class="n">uids_post_removal</span><span class="p">:</span>
            <span class="n">new_inds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_uids</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">uid</span><span class="p">))</span>

        <span class="c1"># ### Compute current index for each remaining trace ###</span>
        <span class="n">current_inds</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">traces_props_post_removal</span><span class="p">)))</span>

        <span class="c1"># ### Check whether a move is needed ###</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="n">i1</span> <span class="o">==</span> <span class="n">i2</span> <span class="k">for</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">new_inds</span><span class="p">,</span> <span class="n">current_inds</span><span class="p">)]):</span>

            <span class="c1"># #### Save off index lists for moveTraces message ####</span>
            <span class="n">msg_current_inds</span> <span class="o">=</span> <span class="n">current_inds</span>
            <span class="n">msg_new_inds</span> <span class="o">=</span> <span class="n">new_inds</span>

            <span class="c1"># #### Reorder trace elements ####</span>
            <span class="c1"># We do so in-place so we don&#39;t trigger traitlet property</span>
            <span class="c1"># serialization for the FigureWidget case</span>
            <span class="c1"># ##### Remove by curr_inds in reverse order #####</span>
            <span class="n">moving_traces_data</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">ci</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">current_inds</span><span class="p">):</span>
                <span class="c1"># Push moving traces data to front of list</span>
                <span class="n">moving_traces_data</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">ci</span><span class="p">])</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">ci</span><span class="p">]</span>

            <span class="c1"># #### Sort new_inds and moving_traces_data by new_inds ####</span>
            <span class="n">new_inds</span><span class="p">,</span> <span class="n">moving_traces_data</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span>
                <span class="o">*</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">new_inds</span><span class="p">,</span> <span class="n">moving_traces_data</span><span class="p">))</span>
            <span class="p">)</span>

            <span class="c1"># #### Insert by new_inds in forward order ####</span>
            <span class="k">for</span> <span class="n">ni</span><span class="p">,</span> <span class="n">trace_data</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">new_inds</span><span class="p">,</span> <span class="n">moving_traces_data</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">ni</span><span class="p">,</span> <span class="n">trace_data</span><span class="p">)</span>

            <span class="c1"># #### Update widget, if any ####</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_send_moveTraces_msg</span><span class="p">(</span><span class="n">msg_current_inds</span><span class="p">,</span> <span class="n">msg_new_inds</span><span class="p">)</span>

        <span class="c1"># ### Update data defaults ###</span>
        <span class="c1"># There is to front-end syncronization to worry about so this</span>
        <span class="c1"># operations doesn&#39;t need to be in-place</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data_defaults</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">_trace</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_trace</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">new_inds</span><span class="p">,</span> <span class="n">traces_prop_defaults_post_removal</span><span class="p">))</span>
        <span class="p">]</span>

        <span class="c1"># Update trace objects tuple</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data_objs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">new_data</span><span class="p">)</span>

        <span class="c1"># Update trace indexes</span>
        <span class="k">for</span> <span class="n">trace_ind</span><span class="p">,</span> <span class="n">trace</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_objs</span><span class="p">):</span>
            <span class="n">trace</span><span class="o">.</span><span class="n">_trace_ind</span> <span class="o">=</span> <span class="n">trace_ind</span>

    <span class="k">def</span> <span class="nf">select_traces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selector</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">secondary_y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Select traces from a particular subplot cell and/or traces</span>
<span class="sd">        that satisfy custom selection criteria.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        selector: dict or None (default None)</span>
<span class="sd">            Dict to use as selection criteria.</span>
<span class="sd">            Traces will be selected if they contain properties corresponding</span>
<span class="sd">            to all of the dictionary&#39;s keys, with values that exactly match</span>
<span class="sd">            the supplied values. If None (the default), all traces are</span>
<span class="sd">            selected.</span>
<span class="sd">        row, col: int or None (default None)</span>
<span class="sd">            Subplot row and column index of traces to select.</span>
<span class="sd">            To select traces by row and column, the Figure must have been</span>
<span class="sd">            created using plotly.subplots.make_subplots.  If None</span>
<span class="sd">            (the default), all traces are selected.</span>
<span class="sd">        secondary_y: boolean or None (default None)</span>
<span class="sd">            * If True, only select traces associated with the secondary</span>
<span class="sd">              y-axis of the subplot.</span>
<span class="sd">            * If False, only select traces associated with the primary</span>
<span class="sd">              y-axis of the subplot.</span>
<span class="sd">            * If None (the default), do not filter traces based on secondary</span>
<span class="sd">              y-axis.</span>

<span class="sd">            To select traces by secondary y-axis, the Figure must have been</span>
<span class="sd">            created using plotly.subplots.make_subplots. See the docstring</span>
<span class="sd">            for the specs argument to make_subplots for more info on</span>
<span class="sd">            creating subplots with secondary y-axes.</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        generator</span>
<span class="sd">            Generator that iterates through all of the traces that satisfy</span>
<span class="sd">            all of the specified selection criteria</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">selector</span><span class="p">:</span>
            <span class="n">selector</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">col</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">secondary_y</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">grid_ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_get_grid_ref</span><span class="p">()</span>
            <span class="n">filter_by_subplot</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">col</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># All rows for column</span>
                <span class="n">grid_subplot_ref_tuples</span> <span class="o">=</span> <span class="p">[</span><span class="n">ref_row</span><span class="p">[</span><span class="n">col</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">ref_row</span> <span class="ow">in</span> <span class="n">grid_ref</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">col</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">row</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># All columns for row</span>
                <span class="n">grid_subplot_ref_tuples</span> <span class="o">=</span> <span class="n">grid_ref</span><span class="p">[</span><span class="n">row</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">col</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">row</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># Single grid cell</span>
                <span class="n">grid_subplot_ref_tuples</span> <span class="o">=</span> <span class="p">[</span><span class="n">grid_ref</span><span class="p">[</span><span class="n">row</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="n">col</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># row and col are None, secondary_y not None</span>
                <span class="n">grid_subplot_ref_tuples</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">refs</span> <span class="k">for</span> <span class="n">refs_row</span> <span class="ow">in</span> <span class="n">grid_ref</span> <span class="k">for</span> <span class="n">refs</span> <span class="ow">in</span> <span class="n">refs_row</span>
                <span class="p">]</span>

            <span class="c1"># Collect list of subplot refs, taking secondary_y into account</span>
            <span class="n">grid_subplot_refs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">refs</span> <span class="ow">in</span> <span class="n">grid_subplot_ref_tuples</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">refs</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">secondary_y</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">grid_subplot_refs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">refs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

                <span class="k">if</span> <span class="n">secondary_y</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">refs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">grid_subplot_refs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">refs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">filter_by_subplot</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">grid_subplot_refs</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_perform_select_traces</span><span class="p">(</span>
            <span class="n">filter_by_subplot</span><span class="p">,</span> <span class="n">grid_subplot_refs</span><span class="p">,</span> <span class="n">selector</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_perform_select_traces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filter_by_subplot</span><span class="p">,</span> <span class="n">grid_subplot_refs</span><span class="p">,</span> <span class="n">selector</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">plotly.subplots</span> <span class="kn">import</span> <span class="n">_get_subplot_ref_for_trace</span>

        <span class="k">for</span> <span class="n">trace</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="c1"># Filter by subplot</span>
            <span class="k">if</span> <span class="n">filter_by_subplot</span><span class="p">:</span>
                <span class="n">trace_subplot_ref</span> <span class="o">=</span> <span class="n">_get_subplot_ref_for_trace</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">trace_subplot_ref</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">grid_subplot_refs</span><span class="p">:</span>
                    <span class="k">continue</span>

            <span class="c1"># Filter by selector</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selector_matches</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">selector</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="k">yield</span> <span class="n">trace</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_selector_matches</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">selector</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">selector</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">selector</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>

            <span class="n">obj_val</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">selector_val</span> <span class="o">=</span> <span class="n">selector</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj_val</span><span class="p">,</span> <span class="n">BasePlotlyType</span><span class="p">):</span>
                <span class="n">obj_val</span> <span class="o">=</span> <span class="n">obj_val</span><span class="o">.</span><span class="n">to_plotly_json</span><span class="p">()</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">selector_val</span><span class="p">,</span> <span class="n">BasePlotlyType</span><span class="p">):</span>
                <span class="n">selector_val</span> <span class="o">=</span> <span class="n">selector_val</span><span class="o">.</span><span class="n">to_plotly_json</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">obj_val</span> <span class="o">!=</span> <span class="n">selector_val</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">for_each_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">selector</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">secondary_y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Apply a function to all traces that satisfy the specified selection</span>
<span class="sd">        criteria</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        fn:</span>
<span class="sd">            Function that inputs a single trace object.</span>
<span class="sd">        selector: dict or None (default None)</span>
<span class="sd">            Dict to use as selection criteria.</span>
<span class="sd">            Traces will be selected if they contain properties corresponding</span>
<span class="sd">            to all of the dictionary&#39;s keys, with values that exactly match</span>
<span class="sd">            the supplied values. If None (the default), all traces are</span>
<span class="sd">            selected.</span>
<span class="sd">        row, col: int or None (default None)</span>
<span class="sd">            Subplot row and column index of traces to select.</span>
<span class="sd">            To select traces by row and column, the Figure must have been</span>
<span class="sd">            created using plotly.subplots.make_subplots.  If None</span>
<span class="sd">            (the default), all traces are selected.</span>
<span class="sd">        secondary_y: boolean or None (default None)</span>
<span class="sd">            * If True, only select traces associated with the secondary</span>
<span class="sd">              y-axis of the subplot.</span>
<span class="sd">            * If False, only select traces associated with the primary</span>
<span class="sd">              y-axis of the subplot.</span>
<span class="sd">            * If None (the default), do not filter traces based on secondary</span>
<span class="sd">              y-axis.</span>

<span class="sd">            To select traces by secondary y-axis, the Figure must have been</span>
<span class="sd">            created using plotly.subplots.make_subplots. See the docstring</span>
<span class="sd">            for the specs argument to make_subplots for more info on</span>
<span class="sd">            creating subplots with secondary y-axes.</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        self</span>
<span class="sd">            Returns the Figure object that the method was called on</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">trace</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_traces</span><span class="p">(</span>
            <span class="n">selector</span><span class="o">=</span><span class="n">selector</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">,</span> <span class="n">secondary_y</span><span class="o">=</span><span class="n">secondary_y</span>
        <span class="p">):</span>
            <span class="n">fn</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">update_traces</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">patch</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">selector</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">row</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">col</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">secondary_y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Perform a property update operation on all traces that satisfy the</span>
<span class="sd">        specified selection criteria</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        patch: dict or None (default None)</span>
<span class="sd">            Dictionary of property updates to be applied to all traces that</span>
<span class="sd">            satisfy the selection criteria.</span>
<span class="sd">        selector: dict or None (default None)</span>
<span class="sd">            Dict to use as selection criteria.</span>
<span class="sd">            Traces will be selected if they contain properties corresponding</span>
<span class="sd">            to all of the dictionary&#39;s keys, with values that exactly match</span>
<span class="sd">            the supplied values. If None (the default), all traces are</span>
<span class="sd">            selected.</span>
<span class="sd">        row, col: int or None (default None)</span>
<span class="sd">            Subplot row and column index of traces to select.</span>
<span class="sd">            To select traces by row and column, the Figure must have been</span>
<span class="sd">            created using plotly.subplots.make_subplots.  If None</span>
<span class="sd">            (the default), all traces are selected.</span>
<span class="sd">        secondary_y: boolean or None (default None)</span>
<span class="sd">            * If True, only select traces associated with the secondary</span>
<span class="sd">              y-axis of the subplot.</span>
<span class="sd">            * If False, only select traces associated with the primary</span>
<span class="sd">              y-axis of the subplot.</span>
<span class="sd">            * If None (the default), do not filter traces based on secondary</span>
<span class="sd">              y-axis.</span>

<span class="sd">            To select traces by secondary y-axis, the Figure must have been</span>
<span class="sd">            created using plotly.subplots.make_subplots. See the docstring</span>
<span class="sd">            for the specs argument to make_subplots for more info on</span>
<span class="sd">            creating subplots with secondary y-axes.</span>
<span class="sd">        overwrite: bool</span>
<span class="sd">            If True, overwrite existing properties. If False, apply updates</span>
<span class="sd">            to existing properties recursively, preserving existing</span>
<span class="sd">            properties that are not specified in the update operation.</span>
<span class="sd">        **kwargs</span>
<span class="sd">            Additional property updates to apply to each selected trace. If</span>
<span class="sd">            a property is specified in both patch and in **kwargs then the</span>
<span class="sd">            one in **kwargs takes precedence.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        self</span>
<span class="sd">            Returns the Figure object that the method was called on</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">trace</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_traces</span><span class="p">(</span>
            <span class="n">selector</span><span class="o">=</span><span class="n">selector</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">,</span> <span class="n">secondary_y</span><span class="o">=</span><span class="n">secondary_y</span>
        <span class="p">):</span>
            <span class="n">trace</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">patch</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">update_layout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dict1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the properties of the figure&#39;s layout with a dict and/or with</span>
<span class="sd">        keyword arguments.</span>

<span class="sd">        This recursively updates the structure of the original</span>
<span class="sd">        layout with the values in the input dict / keyword arguments.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dict1 : dict</span>
<span class="sd">            Dictionary of properties to be updated</span>
<span class="sd">        overwrite: bool</span>
<span class="sd">            If True, overwrite existing properties. If False, apply updates</span>
<span class="sd">            to existing properties recursively, preserving existing</span>
<span class="sd">            properties that are not specified in the update operation.</span>
<span class="sd">        kwargs :</span>
<span class="sd">            Keyword/value pair of properties to be updated</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        BaseFigure</span>
<span class="sd">            The Figure object that the update_layout method was called on</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">dict1</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">_select_layout_subplots_by_prefix</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">selector</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">secondary_y</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helper called by code generated select_* methods</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">col</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">secondary_y</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Build mapping from container keys (&#39;xaxis2&#39;, &#39;scene4&#39;, etc.)</span>
            <span class="c1"># to (row, col, secondary_y) triplets</span>
            <span class="n">grid_ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_get_grid_ref</span><span class="p">()</span>
            <span class="n">container_to_row_col</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">r</span><span class="p">,</span> <span class="n">subplot_row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">grid_ref</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">subplot_refs</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">subplot_row</span><span class="p">):</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">subplot_refs</span><span class="p">:</span>
                        <span class="k">continue</span>

                    <span class="c1"># collect primary keys</span>
                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">subplot_ref</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">subplot_refs</span><span class="p">):</span>
                        <span class="k">for</span> <span class="n">layout_key</span> <span class="ow">in</span> <span class="n">subplot_ref</span><span class="o">.</span><span class="n">layout_keys</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">layout_key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">prefix</span><span class="p">):</span>
                                <span class="n">is_secondary_y</span> <span class="o">=</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span>
                                <span class="n">container_to_row_col</span><span class="p">[</span><span class="n">layout_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                                    <span class="n">r</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                                    <span class="n">c</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                                    <span class="n">is_secondary_y</span><span class="p">,</span>
                                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">container_to_row_col</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Natural sort keys so that xaxis20 is after xaxis3</span>
        <span class="n">layout_keys</span> <span class="o">=</span> <span class="n">_natural_sort_strings</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">layout_keys</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

                <span class="c1"># Filter by row/col</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">row</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                    <span class="ow">and</span> <span class="n">container_to_row_col</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">row</span>
                <span class="p">):</span>
                    <span class="c1"># row specified and this is not a match</span>
                    <span class="k">continue</span>
                <span class="k">elif</span> <span class="p">(</span>
                    <span class="n">col</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                    <span class="ow">and</span> <span class="n">container_to_row_col</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">))[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">col</span>
                <span class="p">):</span>
                    <span class="c1"># col specified and this is not a match</span>
                    <span class="k">continue</span>
                <span class="k">elif</span> <span class="p">(</span>
                    <span class="n">secondary_y</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                    <span class="ow">and</span> <span class="n">container_to_row_col</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">))[</span><span class="mi">2</span><span class="p">]</span>
                    <span class="o">!=</span> <span class="n">secondary_y</span>
                <span class="p">):</span>
                    <span class="k">continue</span>

                <span class="c1"># Filter by selector</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selector_matches</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">selector</span><span class="p">):</span>
                    <span class="k">continue</span>

                <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_select_annotations_like</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">selector</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">secondary_y</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helper to select annotation-like elements from a layout object array.</span>
<span class="sd">        Compatible with layout.annotations, layout.shapes, and layout.images</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">xref_to_col</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">yref_to_row</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">yref_to_secondary_y</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="n">secondary_y</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">grid_ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_get_grid_ref</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">r</span><span class="p">,</span> <span class="n">subplot_row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">grid_ref</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">subplot_refs</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">subplot_row</span><span class="p">):</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">subplot_refs</span><span class="p">:</span>
                        <span class="k">continue</span>

                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">subplot_ref</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">subplot_refs</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">subplot_ref</span><span class="o">.</span><span class="n">subplot_type</span> <span class="o">==</span> <span class="s2">&quot;xy&quot;</span><span class="p">:</span>
                            <span class="n">is_secondary_y</span> <span class="o">=</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span>
                            <span class="n">xaxis</span><span class="p">,</span> <span class="n">yaxis</span> <span class="o">=</span> <span class="n">subplot_ref</span><span class="o">.</span><span class="n">layout_keys</span>
                            <span class="n">xref</span> <span class="o">=</span> <span class="n">xaxis</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;axis&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                            <span class="n">yref</span> <span class="o">=</span> <span class="n">yaxis</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;axis&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                            <span class="n">xref_to_col</span><span class="p">[</span><span class="n">xref</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span> <span class="o">+</span> <span class="mi">1</span>
                            <span class="n">yref_to_row</span><span class="p">[</span><span class="n">yref</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span> <span class="o">+</span> <span class="mi">1</span>
                            <span class="n">yref_to_secondary_y</span><span class="p">[</span><span class="n">yref</span><span class="p">]</span> <span class="o">=</span> <span class="n">is_secondary_y</span>

        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="n">prop</span><span class="p">]:</span>
            <span class="c1"># Filter by row</span>
            <span class="k">if</span> <span class="n">col</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">xref_to_col</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">xref</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="o">!=</span> <span class="n">col</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c1"># Filter by col</span>
            <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">yref_to_row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">yref</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="o">!=</span> <span class="n">row</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c1"># Filter by secondary y</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">secondary_y</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="ow">and</span> <span class="n">yref_to_secondary_y</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">yref</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="o">!=</span> <span class="n">secondary_y</span>
            <span class="p">):</span>
                <span class="k">continue</span>

            <span class="c1"># Filter by selector</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selector_matches</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">selector</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="k">yield</span> <span class="n">obj</span>

    <span class="k">def</span> <span class="nf">_add_annotation_like</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">prop_singular</span><span class="p">,</span> <span class="n">prop_plural</span><span class="p">,</span> <span class="n">new_obj</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">secondary_y</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
        <span class="c1"># Make sure we have both row and col or neither</span>
        <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">col</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Received row parameter but not col.</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;row and col must be specified together&quot;</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">col</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">row</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Received col parameter but not row.</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;row and col must be specified together&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Get grid_ref if specific row or column requested</span>
        <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">grid_ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_get_grid_ref</span><span class="p">()</span>
            <span class="n">refs</span> <span class="o">=</span> <span class="n">grid_ref</span><span class="p">[</span><span class="n">row</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="n">col</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">refs</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;No subplot found at position (</span><span class="si">{r}</span><span class="s2">, </span><span class="si">{c}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">r</span><span class="o">=</span><span class="n">row</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="n">refs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">subplot_type</span> <span class="o">!=</span> <span class="s2">&quot;xy&quot;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Cannot add {prop_singular} to subplot at position ({r}, {c}) because subplot</span>
<span class="sd">is of type {subplot_type}.&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">prop_singular</span><span class="o">=</span><span class="n">prop_singular</span><span class="p">,</span>
                        <span class="n">r</span><span class="o">=</span><span class="n">row</span><span class="p">,</span>
                        <span class="n">c</span><span class="o">=</span><span class="n">col</span><span class="p">,</span>
                        <span class="n">subplot_type</span><span class="o">=</span><span class="n">refs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">subplot_type</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">refs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">secondary_y</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Cannot add {prop_singular} to secondary y-axis of subplot at position ({r}, {c})</span>
<span class="sd">because subplot does not have a secondary y-axis&quot;&quot;&quot;</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">secondary_y</span><span class="p">:</span>
                <span class="n">xaxis</span><span class="p">,</span> <span class="n">yaxis</span> <span class="o">=</span> <span class="n">refs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">layout_keys</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">xaxis</span><span class="p">,</span> <span class="n">yaxis</span> <span class="o">=</span> <span class="n">refs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">layout_keys</span>
            <span class="n">xref</span><span class="p">,</span> <span class="n">yref</span> <span class="o">=</span> <span class="n">xaxis</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;axis&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span> <span class="n">yaxis</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;axis&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">new_obj</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">xref</span><span class="o">=</span><span class="n">xref</span><span class="p">,</span> <span class="n">yref</span><span class="o">=</span><span class="n">yref</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="n">prop_plural</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="n">new_obj</span><span class="p">,)</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="c1"># Restyle</span>
    <span class="c1"># -------</span>
    <span class="k">def</span> <span class="nf">plotly_restyle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">restyle_data</span><span class="p">,</span> <span class="n">trace_indexes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Perform a Plotly restyle operation on the figure&#39;s traces</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        restyle_data : dict</span>
<span class="sd">            Dict of trace style updates.</span>

<span class="sd">            Keys are strings that specify the properties to be updated.</span>
<span class="sd">            Nested properties are expressed by joining successive keys on</span>
<span class="sd">            &#39;.&#39; characters (e.g. &#39;marker.color&#39;).</span>

<span class="sd">            Values may be scalars or lists. When values are scalars,</span>
<span class="sd">            that scalar value is applied to all traces specified by the</span>
<span class="sd">            `trace_indexes` parameter.  When values are lists,</span>
<span class="sd">            the restyle operation will cycle through the elements</span>
<span class="sd">            of the list as it cycles through the traces specified by the</span>
<span class="sd">            `trace_indexes` parameter.</span>

<span class="sd">            Caution: To use plotly_restyle to update a list property (e.g.</span>
<span class="sd">            the `x` property of the scatter trace), the property value</span>
<span class="sd">            should be a scalar list containing the list to update with. For</span>
<span class="sd">            example, the following command would be used to update the &#39;x&#39;</span>
<span class="sd">            property of the first trace to the list [1, 2, 3]</span>

<span class="sd">            &gt;&gt;&gt; import plotly.graph_objects as go</span>
<span class="sd">            &gt;&gt;&gt; fig = go.Figure(go.Scatter(x=[2, 4, 6]))</span>
<span class="sd">            &gt;&gt;&gt; fig.plotly_restyle({&#39;x&#39;: [[1, 2, 3]]}, 0)</span>

<span class="sd">        trace_indexes : int or list of int</span>
<span class="sd">            Trace index, or list of trace indexes, that the restyle operation</span>
<span class="sd">            applies to. Defaults to all trace indexes.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Normalize trace indexes</span>
        <span class="c1"># -----------------------</span>
        <span class="n">trace_indexes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalize_trace_indexes</span><span class="p">(</span><span class="n">trace_indexes</span><span class="p">)</span>

        <span class="c1"># Handle source_view_id</span>
        <span class="c1"># ---------------------</span>
        <span class="c1"># If not None, the source_view_id is the UID of the frontend</span>
        <span class="c1"># Plotly.js view that initially triggered this restyle operation</span>
        <span class="c1"># (e.g. the user clicked on the legend to hide a trace). We pass</span>
        <span class="c1"># this UID along so that the frontend views can determine whether</span>
        <span class="c1"># they need to apply the restyle operation on themselves.</span>
        <span class="n">source_view_id</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_view_id&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="c1"># Perform restyle on trace dicts</span>
        <span class="c1"># ------------------------------</span>
        <span class="n">restyle_changes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_perform_plotly_restyle</span><span class="p">(</span><span class="n">restyle_data</span><span class="p">,</span> <span class="n">trace_indexes</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">restyle_changes</span><span class="p">:</span>
            <span class="c1"># The restyle operation resulted in a change to some trace</span>
            <span class="c1"># properties, so we dispatch change callbacks and send the</span>
            <span class="c1"># restyle message to the frontend (if any)</span>
            <span class="n">msg_kwargs</span> <span class="o">=</span> <span class="p">(</span>
                <span class="p">{</span><span class="s2">&quot;source_view_id&quot;</span><span class="p">:</span> <span class="n">source_view_id</span><span class="p">}</span> <span class="k">if</span> <span class="n">source_view_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">{}</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_send_restyle_msg</span><span class="p">(</span>
                <span class="n">restyle_changes</span><span class="p">,</span> <span class="n">trace_indexes</span><span class="o">=</span><span class="n">trace_indexes</span><span class="p">,</span> <span class="o">**</span><span class="n">msg_kwargs</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_dispatch_trace_change_callbacks</span><span class="p">(</span><span class="n">restyle_changes</span><span class="p">,</span> <span class="n">trace_indexes</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_perform_plotly_restyle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">restyle_data</span><span class="p">,</span> <span class="n">trace_indexes</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Perform a restyle operation on the figure&#39;s traces data and return</span>
<span class="sd">        the changes that were applied</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        restyle_data : dict[str, any]</span>
<span class="sd">            See docstring for plotly_restyle</span>
<span class="sd">        trace_indexes : list[int]</span>
<span class="sd">            List of trace indexes that restyle operation applies to</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        restyle_changes: dict[str, any]</span>
<span class="sd">            Subset of restyle_data including only the keys / values that</span>
<span class="sd">            resulted in a change to the figure&#39;s traces data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Initialize restyle changes</span>
        <span class="c1"># --------------------------</span>
        <span class="c1"># This will be a subset of the restyle_data including only the</span>
        <span class="c1"># keys / values that are changed in the figure&#39;s trace data</span>
        <span class="n">restyle_changes</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Process each key</span>
        <span class="c1"># ----------------</span>
        <span class="k">for</span> <span class="n">key_path_str</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">restyle_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

            <span class="c1"># Track whether any of the new values are cause a change in</span>
            <span class="c1"># self._data</span>
            <span class="n">any_vals_changed</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">trace_ind</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">trace_indexes</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">trace_ind</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s2">&quot;Trace index </span><span class="si">{trace_ind}</span><span class="s2"> out of range&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">trace_ind</span><span class="o">=</span><span class="n">trace_ind</span>
                        <span class="p">)</span>
                    <span class="p">)</span>

                <span class="c1"># Get new value for this particular trace</span>
                <span class="n">trace_v</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="n">v</span>

                <span class="k">if</span> <span class="n">trace_v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">Undefined</span><span class="p">:</span>

                    <span class="c1"># Get trace being updated</span>
                    <span class="n">trace_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">trace_ind</span><span class="p">]</span>

                    <span class="c1"># Validate key_path_str</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">BaseFigure</span><span class="o">.</span><span class="n">_is_key_path_compatible</span><span class="p">(</span><span class="n">key_path_str</span><span class="p">,</span> <span class="n">trace_obj</span><span class="p">):</span>

                        <span class="n">trace_class</span> <span class="o">=</span> <span class="n">trace_obj</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Invalid property path &#39;{key_path_str}&#39; for trace class {trace_class}</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                <span class="n">key_path_str</span><span class="o">=</span><span class="n">key_path_str</span><span class="p">,</span> <span class="n">trace_class</span><span class="o">=</span><span class="n">trace_class</span>
                            <span class="p">)</span>
                        <span class="p">)</span>

                    <span class="c1"># Apply set operation for this trace and thist value</span>
                    <span class="n">val_changed</span> <span class="o">=</span> <span class="n">BaseFigure</span><span class="o">.</span><span class="n">_set_in</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">trace_ind</span><span class="p">],</span> <span class="n">key_path_str</span><span class="p">,</span> <span class="n">trace_v</span>
                    <span class="p">)</span>

                    <span class="c1"># Update any_vals_changed status</span>
                    <span class="n">any_vals_changed</span> <span class="o">=</span> <span class="n">any_vals_changed</span> <span class="ow">or</span> <span class="n">val_changed</span>

            <span class="k">if</span> <span class="n">any_vals_changed</span><span class="p">:</span>
                <span class="n">restyle_changes</span><span class="p">[</span><span class="n">key_path_str</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>

        <span class="k">return</span> <span class="n">restyle_changes</span>

    <span class="k">def</span> <span class="nf">_restyle_child</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">child</span><span class="p">,</span> <span class="n">key_path_str</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Process restyle operation on a child trace object</span>

<span class="sd">        Note: This method name/signature must match the one in</span>
<span class="sd">        BasePlotlyType. BasePlotlyType objects call their parent&#39;s</span>
<span class="sd">        _restyle_child method without knowing whether their parent is a</span>
<span class="sd">        BasePlotlyType or a BaseFigure.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        child : BaseTraceType</span>
<span class="sd">            Child being restyled</span>
<span class="sd">        key_path_str : str</span>
<span class="sd">            A key path string (e.g. &#39;foo.bar[0]&#39;)</span>
<span class="sd">        val</span>
<span class="sd">            Restyle value</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Compute trace index</span>
        <span class="c1"># -------------------</span>
        <span class="n">trace_index</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">_trace_ind</span>

        <span class="c1"># Not in batch mode</span>
        <span class="c1"># -----------------</span>
        <span class="c1"># Dispatch change callbacks and send restyle message</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_in_batch_mode</span><span class="p">:</span>
            <span class="n">send_val</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span><span class="p">]</span>
            <span class="n">restyle</span> <span class="o">=</span> <span class="p">{</span><span class="n">key_path_str</span><span class="p">:</span> <span class="n">send_val</span><span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_send_restyle_msg</span><span class="p">(</span><span class="n">restyle</span><span class="p">,</span> <span class="n">trace_indexes</span><span class="o">=</span><span class="n">trace_index</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dispatch_trace_change_callbacks</span><span class="p">(</span><span class="n">restyle</span><span class="p">,</span> <span class="p">[</span><span class="n">trace_index</span><span class="p">])</span>

        <span class="c1"># In batch mode</span>
        <span class="c1"># -------------</span>
        <span class="c1"># Add key_path_str/val to saved batch edits</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">trace_index</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_batch_trace_edits</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_batch_trace_edits</span><span class="p">[</span><span class="n">trace_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_batch_trace_edits</span><span class="p">[</span><span class="n">trace_index</span><span class="p">][</span><span class="n">key_path_str</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>

    <span class="k">def</span> <span class="nf">_normalize_trace_indexes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trace_indexes</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Input trace index specification and return list of the specified trace</span>
<span class="sd">        indexes</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        trace_indexes : None or int or list[int]</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list[int]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">trace_indexes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">trace_indexes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">trace_indexes</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="n">trace_indexes</span> <span class="o">=</span> <span class="p">[</span><span class="n">trace_indexes</span><span class="p">]</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">trace_indexes</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_str_to_dict_path</span><span class="p">(</span><span class="n">key_path_str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert a key path string into a tuple of key path elements</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        key_path_str : str</span>
<span class="sd">            Key path string, where nested keys are joined on &#39;.&#39; characters</span>
<span class="sd">            and array indexes are specified using brackets</span>
<span class="sd">            (e.g. &#39;foo.bar[1]&#39;)</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tuple[str | int]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">key_path_str</span><span class="p">,</span> <span class="n">string_types</span><span class="p">)</span>
            <span class="ow">and</span> <span class="s2">&quot;.&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">key_path_str</span>
            <span class="ow">and</span> <span class="s2">&quot;[&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">key_path_str</span>
            <span class="ow">and</span> <span class="s2">&quot;_&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">key_path_str</span>
        <span class="p">):</span>
            <span class="c1"># Fast path for common case that avoids regular expressions</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">key_path_str</span><span class="p">,)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key_path_str</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="c1"># Nothing to do</span>
            <span class="k">return</span> <span class="n">key_path_str</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Split string on periods.</span>
            <span class="c1"># e.g. &#39;foo.bar_baz[1]&#39; -&gt; [&#39;foo&#39;, &#39;bar_baz[1]&#39;]</span>
            <span class="n">key_path</span> <span class="o">=</span> <span class="n">key_path_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>

            <span class="c1"># Split out bracket indexes.</span>
            <span class="c1"># e.g. [&#39;foo&#39;, &#39;bar_baz[1]&#39;] -&gt; [&#39;foo&#39;, &#39;bar_baz&#39;, &#39;1&#39;]</span>
            <span class="n">key_path2</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">key_path</span><span class="p">:</span>
                <span class="n">match</span> <span class="o">=</span> <span class="n">BaseFigure</span><span class="o">.</span><span class="n">_bracket_re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                    <span class="n">key_path2</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">())</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">key_path2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

            <span class="c1"># Split out underscore</span>
            <span class="c1"># e.g. [&#39;foo&#39;, &#39;bar_baz&#39;, &#39;1&#39;] -&gt; [&#39;foo&#39;, &#39;bar&#39;, &#39;baz&#39;, &#39;1&#39;]</span>
            <span class="n">key_path3</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">underscore_props</span> <span class="o">=</span> <span class="n">BaseFigure</span><span class="o">.</span><span class="n">_valid_underscore_properties</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">key_path2</span><span class="p">:</span>
                <span class="k">if</span> <span class="s2">&quot;_&quot;</span> <span class="ow">in</span> <span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                    <span class="c1"># For valid properties that contain underscores (error_x)</span>
                    <span class="c1"># replace the underscores with hyphens to protect them</span>
                    <span class="c1"># from being split up</span>
                    <span class="k">for</span> <span class="n">under_prop</span><span class="p">,</span> <span class="n">hyphen_prop</span> <span class="ow">in</span> <span class="n">underscore_props</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="n">key</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">under_prop</span><span class="p">,</span> <span class="n">hyphen_prop</span><span class="p">)</span>

                    <span class="c1"># Split key on underscores</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span>

                    <span class="c1"># Replace hyphens with underscores to restore properties</span>
                    <span class="c1"># that include underscores</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)):</span>
                        <span class="n">key</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">key</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>

                    <span class="n">key_path3</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">key_path3</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

            <span class="c1"># Convert elements to ints if possible.</span>
            <span class="c1"># e.g. [&#39;foo&#39;, &#39;bar&#39;, &#39;0&#39;] -&gt; [&#39;foo&#39;, &#39;bar&#39;, 0]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">key_path3</span><span class="p">)):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">key_path3</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">key_path3</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">_</span><span class="p">:</span>
                    <span class="k">pass</span>

            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">key_path3</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_set_in</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">key_path_str</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set a value in a nested dict using a key path string</span>
<span class="sd">        (e.g. &#39;foo.bar[0]&#39;)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        d : dict</span>
<span class="sd">            Input dict to set property in</span>
<span class="sd">        key_path_str : str</span>
<span class="sd">            Key path string, where nested keys are joined on &#39;.&#39; characters</span>
<span class="sd">            and array indexes are specified using brackets</span>
<span class="sd">            (e.g. &#39;foo.bar[1]&#39;)</span>
<span class="sd">        v</span>
<span class="sd">            New value</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            True if set resulted in modification of dict (i.e. v was not</span>
<span class="sd">            already present at the specified location), False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Validate inputs</span>
        <span class="c1"># ---------------</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span>

        <span class="c1"># Compute key path</span>
        <span class="c1"># ----------------</span>
        <span class="c1"># Convert the key_path_str into a tuple of key paths</span>
        <span class="c1"># e.g. &#39;foo.bar[0]&#39; -&gt; (&#39;foo&#39;, &#39;bar&#39;, 0)</span>
        <span class="n">key_path</span> <span class="o">=</span> <span class="n">BaseFigure</span><span class="o">.</span><span class="n">_str_to_dict_path</span><span class="p">(</span><span class="n">key_path_str</span><span class="p">)</span>

        <span class="c1"># Initialize val_parent</span>
        <span class="c1"># ---------------------</span>
        <span class="c1"># This variable will be assigned to the parent of the next key path</span>
        <span class="c1"># element currently being processed</span>
        <span class="n">val_parent</span> <span class="o">=</span> <span class="n">d</span>

        <span class="c1"># Initialize parent dict or list of value to be assigned</span>
        <span class="c1"># -----------------------------------------------------</span>
        <span class="k">for</span> <span class="n">kp</span><span class="p">,</span> <span class="n">key_path_el</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">key_path</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>

            <span class="c1"># Extend val_parent list if needed</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val_parent</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key_path_el</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">val_parent</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">key_path_el</span><span class="p">:</span>
                    <span class="n">val_parent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val_parent</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="n">key_path_el</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">val_parent</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key_path</span><span class="p">[</span><span class="n">kp</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>
                    <span class="n">val_parent</span><span class="p">[</span><span class="n">key_path_el</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">val_parent</span><span class="p">[</span><span class="n">key_path_el</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="n">val_parent</span> <span class="o">=</span> <span class="n">val_parent</span><span class="p">[</span><span class="n">key_path_el</span><span class="p">]</span>

        <span class="c1"># Assign value to to final parent dict or list</span>
        <span class="c1"># --------------------------------------------</span>
        <span class="c1"># ### Get reference to final key path element ###</span>
        <span class="n">last_key</span> <span class="o">=</span> <span class="n">key_path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># ### Track whether assignment alters parent ###</span>
        <span class="n">val_changed</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># v is Undefined</span>
        <span class="c1"># --------------</span>
        <span class="c1"># Don&#39;t alter val_parent</span>
        <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="n">Undefined</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="c1"># v is None</span>
        <span class="c1"># ---------</span>
        <span class="c1"># Check whether we can remove key from parent</span>
        <span class="k">elif</span> <span class="n">v</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val_parent</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">last_key</span> <span class="ow">in</span> <span class="n">val_parent</span><span class="p">:</span>
                    <span class="c1"># Parent is a dict and has last_key as a current key so</span>
                    <span class="c1"># we can pop the key, which alters parent</span>
                    <span class="n">val_parent</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">last_key</span><span class="p">)</span>
                    <span class="n">val_changed</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val_parent</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">last_key</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">last_key</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">val_parent</span><span class="p">):</span>
                    <span class="c1"># Parent is a list and last_key is a valid index so we</span>
                    <span class="c1"># can set the element value to None</span>
                    <span class="n">val_parent</span><span class="p">[</span><span class="n">last_key</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">val_changed</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Unsupported parent type (numpy array for example)</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Cannot remove element of type {typ} at location {raw_key}&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">typ</span><span class="o">=</span><span class="nb">type</span><span class="p">(</span><span class="n">val_parent</span><span class="p">),</span> <span class="n">raw_key</span><span class="o">=</span><span class="n">key_path_str</span>
                    <span class="p">)</span>
                <span class="p">)</span>
        <span class="c1"># v is a valid value</span>
        <span class="c1"># ------------------</span>
        <span class="c1"># Check whether parent should be updated</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val_parent</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">last_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">val_parent</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">BasePlotlyType</span><span class="o">.</span><span class="n">_vals_equal</span><span class="p">(</span>
                    <span class="n">val_parent</span><span class="p">[</span><span class="n">last_key</span><span class="p">],</span> <span class="n">v</span>
                <span class="p">):</span>
                    <span class="c1"># Parent is a dict and does not already contain the</span>
                    <span class="c1"># value v at key last_key</span>
                    <span class="n">val_parent</span><span class="p">[</span><span class="n">last_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
                    <span class="n">val_changed</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val_parent</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">last_key</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                    <span class="c1"># Extend list with Nones if needed so that last_key is</span>
                    <span class="c1"># in bounds</span>
                    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">val_parent</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">last_key</span><span class="p">:</span>
                        <span class="n">val_parent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

                    <span class="k">if</span> <span class="ow">not</span> <span class="n">BasePlotlyType</span><span class="o">.</span><span class="n">_vals_equal</span><span class="p">(</span><span class="n">val_parent</span><span class="p">[</span><span class="n">last_key</span><span class="p">],</span> <span class="n">v</span><span class="p">):</span>
                        <span class="c1"># Parent is a list and does not already contain the</span>
                        <span class="c1"># value v at index last_key</span>
                        <span class="n">val_parent</span><span class="p">[</span><span class="n">last_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
                        <span class="n">val_changed</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Unsupported parent type (numpy array for example)</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Cannot set element of type {typ} at location {raw_key}&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">typ</span><span class="o">=</span><span class="nb">type</span><span class="p">(</span><span class="n">val_parent</span><span class="p">),</span> <span class="n">raw_key</span><span class="o">=</span><span class="n">key_path_str</span>
                    <span class="p">)</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="n">val_changed</span>

    <span class="c1"># Add traces</span>
    <span class="c1"># ----------</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_raise_invalid_rows_cols</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">invalid</span><span class="p">):</span>
        <span class="n">rows_err_msg</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        If specified, the </span><span class="si">{name}</span><span class="s2"> parameter must be a list or tuple of integers</span>
<span class="s2">        of length </span><span class="si">{n}</span><span class="s2"> (The number of traces being added)</span>

<span class="s2">        Received: </span><span class="si">{invalid}</span><span class="s2"></span>
<span class="s2">        &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">invalid</span><span class="o">=</span><span class="n">invalid</span>
        <span class="p">)</span>

        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">rows_err_msg</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_validate_rows_cols</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">vals</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">vals</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span> <span class="o">!=</span> <span class="n">n</span><span class="p">:</span>
                <span class="n">BaseFigure</span><span class="o">.</span><span class="n">_raise_invalid_rows_cols</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">invalid</span><span class="o">=</span><span class="n">vals</span><span class="p">)</span>

            <span class="n">int_type</span> <span class="o">=</span> <span class="n">_get_int_type</span><span class="p">()</span>

            <span class="k">if</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">vals</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">int_type</span><span class="p">)]:</span>
                <span class="n">BaseFigure</span><span class="o">.</span><span class="n">_raise_invalid_rows_cols</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">invalid</span><span class="o">=</span><span class="n">vals</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">BaseFigure</span><span class="o">.</span><span class="n">_raise_invalid_rows_cols</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">invalid</span><span class="o">=</span><span class="n">vals</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trace</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">secondary_y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a trace to the figure</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        trace : BaseTraceType or dict</span>
<span class="sd">            Either:</span>
<span class="sd">              - An instances of a trace classe from the plotly.graph_objs</span>
<span class="sd">                package (e.g plotly.graph_objs.Scatter, plotly.graph_objs.Bar)</span>
<span class="sd">              - or a dicts where:</span>

<span class="sd">                  - The &#39;type&#39; property specifies the trace type (e.g.</span>
<span class="sd">                    &#39;scatter&#39;, &#39;bar&#39;, &#39;area&#39;, etc.). If the dict has no &#39;type&#39;</span>
<span class="sd">                    property then &#39;scatter&#39; is assumed.</span>
<span class="sd">                  - All remaining properties are passed to the constructor</span>
<span class="sd">                    of the specified trace type.</span>

<span class="sd">        row : int or None (default None)</span>
<span class="sd">            Subplot row index (starting from 1) for the trace to be added.</span>
<span class="sd">            Only valid if figure was created using</span>
<span class="sd">            `plotly.subplots.make_subplots`</span>
<span class="sd">        col : int or None (default None)</span>
<span class="sd">            Subplot col index (starting from 1) for the trace to be added.</span>
<span class="sd">            Only valid if figure was created using</span>
<span class="sd">            `plotly.subplots.make_subplots`</span>
<span class="sd">        secondary_y: boolean or None (default None)</span>
<span class="sd">            If True, associate this trace with the secondary y-axis of the</span>
<span class="sd">            subplot at the specified row and col. Only valid if all of the</span>
<span class="sd">            following conditions are satisfied:</span>
<span class="sd">              * The figure was created using `plotly.subplots.make_subplots`.</span>
<span class="sd">              * The row and col arguments are not None</span>
<span class="sd">              * The subplot at the specified row and col has type xy</span>
<span class="sd">                (which is the default) and secondary_y True.  These</span>
<span class="sd">                properties are specified in the specs argument to</span>
<span class="sd">                make_subplots. See the make_subplots docstring for more info.</span>
<span class="sd">              * The trace argument is a 2D cartesian trace</span>
<span class="sd">                (scatter, bar, etc.)</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        BaseFigure</span>
<span class="sd">            The Figure that add_trace was called on</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; from plotly import subplots</span>
<span class="sd">        &gt;&gt;&gt; import plotly.graph_objs as go</span>

<span class="sd">        Add two Scatter traces to a figure</span>

<span class="sd">        &gt;&gt;&gt; fig = go.Figure()</span>
<span class="sd">        &gt;&gt;&gt; fig.add_trace(go.Scatter(x=[1,2,3], y=[2,1,2])) # doctest: +ELLIPSIS</span>
<span class="sd">        Figure(...)</span>
<span class="sd">        &gt;&gt;&gt; fig.add_trace(go.Scatter(x=[1,2,3], y=[2,1,2])) # doctest: +ELLIPSIS</span>
<span class="sd">        Figure(...)</span>


<span class="sd">        Add two Scatter traces to vertically stacked subplots</span>

<span class="sd">        &gt;&gt;&gt; fig = subplots.make_subplots(rows=2)</span>
<span class="sd">        &gt;&gt;&gt; fig.add_trace(go.Scatter(x=[1,2,3], y=[2,1,2]), row=1, col=1) # doctest: +ELLIPSIS</span>
<span class="sd">        Figure(...)</span>
<span class="sd">        &gt;&gt;&gt; fig.add_trace(go.Scatter(x=[1,2,3], y=[2,1,2]), row=2, col=1) # doctest: +ELLIPSIS</span>
<span class="sd">        Figure(...)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Make sure we have both row and col or neither</span>
        <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">col</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Received row parameter but not col.</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;row and col must be specified together&quot;</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">col</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">row</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Received col parameter but not row.</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;row and col must be specified together&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_traces</span><span class="p">(</span>
            <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">trace</span><span class="p">],</span>
            <span class="n">rows</span><span class="o">=</span><span class="p">[</span><span class="n">row</span><span class="p">]</span> <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">cols</span><span class="o">=</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="k">if</span> <span class="n">col</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">secondary_ys</span><span class="o">=</span><span class="p">[</span><span class="n">secondary_y</span><span class="p">]</span> <span class="k">if</span> <span class="n">secondary_y</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_traces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">secondary_ys</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add traces to the figure</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : list[BaseTraceType or dict]</span>
<span class="sd">            A list of trace specifications to be added.</span>
<span class="sd">            Trace specifications may be either:</span>

<span class="sd">              - Instances of trace classes from the plotly.graph_objs</span>
<span class="sd">                package (e.g plotly.graph_objs.Scatter, plotly.graph_objs.Bar)</span>
<span class="sd">              - Dicts where:</span>

<span class="sd">                  - The &#39;type&#39; property specifies the trace type (e.g.</span>
<span class="sd">                    &#39;scatter&#39;, &#39;bar&#39;, &#39;area&#39;, etc.). If the dict has no &#39;type&#39;</span>
<span class="sd">                    property then &#39;scatter&#39; is assumed.</span>
<span class="sd">                  - All remaining properties are passed to the constructor</span>
<span class="sd">                    of the specified trace type.</span>

<span class="sd">        rows : None, list[int], or int (default None)</span>
<span class="sd">            List of subplot row indexes (starting from 1) for the traces to be</span>
<span class="sd">            added. Only valid if figure was created using</span>
<span class="sd">            `plotly.tools.make_subplots`</span>
<span class="sd">            If a single integer is passed, all traces will be added to row number</span>

<span class="sd">        cols : None or list[int] (default None)</span>
<span class="sd">            List of subplot column indexes (starting from 1) for the traces</span>
<span class="sd">            to be added. Only valid if figure was created using</span>
<span class="sd">            `plotly.tools.make_subplots`</span>
<span class="sd">            If a single integer is passed, all traces will be added to column number</span>


<span class="sd">        secondary_ys: None or list[boolean] (default None)</span>
<span class="sd">            List of secondary_y booleans for traces to be added. See the</span>
<span class="sd">            docstring for `add_trace` for more info.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        BaseFigure</span>
<span class="sd">            The Figure that add_traces was called on</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; from plotly import subplots</span>
<span class="sd">        &gt;&gt;&gt; import plotly.graph_objs as go</span>

<span class="sd">        Add two Scatter traces to a figure</span>

<span class="sd">        &gt;&gt;&gt; fig = go.Figure()</span>
<span class="sd">        &gt;&gt;&gt; fig.add_traces([go.Scatter(x=[1,2,3], y=[2,1,2]),</span>
<span class="sd">        ...                 go.Scatter(x=[1,2,3], y=[2,1,2])]) # doctest: +ELLIPSIS</span>
<span class="sd">        Figure(...)</span>

<span class="sd">        Add two Scatter traces to vertically stacked subplots</span>

<span class="sd">        &gt;&gt;&gt; fig = subplots.make_subplots(rows=2)</span>
<span class="sd">        &gt;&gt;&gt; fig.add_traces([go.Scatter(x=[1,2,3], y=[2,1,2]),</span>
<span class="sd">        ...                 go.Scatter(x=[1,2,3], y=[2,1,2])],</span>
<span class="sd">        ...                 rows=[1, 2], cols=[1, 1]) # doctest: +ELLIPSIS</span>
<span class="sd">        Figure(...)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Validate traces</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_validator</span><span class="o">.</span><span class="n">validate_coerce</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="c1"># Set trace indexes</span>
        <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">new_trace</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
            <span class="n">new_trace</span><span class="o">.</span><span class="n">_trace_ind</span> <span class="o">=</span> <span class="n">ind</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

        <span class="c1"># Allow integers as inputs to subplots</span>
        <span class="n">int_type</span> <span class="o">=</span> <span class="n">_get_int_type</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">int_type</span><span class="p">):</span>
            <span class="n">rows</span> <span class="o">=</span> <span class="p">[</span><span class="n">rows</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cols</span><span class="p">,</span> <span class="n">int_type</span><span class="p">):</span>
            <span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">cols</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="c1"># Validate rows / cols</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">BaseFigure</span><span class="o">.</span><span class="n">_validate_rows_cols</span><span class="p">(</span><span class="s2">&quot;rows&quot;</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">rows</span><span class="p">)</span>
        <span class="n">BaseFigure</span><span class="o">.</span><span class="n">_validate_rows_cols</span><span class="p">(</span><span class="s2">&quot;cols&quot;</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">cols</span><span class="p">)</span>

        <span class="c1"># Make sure we have both rows and cols or neither</span>
        <span class="k">if</span> <span class="n">rows</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">cols</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Received rows parameter but not cols.</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;rows and cols must be specified together&quot;</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">cols</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">rows</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Received cols parameter but not rows.</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;rows and cols must be specified together&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Process secondary_ys defaults</span>
        <span class="k">if</span> <span class="n">secondary_ys</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">rows</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Default rows/cols to 1s if secondary_ys specified but not rows</span>
            <span class="c1"># or cols</span>
            <span class="n">rows</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">secondary_ys</span><span class="p">)</span>
            <span class="n">cols</span> <span class="o">=</span> <span class="n">rows</span>
        <span class="k">elif</span> <span class="n">secondary_ys</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">rows</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Default secondary_ys to Nones if secondary_ys is not specified</span>
            <span class="c1"># but not rows and cols are specified</span>
            <span class="n">secondary_ys</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span>

        <span class="c1"># Apply rows / cols</span>
        <span class="k">if</span> <span class="n">rows</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">trace</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">secondary_y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">,</span> <span class="n">secondary_ys</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_set_trace_grid_position</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">secondary_y</span><span class="p">)</span>

        <span class="c1"># Make deep copy of trace data (Optimize later if needed)</span>
        <span class="n">new_traces_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">trace</span><span class="o">.</span><span class="n">_props</span><span class="p">)</span> <span class="k">for</span> <span class="n">trace</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>

        <span class="c1"># Update trace parent</span>
        <span class="k">for</span> <span class="n">trace</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">trace</span><span class="o">.</span><span class="n">_parent</span> <span class="o">=</span> <span class="bp">self</span>
            <span class="n">trace</span><span class="o">.</span><span class="n">_orphan_props</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="c1"># Update python side</span>
        <span class="c1">#  Use extend instead of assignment so we don&#39;t trigger serialization</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">new_traces_data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data_defaults</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_defaults</span> <span class="o">+</span> <span class="p">[{}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data_objs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_objs</span> <span class="o">+</span> <span class="n">data</span>

        <span class="c1"># Update messages</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_send_addTraces_msg</span><span class="p">(</span><span class="n">new_traces_data</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="c1"># Subplots</span>
    <span class="c1"># --------</span>
    <span class="k">def</span> <span class="nf">print_grid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Print a visual layout of the figure&#39;s axes arrangement.</span>
<span class="sd">        This is only valid for figures that are created</span>
<span class="sd">        with plotly.tools.make_subplots.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_grid_str</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;Use plotly.tools.make_subplots &quot;</span> <span class="s2">&quot;to create a subplot grid.&quot;</span>
            <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_grid_str</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">append_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trace</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a trace to the figure bound to axes at the specified row,</span>
<span class="sd">        col index.</span>

<span class="sd">        A row, col index grid is generated for figures created with</span>
<span class="sd">        plotly.tools.make_subplots, and can be viewed with the `print_grid`</span>
<span class="sd">        method</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        trace</span>
<span class="sd">            The data trace to be bound</span>
<span class="sd">        row: int</span>
<span class="sd">            Subplot row index (see Figure.print_grid)</span>
<span class="sd">        col: int</span>
<span class="sd">            Subplot column index (see Figure.print_grid)</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; from plotly import tools</span>
<span class="sd">        &gt;&gt;&gt; import plotly.graph_objs as go</span>
<span class="sd">        &gt;&gt;&gt; # stack two subplots vertically</span>
<span class="sd">        &gt;&gt;&gt; fig = tools.make_subplots(rows=2)</span>

<span class="sd">        This is the format of your plot grid:</span>
<span class="sd">        [ (1,1) x1,y1 ]</span>
<span class="sd">        [ (2,1) x2,y2 ]</span>

<span class="sd">        &gt;&gt;&gt; fig.append_trace(go.Scatter(x=[1,2,3], y=[2,1,2]), row=1, col=1)</span>
<span class="sd">        &gt;&gt;&gt; fig.append_trace(go.Scatter(x=[1,2,3], y=[2,1,2]), row=2, col=1)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="sd">&quot;&quot;&quot;\</span>
<span class="sd">The append_trace method is deprecated and will be removed in a future version.</span>
<span class="sd">Please use the add_trace method with the row and col parameters.</span>
<span class="sd">&quot;&quot;&quot;</span><span class="p">,</span>
            <span class="ne">DeprecationWarning</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">trace</span><span class="o">=</span><span class="n">trace</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_trace_grid_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trace</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">secondary_y</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">plotly.subplots</span> <span class="kn">import</span> <span class="n">_set_trace_grid_reference</span>

        <span class="n">grid_ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_get_grid_ref</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">_set_trace_grid_reference</span><span class="p">(</span>
            <span class="n">trace</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">,</span> <span class="n">grid_ref</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">secondary_y</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_validate_get_grid_ref</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">grid_ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_grid_ref</span>
            <span class="k">if</span> <span class="n">grid_ref</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;_grid_ref&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;In order to reference traces by row and column, &quot;</span>
                <span class="s2">&quot;you must first use &quot;</span>
                <span class="s2">&quot;plotly.tools.make_subplots &quot;</span>
                <span class="s2">&quot;to create the figure with a subplot grid.&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">grid_ref</span>

    <span class="k">def</span> <span class="nf">get_subplot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">secondary_y</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return an object representing the subplot at the specified row</span>
<span class="sd">        and column.  May only be used on Figures created using</span>
<span class="sd">        plotly.tools.make_subplots</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        row: int</span>
<span class="sd">            1-based index of subplot row</span>
<span class="sd">        col: int</span>
<span class="sd">            1-based index of subplot column</span>
<span class="sd">        secondary_y: bool</span>
<span class="sd">            If True, select the subplot that consists of the x-axis and the</span>
<span class="sd">            secondary y-axis at the specified row/col. Only valid if the</span>
<span class="sd">            subplot at row/col is an 2D cartesian subplot that was created</span>
<span class="sd">            with a secondary y-axis.  See the docstring for the specs argument</span>
<span class="sd">            to make_subplots for more info on creating a subplot with a</span>
<span class="sd">            secondary y-axis.</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        subplot</span>
<span class="sd">            * None: if subplot is empty</span>
<span class="sd">            * plotly.graph_objs.layout.Scene: if subplot type is &#39;scene&#39;</span>
<span class="sd">            * plotly.graph_objs.layout.Polar: if subplot type is &#39;polar&#39;</span>
<span class="sd">            * plotly.graph_objs.layout.Ternary: if subplot type is &#39;ternary&#39;</span>
<span class="sd">            * plotly.graph_objs.layout.Mapbox: if subplot type is &#39;ternary&#39;</span>
<span class="sd">            * SubplotDomain namedtuple with `x` and `y` fields:</span>
<span class="sd">              if subplot type is &#39;domain&#39;.</span>
<span class="sd">                - x: length 2 list of the subplot start and stop width</span>
<span class="sd">                - y: length 2 list of the subplot start and stop height</span>
<span class="sd">            * SubplotXY namedtuple with `xaxis` and `yaxis` fields:</span>
<span class="sd">              if subplot type is &#39;xy&#39;.</span>
<span class="sd">                - xaxis: plotly.graph_objs.layout.XAxis instance for subplot</span>
<span class="sd">                - yaxis: plotly.graph_objs.layout.YAxis instance for subplot</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">plotly.subplots</span> <span class="kn">import</span> <span class="n">_get_grid_subplot</span>

        <span class="k">return</span> <span class="n">_get_grid_subplot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">secondary_y</span><span class="p">)</span>

    <span class="c1"># Child property operations</span>
    <span class="c1"># -------------------------</span>
    <span class="k">def</span> <span class="nf">_get_child_props</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">child</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the properties dict for a child trace or child layout</span>

<span class="sd">        Note: this method must match the name/signature of one on</span>
<span class="sd">        BasePlotlyType</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        child : BaseTraceType | BaseLayoutType</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Try to find index of child as a trace</span>
        <span class="c1"># -------------------------------------</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">BaseTraceType</span><span class="p">):</span>
            <span class="c1"># ### Child is a trace ###</span>
            <span class="n">trace_index</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">_trace_ind</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">trace_index</span><span class="p">]</span>

        <span class="c1"># Child is the layout</span>
        <span class="c1"># -------------------</span>
        <span class="k">elif</span> <span class="n">child</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_layout</span>

        <span class="c1"># Unknown child</span>
        <span class="c1"># -------------</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unrecognized child: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">child</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_child_prop_defaults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">child</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the default properties dict for a child trace or child layout</span>

<span class="sd">        Note: this method must match the name/signature of one on</span>
<span class="sd">        BasePlotlyType</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        child : BaseTraceType | BaseLayoutType</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Child is a trace</span>
        <span class="c1"># ----------------</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">BaseTraceType</span><span class="p">):</span>
            <span class="n">trace_index</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">_trace_ind</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_defaults</span><span class="p">[</span><span class="n">trace_index</span><span class="p">]</span>

        <span class="c1"># Child is the layout</span>
        <span class="c1"># -------------------</span>
        <span class="k">elif</span> <span class="n">child</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_layout_defaults</span>

        <span class="c1"># Unknown child</span>
        <span class="c1"># -------------</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unrecognized child: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">child</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_init_child_props</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">child</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the properites dict for a child trace or layout</span>

<span class="sd">        Note: this method must match the name/signature of one on</span>
<span class="sd">        BasePlotlyType</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        child : BaseTraceType | BaseLayoutType</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># layout and traces dict are initialize when figure is constructed</span>
        <span class="c1"># and when new traces are added to the figure</span>
        <span class="k">pass</span>

    <span class="c1"># Layout</span>
    <span class="c1"># ------</span>
    <span class="k">def</span> <span class="nf">_initialize_layout_template</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">plotly.io</span> <span class="k">as</span> <span class="nn">pio</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_layout_obj</span><span class="o">.</span><span class="n">_props</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;template&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">pio</span><span class="o">.</span><span class="n">templates</span><span class="o">.</span><span class="n">default</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># Assume default template is already validated</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_allow_disable_validation</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_layout_obj</span><span class="o">.</span><span class="n">_validate</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pio</span><span class="o">.</span><span class="n">templates</span><span class="o">.</span><span class="n">default</span><span class="p">,</span> <span class="n">BasePlotlyType</span><span class="p">):</span>
                        <span class="c1"># Template object. Don&#39;t want to actually import `Template`</span>
                        <span class="c1"># here for performance so we check against `BasePlotlyType`</span>
                        <span class="n">template_object</span> <span class="o">=</span> <span class="n">pio</span><span class="o">.</span><span class="n">templates</span><span class="o">.</span><span class="n">default</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># Name of registered template object</span>
                        <span class="n">template_object</span> <span class="o">=</span> <span class="n">pio</span><span class="o">.</span><span class="n">templates</span><span class="p">[</span><span class="n">pio</span><span class="o">.</span><span class="n">templates</span><span class="o">.</span><span class="n">default</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_layout_obj</span><span class="o">.</span><span class="n">template</span> <span class="o">=</span> <span class="n">template_object</span>
                <span class="k">finally</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_layout_obj</span><span class="o">.</span><span class="n">_validate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">layout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The `layout` property of the figure</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        plotly.graph_objs.Layout</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;layout&quot;</span><span class="p">]</span>

    <span class="nd">@layout</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">layout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_layout</span><span class="p">):</span>

        <span class="c1"># Validate new layout</span>
        <span class="c1"># -------------------</span>
        <span class="n">new_layout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_layout_validator</span><span class="o">.</span><span class="n">validate_coerce</span><span class="p">(</span><span class="n">new_layout</span><span class="p">)</span>
        <span class="n">new_layout_data</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">new_layout</span><span class="o">.</span><span class="n">_props</span><span class="p">)</span>

        <span class="c1"># Unparent current layout</span>
        <span class="c1"># -----------------------</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_layout_obj</span><span class="p">:</span>
            <span class="n">old_layout_data</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_layout_obj</span><span class="o">.</span><span class="n">_props</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_layout_obj</span><span class="o">.</span><span class="n">_orphan_props</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">old_layout_data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_layout_obj</span><span class="o">.</span><span class="n">_parent</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Parent new layout</span>
        <span class="c1"># -----------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_layout</span> <span class="o">=</span> <span class="n">new_layout_data</span>
        <span class="n">new_layout</span><span class="o">.</span><span class="n">_parent</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">new_layout</span><span class="o">.</span><span class="n">_orphan_props</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_layout_obj</span> <span class="o">=</span> <span class="n">new_layout</span>

        <span class="c1"># Initialize template object</span>
        <span class="c1"># --------------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_layout_template</span><span class="p">()</span>

        <span class="c1"># Notify JS side</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_send_relayout_msg</span><span class="p">(</span><span class="n">new_layout_data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">plotly_relayout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">relayout_data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Perform a Plotly relayout operation on the figure&#39;s layout</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        relayout_data : dict</span>
<span class="sd">            Dict of layout updates</span>

<span class="sd">            dict keys are strings that specify the properties to be updated.</span>
<span class="sd">            Nested properties are expressed by joining successive keys on</span>
<span class="sd">            &#39;.&#39; characters (e.g. &#39;xaxis.range&#39;)</span>

<span class="sd">            dict values are the values to use to update the layout.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Handle source_view_id</span>
        <span class="c1"># ---------------------</span>
        <span class="c1"># If not None, the source_view_id is the UID of the frontend</span>
        <span class="c1"># Plotly.js view that initially triggered this relayout operation</span>
        <span class="c1"># (e.g. the user clicked on the toolbar to change the drag mode</span>
        <span class="c1"># from zoom to pan). We pass this UID along so that the frontend</span>
        <span class="c1"># views can determine whether they need to apply the relayout</span>
        <span class="c1"># operation on themselves.</span>
        <span class="k">if</span> <span class="s2">&quot;source_view_id&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">msg_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;source_view_id&quot;</span><span class="p">:</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;source_view_id&quot;</span><span class="p">]}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg_kwargs</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Perform relayout operation on layout dict</span>
        <span class="c1"># -----------------------------------------</span>
        <span class="n">relayout_changes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_perform_plotly_relayout</span><span class="p">(</span><span class="n">relayout_data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">relayout_changes</span><span class="p">:</span>
            <span class="c1"># The relayout operation resulted in a change to some layout</span>
            <span class="c1"># properties, so we dispatch change callbacks and send the</span>
            <span class="c1"># relayout message to the frontend (if any)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_send_relayout_msg</span><span class="p">(</span><span class="n">relayout_changes</span><span class="p">,</span> <span class="o">**</span><span class="n">msg_kwargs</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_dispatch_layout_change_callbacks</span><span class="p">(</span><span class="n">relayout_changes</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_perform_plotly_relayout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">relayout_data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Perform a relayout operation on the figure&#39;s layout data and return</span>
<span class="sd">        the changes that were applied</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        relayout_data : dict[str, any]</span>
<span class="sd">            See the docstring for plotly_relayout</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        relayout_changes: dict[str, any]</span>
<span class="sd">            Subset of relayout_data including only the keys / values that</span>
<span class="sd">            resulted in a change to the figure&#39;s layout data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Initialize relayout changes</span>
        <span class="c1"># ---------------------------</span>
        <span class="c1"># This will be a subset of the relayout_data including only the</span>
        <span class="c1"># keys / values that are changed in the figure&#39;s layout data</span>
        <span class="n">relayout_changes</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Process each key</span>
        <span class="c1"># ----------------</span>
        <span class="k">for</span> <span class="n">key_path_str</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">relayout_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">BaseFigure</span><span class="o">.</span><span class="n">_is_key_path_compatible</span><span class="p">(</span><span class="n">key_path_str</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">):</span>

                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Invalid property path &#39;{key_path_str}&#39; for layout</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">key_path_str</span><span class="o">=</span><span class="n">key_path_str</span>
                    <span class="p">)</span>
                <span class="p">)</span>

            <span class="c1"># Apply set operation on the layout dict</span>
            <span class="n">val_changed</span> <span class="o">=</span> <span class="n">BaseFigure</span><span class="o">.</span><span class="n">_set_in</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_layout</span><span class="p">,</span> <span class="n">key_path_str</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">val_changed</span><span class="p">:</span>
                <span class="n">relayout_changes</span><span class="p">[</span><span class="n">key_path_str</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>

        <span class="k">return</span> <span class="n">relayout_changes</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_is_key_path_compatible</span><span class="p">(</span><span class="n">key_path_str</span><span class="p">,</span> <span class="n">plotly_obj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return whether the specifieid key path string is compatible with</span>
<span class="sd">        the specified plotly object for the purpose of relayout/restyle</span>
<span class="sd">        operation</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Convert string to tuple of path components</span>
        <span class="c1"># e.g. &#39;foo[0].bar[1]&#39; -&gt; (&#39;foo&#39;, 0, &#39;bar&#39;, 1)</span>
        <span class="n">key_path_tuple</span> <span class="o">=</span> <span class="n">BaseFigure</span><span class="o">.</span><span class="n">_str_to_dict_path</span><span class="p">(</span><span class="n">key_path_str</span><span class="p">)</span>

        <span class="c1"># Remove trailing integer component</span>
        <span class="c1"># e.g. (&#39;foo&#39;, 0, &#39;bar&#39;, 1) -&gt; (&#39;foo&#39;, 0, &#39;bar&#39;)</span>
        <span class="c1"># We do this because it&#39;s fine for relayout/restyle to create new</span>
        <span class="c1"># elements in the final array in the path.</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key_path_tuple</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">key_path_tuple</span> <span class="o">=</span> <span class="n">key_path_tuple</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># Test whether modified key path tuple is in plotly_obj</span>
        <span class="k">return</span> <span class="n">key_path_tuple</span> <span class="ow">in</span> <span class="n">plotly_obj</span>

    <span class="k">def</span> <span class="nf">_relayout_child</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">child</span><span class="p">,</span> <span class="n">key_path_str</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Process relayout operation on child layout object</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        child : BaseLayoutType</span>
<span class="sd">            The figure&#39;s layout</span>
<span class="sd">        key_path_str :</span>
<span class="sd">            A key path string (e.g. &#39;foo.bar[0]&#39;)</span>
<span class="sd">        val</span>
<span class="sd">            Relayout value</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Validate input</span>
        <span class="c1"># --------------</span>
        <span class="k">assert</span> <span class="n">child</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout</span>

        <span class="c1"># Not in batch mode</span>
        <span class="c1"># -------------</span>
        <span class="c1"># Dispatch change callbacks and send relayout message</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_in_batch_mode</span><span class="p">:</span>
            <span class="n">relayout_msg</span> <span class="o">=</span> <span class="p">{</span><span class="n">key_path_str</span><span class="p">:</span> <span class="n">val</span><span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_send_relayout_msg</span><span class="p">(</span><span class="n">relayout_msg</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dispatch_layout_change_callbacks</span><span class="p">(</span><span class="n">relayout_msg</span><span class="p">)</span>

        <span class="c1"># In batch mode</span>
        <span class="c1"># -------------</span>
        <span class="c1"># Add key_path_str/val to saved batch edits</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_batch_layout_edits</span><span class="p">[</span><span class="n">key_path_str</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>

    <span class="c1"># Dispatch change callbacks</span>
    <span class="c1"># -------------------------</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_build_dispatch_plan</span><span class="p">(</span><span class="n">key_path_strs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Build a dispatch plan for a list of key path strings</span>

<span class="sd">        A dispatch plan is a dict:</span>
<span class="sd">           - *from* path tuples that reference an object that has descendants</span>
<span class="sd">             that are referenced in `key_path_strs`.</span>
<span class="sd">           - *to* sets of tuples that correspond to descendants of the object</span>
<span class="sd">             above.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        key_path_strs : list[str]</span>
<span class="sd">            List of key path strings. For example:</span>

<span class="sd">            [&#39;xaxis.rangeselector.font.color&#39;, &#39;xaxis.rangeselector.bgcolor&#39;]</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dispatch_plan: dict[tuple[str|int], set[tuple[str|int]]]</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; key_path_strs = [&#39;xaxis.rangeselector.font.color&#39;,</span>
<span class="sd">        ...                  &#39;xaxis.rangeselector.bgcolor&#39;]</span>

<span class="sd">        &gt;&gt;&gt; BaseFigure._build_dispatch_plan(key_path_strs) # doctest: +SKIP</span>
<span class="sd">            {(): {&#39;xaxis&#39;,</span>
<span class="sd">                  (&#39;xaxis&#39;, &#39;rangeselector&#39;),</span>
<span class="sd">                  (&#39;xaxis&#39;, &#39;rangeselector&#39;, &#39;bgcolor&#39;),</span>
<span class="sd">                  (&#39;xaxis&#39;, &#39;rangeselector&#39;, &#39;font&#39;),</span>
<span class="sd">                  (&#39;xaxis&#39;, &#39;rangeselector&#39;, &#39;font&#39;, &#39;color&#39;)},</span>
<span class="sd">             (&#39;xaxis&#39;,): {(&#39;rangeselector&#39;,),</span>
<span class="sd">                          (&#39;rangeselector&#39;, &#39;bgcolor&#39;),</span>
<span class="sd">                          (&#39;rangeselector&#39;, &#39;font&#39;),</span>
<span class="sd">                          (&#39;rangeselector&#39;, &#39;font&#39;, &#39;color&#39;)},</span>
<span class="sd">             (&#39;xaxis&#39;, &#39;rangeselector&#39;): {(&#39;bgcolor&#39;,),</span>
<span class="sd">                                          (&#39;font&#39;,),</span>
<span class="sd">                                          (&#39;font&#39;, &#39;color&#39;)},</span>
<span class="sd">             (&#39;xaxis&#39;, &#39;rangeselector&#39;, &#39;font&#39;): {(&#39;color&#39;,)}}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dispatch_plan</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">key_path_str</span> <span class="ow">in</span> <span class="n">key_path_strs</span><span class="p">:</span>

            <span class="n">key_path</span> <span class="o">=</span> <span class="n">BaseFigure</span><span class="o">.</span><span class="n">_str_to_dict_path</span><span class="p">(</span><span class="n">key_path_str</span><span class="p">)</span>
            <span class="n">key_path_so_far</span> <span class="o">=</span> <span class="p">()</span>
            <span class="n">keys_left</span> <span class="o">=</span> <span class="n">key_path</span>

            <span class="c1"># Iterate down the key path</span>
            <span class="k">for</span> <span class="n">next_key</span> <span class="ow">in</span> <span class="n">key_path</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key_path_so_far</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dispatch_plan</span><span class="p">:</span>
                    <span class="n">dispatch_plan</span><span class="p">[</span><span class="n">key_path_so_far</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

                <span class="n">to_add</span> <span class="o">=</span> <span class="p">[</span><span class="n">keys_left</span><span class="p">[:</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">keys_left</span><span class="p">))]</span>
                <span class="n">dispatch_plan</span><span class="p">[</span><span class="n">key_path_so_far</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">to_add</span><span class="p">)</span>

                <span class="n">key_path_so_far</span> <span class="o">=</span> <span class="n">key_path_so_far</span> <span class="o">+</span> <span class="p">(</span><span class="n">next_key</span><span class="p">,)</span>
                <span class="n">keys_left</span> <span class="o">=</span> <span class="n">keys_left</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

        <span class="k">return</span> <span class="n">dispatch_plan</span>

    <span class="k">def</span> <span class="nf">_dispatch_layout_change_callbacks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">relayout_data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dispatch property change callbacks given relayout_data</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        relayout_data : dict[str, any]</span>
<span class="sd">            See docstring for plotly_relayout.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Build dispatch plan</span>
        <span class="c1"># -------------------</span>
        <span class="n">key_path_strs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">relayout_data</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">dispatch_plan</span> <span class="o">=</span> <span class="n">BaseFigure</span><span class="o">.</span><span class="n">_build_dispatch_plan</span><span class="p">(</span><span class="n">key_path_strs</span><span class="p">)</span>

        <span class="c1"># Dispatch changes to each layout objects</span>
        <span class="c1"># ---------------------------------------</span>
        <span class="k">for</span> <span class="n">path_tuple</span><span class="p">,</span> <span class="n">changed_paths</span> <span class="ow">in</span> <span class="n">dispatch_plan</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">path_tuple</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">:</span>
                <span class="n">dispatch_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="n">path_tuple</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dispatch_obj</span><span class="p">,</span> <span class="n">BasePlotlyType</span><span class="p">):</span>
                    <span class="n">dispatch_obj</span><span class="o">.</span><span class="n">_dispatch_change_callbacks</span><span class="p">(</span><span class="n">changed_paths</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_dispatch_trace_change_callbacks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">restyle_data</span><span class="p">,</span> <span class="n">trace_indexes</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dispatch property change callbacks given restyle_data</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        restyle_data : dict[str, any]</span>
<span class="sd">            See docstring for plotly_restyle.</span>

<span class="sd">        trace_indexes : list[int]</span>
<span class="sd">            List of trace indexes that restyle operation applied to</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Build dispatch plan</span>
        <span class="c1"># -------------------</span>
        <span class="n">key_path_strs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">restyle_data</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">dispatch_plan</span> <span class="o">=</span> <span class="n">BaseFigure</span><span class="o">.</span><span class="n">_build_dispatch_plan</span><span class="p">(</span><span class="n">key_path_strs</span><span class="p">)</span>

        <span class="c1"># Dispatch changes to each object in each trace</span>
        <span class="c1"># ---------------------------------------------</span>
        <span class="k">for</span> <span class="n">path_tuple</span><span class="p">,</span> <span class="n">changed_paths</span> <span class="ow">in</span> <span class="n">dispatch_plan</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">trace_ind</span> <span class="ow">in</span> <span class="n">trace_indexes</span><span class="p">:</span>
                <span class="n">trace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">trace_ind</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">path_tuple</span> <span class="ow">in</span> <span class="n">trace</span><span class="p">:</span>
                    <span class="n">dispatch_obj</span> <span class="o">=</span> <span class="n">trace</span><span class="p">[</span><span class="n">path_tuple</span><span class="p">]</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dispatch_obj</span><span class="p">,</span> <span class="n">BasePlotlyType</span><span class="p">):</span>
                        <span class="n">dispatch_obj</span><span class="o">.</span><span class="n">_dispatch_change_callbacks</span><span class="p">(</span><span class="n">changed_paths</span><span class="p">)</span>

    <span class="c1"># Frames</span>
    <span class="c1"># ------</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">frames</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The `frames` property is a tuple of the figure&#39;s frame objects</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tuple[plotly.graph_objs.Frame]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;frames&quot;</span><span class="p">]</span>

    <span class="nd">@frames</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">frames</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_frames</span><span class="p">):</span>
        <span class="c1"># Note: Frames are not supported by the FigureWidget subclass so we</span>
        <span class="c1"># only validate coerce the frames. We don&#39;t emit any events on frame</span>
        <span class="c1"># changes, and we don&#39;t reparent the frames.</span>

        <span class="c1"># Validate frames</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_frame_objs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_frames_validator</span><span class="o">.</span><span class="n">validate_coerce</span><span class="p">(</span><span class="n">new_frames</span><span class="p">)</span>

    <span class="c1"># Update</span>
    <span class="c1"># ------</span>
    <span class="k">def</span> <span class="nf">plotly_update</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">restyle_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">relayout_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">trace_indexes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Perform a Plotly update operation on the figure.</span>

<span class="sd">        Note: This operation both mutates and returns the figure</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        restyle_data : dict</span>
<span class="sd">            Traces update specification. See the docstring for the</span>
<span class="sd">            `plotly_restyle` method for details</span>
<span class="sd">        relayout_data : dict</span>
<span class="sd">            Layout update specification. See the docstring for the</span>
<span class="sd">            `plotly_relayout` method for details</span>
<span class="sd">        trace_indexes :</span>
<span class="sd">            Trace index, or list of trace indexes, that the update operation</span>
<span class="sd">            applies to. Defaults to all trace indexes.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        BaseFigure</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Handle source_view_id</span>
        <span class="c1"># ---------------------</span>
        <span class="c1"># If not None, the source_view_id is the UID of the frontend</span>
        <span class="c1"># Plotly.js view that initially triggered this update operation</span>
        <span class="c1"># (e.g. the user clicked a button that triggered an update</span>
        <span class="c1"># operation). We pass this UID along so that the frontend views can</span>
        <span class="c1"># determine whether they need to apply the update operation on</span>
        <span class="c1"># themselves.</span>
        <span class="k">if</span> <span class="s2">&quot;source_view_id&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">msg_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;source_view_id&quot;</span><span class="p">:</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;source_view_id&quot;</span><span class="p">]}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg_kwargs</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Perform update operation</span>
        <span class="c1"># ------------------------</span>
        <span class="c1"># This updates the _data and _layout dicts, and returns the changes</span>
        <span class="c1"># to the traces (restyle_changes) and layout (relayout_changes)</span>
        <span class="p">(</span>
            <span class="n">restyle_changes</span><span class="p">,</span>
            <span class="n">relayout_changes</span><span class="p">,</span>
            <span class="n">trace_indexes</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_perform_plotly_update</span><span class="p">(</span>
            <span class="n">restyle_data</span><span class="o">=</span><span class="n">restyle_data</span><span class="p">,</span>
            <span class="n">relayout_data</span><span class="o">=</span><span class="n">relayout_data</span><span class="p">,</span>
            <span class="n">trace_indexes</span><span class="o">=</span><span class="n">trace_indexes</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Send update message</span>
        <span class="c1"># -------------------</span>
        <span class="c1"># Send a plotly_update message to the frontend (if any)</span>
        <span class="k">if</span> <span class="n">restyle_changes</span> <span class="ow">or</span> <span class="n">relayout_changes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_send_update_msg</span><span class="p">(</span>
                <span class="n">restyle_data</span><span class="o">=</span><span class="n">restyle_changes</span><span class="p">,</span>
                <span class="n">relayout_data</span><span class="o">=</span><span class="n">relayout_changes</span><span class="p">,</span>
                <span class="n">trace_indexes</span><span class="o">=</span><span class="n">trace_indexes</span><span class="p">,</span>
                <span class="o">**</span><span class="n">msg_kwargs</span>
            <span class="p">)</span>

        <span class="c1"># Dispatch changes</span>
        <span class="c1"># ----------------</span>
        <span class="c1"># ### Dispatch restyle changes ###</span>
        <span class="k">if</span> <span class="n">restyle_changes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dispatch_trace_change_callbacks</span><span class="p">(</span><span class="n">restyle_changes</span><span class="p">,</span> <span class="n">trace_indexes</span><span class="p">)</span>

        <span class="c1"># ### Dispatch relayout changes ###</span>
        <span class="k">if</span> <span class="n">relayout_changes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dispatch_layout_change_callbacks</span><span class="p">(</span><span class="n">relayout_changes</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_perform_plotly_update</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">restyle_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">relayout_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">trace_indexes</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>

        <span class="c1"># Check for early exist</span>
        <span class="c1"># ---------------------</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">restyle_data</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">relayout_data</span><span class="p">:</span>
            <span class="c1"># Nothing to do</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

        <span class="c1"># Normalize input</span>
        <span class="c1"># ---------------</span>
        <span class="k">if</span> <span class="n">restyle_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">restyle_data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">relayout_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">relayout_data</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">trace_indexes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalize_trace_indexes</span><span class="p">(</span><span class="n">trace_indexes</span><span class="p">)</span>

        <span class="c1"># Perform relayout</span>
        <span class="c1"># ----------------</span>
        <span class="n">relayout_changes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_perform_plotly_relayout</span><span class="p">(</span><span class="n">relayout_data</span><span class="p">)</span>

        <span class="c1"># Perform restyle</span>
        <span class="c1"># ---------------</span>
        <span class="n">restyle_changes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_perform_plotly_restyle</span><span class="p">(</span><span class="n">restyle_data</span><span class="p">,</span> <span class="n">trace_indexes</span><span class="p">)</span>

        <span class="c1"># Return changes</span>
        <span class="c1"># --------------</span>
        <span class="k">return</span> <span class="n">restyle_changes</span><span class="p">,</span> <span class="n">relayout_changes</span><span class="p">,</span> <span class="n">trace_indexes</span>

    <span class="c1"># Plotly message stubs</span>
    <span class="c1"># --------------------</span>
    <span class="c1"># send-message stubs that may be overridden by the widget subclass</span>
    <span class="k">def</span> <span class="nf">_send_addTraces_msg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_traces_data</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">_send_moveTraces_msg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">current_inds</span><span class="p">,</span> <span class="n">new_inds</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">_send_deleteTraces_msg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">delete_inds</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">_send_restyle_msg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="n">trace_indexes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">source_view_id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">_send_relayout_msg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layout</span><span class="p">,</span> <span class="n">source_view_id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">_send_update_msg</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">restyle_data</span><span class="p">,</span> <span class="n">relayout_data</span><span class="p">,</span> <span class="n">trace_indexes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">source_view_id</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">_send_animate_msg</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">styles_data</span><span class="p">,</span> <span class="n">relayout_data</span><span class="p">,</span> <span class="n">trace_indexes</span><span class="p">,</span> <span class="n">animation_opts</span>
    <span class="p">):</span>
        <span class="k">pass</span>

    <span class="c1"># Context managers</span>
    <span class="c1"># ----------------</span>
    <span class="nd">@contextmanager</span>
    <span class="k">def</span> <span class="nf">batch_update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A context manager that batches up trace and layout assignment</span>
<span class="sd">        operations into a singe plotly_update message that is executed when</span>
<span class="sd">        the context exits.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        For example, suppose we have a figure widget, `fig`, with a single</span>
<span class="sd">        trace.</span>

<span class="sd">        &gt;&gt;&gt; import plotly.graph_objs as go</span>
<span class="sd">        &gt;&gt;&gt; fig = go.FigureWidget(data=[{&#39;y&#39;: [3, 4, 2]}])</span>

<span class="sd">        If we want to update the xaxis range, the yaxis range, and the</span>
<span class="sd">        marker color, we could do so using a series of three property</span>
<span class="sd">        assignments as follows:</span>

<span class="sd">        &gt;&gt;&gt; fig.layout.xaxis.range = [0, 5]</span>
<span class="sd">        &gt;&gt;&gt; fig.layout.yaxis.range = [0, 10]</span>
<span class="sd">        &gt;&gt;&gt; fig.data[0].marker.color = &#39;green&#39;</span>

<span class="sd">        This will work, however it will result in three messages being</span>
<span class="sd">        sent to the front end (two relayout messages for the axis range</span>
<span class="sd">        updates followed by one restyle message for the marker color</span>
<span class="sd">        update). This can cause the plot to appear to stutter as the</span>
<span class="sd">        three updates are applied incrementally.</span>

<span class="sd">        We can avoid this problem by performing these three assignments in a</span>
<span class="sd">        `batch_update` context as follows:</span>

<span class="sd">        &gt;&gt;&gt; with fig.batch_update():</span>
<span class="sd">        ...     fig.layout.xaxis.range = [0, 5]</span>
<span class="sd">        ...     fig.layout.yaxis.range = [0, 10]</span>
<span class="sd">        ...     fig.data[0].marker.color = &#39;green&#39;</span>

<span class="sd">        Now, these three property updates will be sent to the frontend in a</span>
<span class="sd">        single update message, and they will be applied by the front end</span>
<span class="sd">        simultaneously.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_in_batch_mode</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">yield</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_in_batch_mode</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">yield</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="c1"># ### Disable batch mode ###</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_in_batch_mode</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="c1"># ### Build plotly_update params ###</span>
                <span class="p">(</span>
                    <span class="n">restyle_data</span><span class="p">,</span>
                    <span class="n">relayout_data</span><span class="p">,</span>
                    <span class="n">trace_indexes</span><span class="p">,</span>
                <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_update_params_from_batch</span><span class="p">()</span>

                <span class="c1"># ### Call plotly_update ###</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plotly_update</span><span class="p">(</span>
                    <span class="n">restyle_data</span><span class="o">=</span><span class="n">restyle_data</span><span class="p">,</span>
                    <span class="n">relayout_data</span><span class="o">=</span><span class="n">relayout_data</span><span class="p">,</span>
                    <span class="n">trace_indexes</span><span class="o">=</span><span class="n">trace_indexes</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="c1"># ### Clear out saved batch edits ###</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_batch_layout_edits</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_batch_trace_edits</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_build_update_params_from_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert `_batch_trace_edits` and `_batch_layout_edits` into the</span>
<span class="sd">        `restyle_data`, `relayout_data`, and `trace_indexes` params accepted</span>
<span class="sd">        by the `plotly_update` method.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        (dict, dict, list[int])</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Handle Style / Trace Indexes</span>
        <span class="c1"># ----------------------------</span>
        <span class="n">batch_style_commands</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_batch_trace_edits</span>
        <span class="n">trace_indexes</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">trace_ind</span> <span class="k">for</span> <span class="n">trace_ind</span> <span class="ow">in</span> <span class="n">batch_style_commands</span><span class="p">]))</span>

        <span class="n">all_props</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
            <span class="nb">set</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">prop</span>
                    <span class="k">for</span> <span class="n">trace_style</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_batch_trace_edits</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">prop</span> <span class="ow">in</span> <span class="n">trace_style</span>
                <span class="p">]</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Initialize restyle_data dict with all values undefined</span>
        <span class="n">restyle_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">prop</span><span class="p">:</span> <span class="p">[</span><span class="n">Undefined</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">trace_indexes</span><span class="p">))]</span> <span class="k">for</span> <span class="n">prop</span> <span class="ow">in</span> <span class="n">all_props</span>
        <span class="p">}</span>

        <span class="c1"># Fill in values</span>
        <span class="k">for</span> <span class="n">trace_ind</span><span class="p">,</span> <span class="n">trace_style</span> <span class="ow">in</span> <span class="n">batch_style_commands</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">trace_prop</span><span class="p">,</span> <span class="n">trace_val</span> <span class="ow">in</span> <span class="n">trace_style</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">restyle_trace_index</span> <span class="o">=</span> <span class="n">trace_indexes</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">trace_ind</span><span class="p">)</span>
                <span class="n">restyle_data</span><span class="p">[</span><span class="n">trace_prop</span><span class="p">][</span><span class="n">restyle_trace_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">trace_val</span>

        <span class="c1"># Handle Layout</span>
        <span class="c1"># -------------</span>
        <span class="n">relayout_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_batch_layout_edits</span>

        <span class="c1"># Return plotly_update params</span>
        <span class="c1"># ---------------------------</span>
        <span class="k">return</span> <span class="n">restyle_data</span><span class="p">,</span> <span class="n">relayout_data</span><span class="p">,</span> <span class="n">trace_indexes</span>

    <span class="nd">@contextmanager</span>
    <span class="k">def</span> <span class="nf">batch_animate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">easing</span><span class="o">=</span><span class="s2">&quot;cubic-in-out&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Context manager to animate trace / layout updates</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        duration : number</span>
<span class="sd">            The duration of the transition, in milliseconds.</span>
<span class="sd">            If equal to zero, updates are synchronous.</span>
<span class="sd">        easing : string</span>
<span class="sd">            The easing function used for the transition.</span>
<span class="sd">            One of:</span>
<span class="sd">                - linear</span>
<span class="sd">                - quad</span>
<span class="sd">                - cubic</span>
<span class="sd">                - sin</span>
<span class="sd">                - exp</span>
<span class="sd">                - circle</span>
<span class="sd">                - elastic</span>
<span class="sd">                - back</span>
<span class="sd">                - bounce</span>
<span class="sd">                - linear-in</span>
<span class="sd">                - quad-in</span>
<span class="sd">                - cubic-in</span>
<span class="sd">                - sin-in</span>
<span class="sd">                - exp-in</span>
<span class="sd">                - circle-in</span>
<span class="sd">                - elastic-in</span>
<span class="sd">                - back-in</span>
<span class="sd">                - bounce-in</span>
<span class="sd">                - linear-out</span>
<span class="sd">                - quad-out</span>
<span class="sd">                - cubic-out</span>
<span class="sd">                - sin-out</span>
<span class="sd">                - exp-out</span>
<span class="sd">                - circle-out</span>
<span class="sd">                - elastic-out</span>
<span class="sd">                - back-out</span>
<span class="sd">                - bounce-out</span>
<span class="sd">                - linear-in-out</span>
<span class="sd">                - quad-in-out</span>
<span class="sd">                - cubic-in-out</span>
<span class="sd">                - sin-in-out</span>
<span class="sd">                - exp-in-out</span>
<span class="sd">                - circle-in-out</span>
<span class="sd">                - elastic-in-out</span>
<span class="sd">                - back-in-out</span>
<span class="sd">                - bounce-in-out</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        Suppose we have a figure widget, `fig`, with a single trace.</span>

<span class="sd">        &gt;&gt;&gt; import plotly.graph_objs as go</span>
<span class="sd">        &gt;&gt;&gt; fig = go.FigureWidget(data=[{&#39;y&#39;: [3, 4, 2]}])</span>

<span class="sd">        1) Animate a change in the xaxis and yaxis ranges using default</span>
<span class="sd">        duration and easing parameters.</span>

<span class="sd">        &gt;&gt;&gt; with fig.batch_animate():</span>
<span class="sd">        ...     fig.layout.xaxis.range = [0, 5]</span>
<span class="sd">        ...     fig.layout.yaxis.range = [0, 10]</span>

<span class="sd">        2) Animate a change in the size and color of the trace&#39;s markers</span>
<span class="sd">        over 2 seconds using the elastic-in-out easing method</span>

<span class="sd">        &gt;&gt;&gt; with fig.batch_animate(duration=2000, easing=&#39;elastic-in-out&#39;):</span>
<span class="sd">        ...     fig.data[0].marker.color = &#39;green&#39;</span>
<span class="sd">        ...     fig.data[0].marker.size = 20</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Validate inputs</span>
        <span class="c1"># ---------------</span>
        <span class="n">duration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_animation_duration_validator</span><span class="o">.</span><span class="n">validate_coerce</span><span class="p">(</span><span class="n">duration</span><span class="p">)</span>
        <span class="n">easing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_animation_easing_validator</span><span class="o">.</span><span class="n">validate_coerce</span><span class="p">(</span><span class="n">easing</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_in_batch_mode</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">yield</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_in_batch_mode</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">yield</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="c1"># Exit batch mode</span>
                <span class="c1"># ---------------</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_in_batch_mode</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="c1"># Apply batch animate</span>
                <span class="c1"># -------------------</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_perform_batch_animate</span><span class="p">(</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;transition&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;duration&quot;</span><span class="p">:</span> <span class="n">duration</span><span class="p">,</span> <span class="s2">&quot;easing&quot;</span><span class="p">:</span> <span class="n">easing</span><span class="p">},</span>
                        <span class="s2">&quot;frame&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;duration&quot;</span><span class="p">:</span> <span class="n">duration</span><span class="p">},</span>
                    <span class="p">}</span>
                <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_perform_batch_animate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">animation_opts</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Perform the batch animate operation</span>

<span class="sd">        This method should be called with the batch_animate() context</span>
<span class="sd">        manager exits.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        animation_opts : dict</span>
<span class="sd">            Animation options as accepted by frontend Plotly.animation command</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Apply commands to internal dictionaries as an update</span>
        <span class="c1"># ----------------------------------------------------</span>
        <span class="p">(</span>
            <span class="n">restyle_data</span><span class="p">,</span>
            <span class="n">relayout_data</span><span class="p">,</span>
            <span class="n">trace_indexes</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_update_params_from_batch</span><span class="p">()</span>

        <span class="p">(</span>
            <span class="n">restyle_changes</span><span class="p">,</span>
            <span class="n">relayout_changes</span><span class="p">,</span>
            <span class="n">trace_indexes</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_perform_plotly_update</span><span class="p">(</span><span class="n">restyle_data</span><span class="p">,</span> <span class="n">relayout_data</span><span class="p">,</span> <span class="n">trace_indexes</span><span class="p">)</span>

        <span class="c1"># Convert style / trace_indexes into animate form</span>
        <span class="c1"># -----------------------------------------------</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_batch_trace_edits</span><span class="p">:</span>
            <span class="n">animate_styles</span><span class="p">,</span> <span class="n">animate_trace_indexes</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span>
                <span class="o">*</span><span class="p">[</span>
                    <span class="p">(</span><span class="n">trace_style</span><span class="p">,</span> <span class="n">trace_index</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">trace_index</span><span class="p">,</span> <span class="n">trace_style</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_batch_trace_edits</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="p">]</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">animate_styles</span><span class="p">,</span> <span class="n">animate_trace_indexes</span> <span class="o">=</span> <span class="p">{},</span> <span class="p">[]</span>

        <span class="n">animate_layout</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_batch_layout_edits</span><span class="p">)</span>

        <span class="c1"># Send animate message</span>
        <span class="c1"># --------------------</span>
        <span class="c1"># Sends animate message to the front end (if any)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_send_animate_msg</span><span class="p">(</span>
            <span class="n">styles_data</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">animate_styles</span><span class="p">),</span>
            <span class="n">relayout_data</span><span class="o">=</span><span class="n">animate_layout</span><span class="p">,</span>
            <span class="n">trace_indexes</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">animate_trace_indexes</span><span class="p">),</span>
            <span class="n">animation_opts</span><span class="o">=</span><span class="n">animation_opts</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Clear batched commands</span>
        <span class="c1"># ----------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_batch_layout_edits</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_batch_trace_edits</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="c1"># Dispatch callbacks</span>
        <span class="c1"># ------------------</span>
        <span class="c1"># ### Dispatch restyle changes ###</span>
        <span class="k">if</span> <span class="n">restyle_changes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dispatch_trace_change_callbacks</span><span class="p">(</span><span class="n">restyle_changes</span><span class="p">,</span> <span class="n">trace_indexes</span><span class="p">)</span>

        <span class="c1"># ### Dispatch relayout changes ###</span>
        <span class="k">if</span> <span class="n">relayout_changes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dispatch_layout_change_callbacks</span><span class="p">(</span><span class="n">relayout_changes</span><span class="p">)</span>

    <span class="c1"># Exports</span>
    <span class="c1"># -------</span>
    <span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert figure to a dictionary</span>

<span class="sd">        Note: the dictionary includes the properties explicitly set by the</span>
<span class="sd">        user, it does not include default values of unspecified properties</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Handle data</span>
        <span class="c1"># -----------</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>

        <span class="c1"># Handle layout</span>
        <span class="c1"># -------------</span>
        <span class="n">layout</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_layout</span><span class="p">)</span>

        <span class="c1"># Handle frames</span>
        <span class="c1"># -------------</span>
        <span class="c1"># Frame key is only added if there are any frames</span>
        <span class="n">res</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">data</span><span class="p">,</span> <span class="s2">&quot;layout&quot;</span><span class="p">:</span> <span class="n">layout</span><span class="p">}</span>
        <span class="n">frames</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">([</span><span class="n">frame</span><span class="o">.</span><span class="n">_props</span> <span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_frame_objs</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">frames</span><span class="p">:</span>
            <span class="n">res</span><span class="p">[</span><span class="s2">&quot;frames&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">frames</span>

        <span class="k">return</span> <span class="n">res</span>

    <span class="k">def</span> <span class="nf">to_plotly_json</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert figure to a JSON representation as a Python dict</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_to_ordered_dict</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">skip_uid</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Static helper for converting dict or list to structure of ordered</span>
<span class="sd">        dictionaries</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="c1"># d is a dict</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">OrderedDict</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="k">if</span> <span class="n">skip_uid</span> <span class="ow">and</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;uid&quot;</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">BaseFigure</span><span class="o">.</span><span class="n">_to_ordered_dict</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">skip_uid</span><span class="o">=</span><span class="n">skip_uid</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="n">d</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="c1"># d is a list of dicts</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="n">BaseFigure</span><span class="o">.</span><span class="n">_to_ordered_dict</span><span class="p">(</span><span class="n">el</span><span class="p">,</span> <span class="n">skip_uid</span><span class="o">=</span><span class="n">skip_uid</span><span class="p">)</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">d</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">d</span>

        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">to_ordered_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">skip_uid</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>

        <span class="c1"># Initialize resulting OrderedDict</span>
        <span class="c1"># --------------------------------</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">OrderedDict</span><span class="p">()</span>

        <span class="c1"># Handle data</span>
        <span class="c1"># -----------</span>
        <span class="n">result</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">BaseFigure</span><span class="o">.</span><span class="n">_to_ordered_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="n">skip_uid</span><span class="o">=</span><span class="n">skip_uid</span><span class="p">)</span>

        <span class="c1"># Handle layout</span>
        <span class="c1"># -------------</span>
        <span class="n">result</span><span class="p">[</span><span class="s2">&quot;layout&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">BaseFigure</span><span class="o">.</span><span class="n">_to_ordered_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_layout</span><span class="p">)</span>

        <span class="c1"># Handle frames</span>
        <span class="c1"># -------------</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_frame_objs</span><span class="p">:</span>
            <span class="n">frames_props</span> <span class="o">=</span> <span class="p">[</span><span class="n">frame</span><span class="o">.</span><span class="n">_props</span> <span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_frame_objs</span><span class="p">]</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;frames&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">BaseFigure</span><span class="o">.</span><span class="n">_to_ordered_dict</span><span class="p">(</span><span class="n">frames_props</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span>

    <span class="c1"># plotly.io methods</span>
    <span class="c1"># -----------------</span>
    <span class="c1"># Note that docstrings are auto-generated in plotly/_docstring_gen.py</span>
    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Show a figure using either the default renderer(s) or the renderer(s)</span>
<span class="sd">        specified by the renderer argument</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        renderer: str or None (default None)</span>
<span class="sd">            A string containing the names of one or more registered renderers</span>
<span class="sd">            (separated by &#39;+&#39; characters) or None.  If None, then the default</span>
<span class="sd">            renderers specified in plotly.io.renderers.default are used.</span>

<span class="sd">        validate: bool (default True)</span>
<span class="sd">            True if the figure should be validated before being shown,</span>
<span class="sd">            False otherwise.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">plotly.io</span> <span class="k">as</span> <span class="nn">pio</span>

        <span class="k">return</span> <span class="n">pio</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">to_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert a figure to a JSON string representation</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        validate: bool (default True)</span>
<span class="sd">            True if the figure should be validated before being converted to</span>
<span class="sd">            JSON, False otherwise.</span>

<span class="sd">        pretty: bool (default False)</span>
<span class="sd">            True if JSON representation should be pretty-printed, False if</span>
<span class="sd">            representation should be as compact as possible.</span>

<span class="sd">        remove_uids: bool (default True)</span>
<span class="sd">            True if trace UIDs should be omitted from the JSON representation</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            Representation of figure as a JSON string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">plotly.io</span> <span class="k">as</span> <span class="nn">pio</span>

        <span class="k">return</span> <span class="n">pio</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">full_figure_for_development</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">warn</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">as_dict</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute default values for all attributes not specified in the input figure and</span>
<span class="sd">        returns the output as a &quot;full&quot; figure. This function calls Plotly.js via Kaleido</span>
<span class="sd">        to populate unspecified attributes. This function is intended for interactive use</span>
<span class="sd">        during development to learn more about how Plotly.js computes default values and is</span>
<span class="sd">        not generally necessary or recommended for production use.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        fig:</span>
<span class="sd">            Figure object or dict representing a figure</span>

<span class="sd">        warn: bool</span>
<span class="sd">            If False, suppress warnings about not using this in production.</span>

<span class="sd">        as_dict: bool</span>
<span class="sd">            If True, output is a dict with some keys that go.Figure can&#39;t parse.</span>
<span class="sd">            If False, output is a go.Figure with unparseable keys skipped.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        plotly.graph_objects.Figure or dict</span>
<span class="sd">            The full figure</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">plotly.io</span> <span class="k">as</span> <span class="nn">pio</span>

        <span class="k">return</span> <span class="n">pio</span><span class="o">.</span><span class="n">full_figure_for_development</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">warn</span><span class="p">,</span> <span class="n">as_dict</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">write_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert a figure to JSON and write it to a file or writeable</span>
<span class="sd">        object</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        file: str or writeable</span>
<span class="sd">            A string representing a local file path or a writeable object</span>
<span class="sd">            (e.g. an open file descriptor)</span>

<span class="sd">        pretty: bool (default False)</span>
<span class="sd">            True if JSON representation should be pretty-printed, False if</span>
<span class="sd">            representation should be as compact as possible.</span>

<span class="sd">        remove_uids: bool (default True)</span>
<span class="sd">            True if trace UIDs should be omitted from the JSON representation</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">plotly.io</span> <span class="k">as</span> <span class="nn">pio</span>

        <span class="k">return</span> <span class="n">pio</span><span class="o">.</span><span class="n">write_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">to_html</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert a figure to an HTML string representation.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        config: dict or None (default None)</span>
<span class="sd">            Plotly.js figure config options</span>
<span class="sd">        auto_play: bool (default=True)</span>
<span class="sd">            Whether to automatically start the animation sequence on page load</span>
<span class="sd">            if the figure contains frames. Has no effect if the figure does not</span>
<span class="sd">            contain frames.</span>
<span class="sd">        include_plotlyjs: bool or string (default True)</span>
<span class="sd">            Specifies how the plotly.js library is included/loaded in the output</span>
<span class="sd">            div string.</span>

<span class="sd">            If True, a script tag containing the plotly.js source code (~3MB)</span>
<span class="sd">            is included in the output.  HTML files generated with this option are</span>
<span class="sd">            fully self-contained and can be used offline.</span>

<span class="sd">            If &#39;cdn&#39;, a script tag that references the plotly.js CDN is included</span>
<span class="sd">            in the output. HTML files generated with this option are about 3MB</span>
<span class="sd">            smaller than those generated with include_plotlyjs=True, but they</span>
<span class="sd">            require an active internet connection in order to load the plotly.js</span>
<span class="sd">            library.</span>

<span class="sd">            If &#39;directory&#39;, a script tag is included that references an external</span>
<span class="sd">            plotly.min.js bundle that is assumed to reside in the same</span>
<span class="sd">            directory as the HTML file.</span>

<span class="sd">            If &#39;require&#39;, Plotly.js is loaded using require.js.  This option</span>
<span class="sd">            assumes that require.js is globally available and that it has been</span>
<span class="sd">            globally configured to know how to find Plotly.js as &#39;plotly&#39;.</span>
<span class="sd">            This option is not advised when full_html=True as it will result</span>
<span class="sd">            in a non-functional html file.</span>

<span class="sd">            If a string that ends in &#39;.js&#39;, a script tag is included that</span>
<span class="sd">            references the specified path. This approach can be used to point</span>
<span class="sd">            the resulting HTML file to an alternative CDN or local bundle.</span>

<span class="sd">            If False, no script tag referencing plotly.js is included. This is</span>
<span class="sd">            useful when the resulting div string will be placed inside an HTML</span>
<span class="sd">            document that already loads plotly.js. This option is not advised</span>
<span class="sd">            when full_html=True as it will result in a non-functional html file.</span>
<span class="sd">        include_mathjax: bool or string (default False)</span>
<span class="sd">            Specifies how the MathJax.js library is included in the output html</span>
<span class="sd">            div string.  MathJax is required in order to display labels</span>
<span class="sd">            with LaTeX typesetting.</span>

<span class="sd">            If False, no script tag referencing MathJax.js will be included in the</span>
<span class="sd">            output.</span>

<span class="sd">            If &#39;cdn&#39;, a script tag that references a MathJax CDN location will be</span>
<span class="sd">            included in the output.  HTML div strings generated with this option</span>
<span class="sd">            will be able to display LaTeX typesetting as long as internet access</span>
<span class="sd">            is available.</span>

<span class="sd">            If a string that ends in &#39;.js&#39;, a script tag is included that</span>
<span class="sd">            references the specified path. This approach can be used to point the</span>
<span class="sd">            resulting HTML div string to an alternative CDN.</span>
<span class="sd">        post_script: str or list or None (default None)</span>
<span class="sd">            JavaScript snippet(s) to be included in the resulting div just after</span>
<span class="sd">            plot creation.  The string(s) may include &#39;{plot_id}&#39; placeholders</span>
<span class="sd">            that will then be replaced by the `id` of the div element that the</span>
<span class="sd">            plotly.js figure is associated with.  One application for this script</span>
<span class="sd">            is to install custom plotly.js event handlers.</span>
<span class="sd">        full_html: bool (default True)</span>
<span class="sd">            If True, produce a string containing a complete HTML document</span>
<span class="sd">            starting with an &lt;html&gt; tag.  If False, produce a string containing</span>
<span class="sd">            a single &lt;div&gt; element.</span>
<span class="sd">        animation_opts: dict or None (default None)</span>
<span class="sd">            dict of custom animation parameters to be passed to the function</span>
<span class="sd">            Plotly.animate in Plotly.js. See</span>
<span class="sd">            https://github.com/plotly/plotly.js/blob/master/src/plots/animation_attributes.js</span>
<span class="sd">            for available options. Has no effect if the figure does not contain</span>
<span class="sd">            frames, or auto_play is False.</span>
<span class="sd">        default_width, default_height: number or str (default &#39;100%&#39;)</span>
<span class="sd">            The default figure width/height to use if the provided figure does not</span>
<span class="sd">            specify its own layout.width/layout.height property.  May be</span>
<span class="sd">            specified in pixels as an integer (e.g. 500), or as a css width style</span>
<span class="sd">            string (e.g. &#39;500px&#39;, &#39;100%&#39;).</span>
<span class="sd">        validate: bool (default True)</span>
<span class="sd">            True if the figure should be validated before being converted to</span>
<span class="sd">            JSON, False otherwise.</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            Representation of figure as an HTML div string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">plotly.io</span> <span class="k">as</span> <span class="nn">pio</span>

        <span class="k">return</span> <span class="n">pio</span><span class="o">.</span><span class="n">to_html</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">write_html</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write a figure to an HTML file representation</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        file: str or writeable</span>
<span class="sd">            A string representing a local file path or a writeable object</span>
<span class="sd">            (e.g. an open file descriptor)</span>
<span class="sd">        config: dict or None (default None)</span>
<span class="sd">            Plotly.js figure config options</span>
<span class="sd">        auto_play: bool (default=True)</span>
<span class="sd">            Whether to automatically start the animation sequence on page load</span>
<span class="sd">            if the figure contains frames. Has no effect if the figure does not</span>
<span class="sd">            contain frames.</span>
<span class="sd">        include_plotlyjs: bool or string (default True)</span>
<span class="sd">            Specifies how the plotly.js library is included/loaded in the output</span>
<span class="sd">            div string.</span>

<span class="sd">            If True, a script tag containing the plotly.js source code (~3MB)</span>
<span class="sd">            is included in the output.  HTML files generated with this option are</span>
<span class="sd">            fully self-contained and can be used offline.</span>

<span class="sd">            If &#39;cdn&#39;, a script tag that references the plotly.js CDN is included</span>
<span class="sd">            in the output. HTML files generated with this option are about 3MB</span>
<span class="sd">            smaller than those generated with include_plotlyjs=True, but they</span>
<span class="sd">            require an active internet connection in order to load the plotly.js</span>
<span class="sd">            library.</span>

<span class="sd">            If &#39;directory&#39;, a script tag is included that references an external</span>
<span class="sd">            plotly.min.js bundle that is assumed to reside in the same</span>
<span class="sd">            directory as the HTML file. If `file` is a string to a local file path</span>
<span class="sd">            and `full_html` is True then</span>

<span class="sd">            If &#39;directory&#39;, a script tag is included that references an external</span>
<span class="sd">            plotly.min.js bundle that is assumed to reside in the same</span>
<span class="sd">            directory as the HTML file.  If `file` is a string to a local file</span>
<span class="sd">            path and `full_html` is True, then the plotly.min.js bundle is copied</span>
<span class="sd">            into the directory of the resulting HTML file. If a file named</span>
<span class="sd">            plotly.min.js already exists in the output directory then this file</span>
<span class="sd">            is left unmodified and no copy is performed. HTML files generated</span>
<span class="sd">            with this option can be used offline, but they require a copy of</span>
<span class="sd">            the plotly.min.js bundle in the same directory. This option is</span>
<span class="sd">            useful when many figures will be saved as HTML files in the same</span>
<span class="sd">            directory because the plotly.js source code will be included only</span>
<span class="sd">            once per output directory, rather than once per output file.</span>

<span class="sd">            If &#39;require&#39;, Plotly.js is loaded using require.js.  This option</span>
<span class="sd">            assumes that require.js is globally available and that it has been</span>
<span class="sd">            globally configured to know how to find Plotly.js as &#39;plotly&#39;.</span>
<span class="sd">            This option is not advised when full_html=True as it will result</span>
<span class="sd">            in a non-functional html file.</span>

<span class="sd">            If a string that ends in &#39;.js&#39;, a script tag is included that</span>
<span class="sd">            references the specified path. This approach can be used to point</span>
<span class="sd">            the resulting HTML file to an alternative CDN or local bundle.</span>

<span class="sd">            If False, no script tag referencing plotly.js is included. This is</span>
<span class="sd">            useful when the resulting div string will be placed inside an HTML</span>
<span class="sd">            document that already loads plotly.js.  This option is not advised</span>
<span class="sd">            when full_html=True as it will result in a non-functional html file.</span>

<span class="sd">        include_mathjax: bool or string (default False)</span>
<span class="sd">            Specifies how the MathJax.js library is included in the output html</span>
<span class="sd">            div string.  MathJax is required in order to display labels</span>
<span class="sd">            with LaTeX typesetting.</span>

<span class="sd">            If False, no script tag referencing MathJax.js will be included in the</span>
<span class="sd">            output.</span>

<span class="sd">            If &#39;cdn&#39;, a script tag that references a MathJax CDN location will be</span>
<span class="sd">            included in the output.  HTML div strings generated with this option</span>
<span class="sd">            will be able to display LaTeX typesetting as long as internet access</span>
<span class="sd">            is available.</span>

<span class="sd">            If a string that ends in &#39;.js&#39;, a script tag is included that</span>
<span class="sd">            references the specified path. This approach can be used to point the</span>
<span class="sd">            resulting HTML div string to an alternative CDN.</span>
<span class="sd">        post_script: str or list or None (default None)</span>
<span class="sd">            JavaScript snippet(s) to be included in the resulting div just after</span>
<span class="sd">            plot creation.  The string(s) may include &#39;{plot_id}&#39; placeholders</span>
<span class="sd">            that will then be replaced by the `id` of the div element that the</span>
<span class="sd">            plotly.js figure is associated with.  One application for this script</span>
<span class="sd">            is to install custom plotly.js event handlers.</span>
<span class="sd">        full_html: bool (default True)</span>
<span class="sd">            If True, produce a string containing a complete HTML document</span>
<span class="sd">            starting with an &lt;html&gt; tag.  If False, produce a string containing</span>
<span class="sd">            a single &lt;div&gt; element.</span>
<span class="sd">        animation_opts: dict or None (default None)</span>
<span class="sd">            dict of custom animation parameters to be passed to the function</span>
<span class="sd">            Plotly.animate in Plotly.js. See</span>
<span class="sd">            https://github.com/plotly/plotly.js/blob/master/src/plots/animation_attributes.js</span>
<span class="sd">            for available options. Has no effect if the figure does not contain</span>
<span class="sd">            frames, or auto_play is False.</span>
<span class="sd">        default_width, default_height: number or str (default &#39;100%&#39;)</span>
<span class="sd">            The default figure width/height to use if the provided figure does not</span>
<span class="sd">            specify its own layout.width/layout.height property.  May be</span>
<span class="sd">            specified in pixels as an integer (e.g. 500), or as a css width style</span>
<span class="sd">            string (e.g. &#39;500px&#39;, &#39;100%&#39;).</span>
<span class="sd">        validate: bool (default True)</span>
<span class="sd">            True if the figure should be validated before being converted to</span>
<span class="sd">            JSON, False otherwise.</span>
<span class="sd">        auto_open: bool (default True</span>
<span class="sd">            If True, open the saved file in a web browser after saving.</span>
<span class="sd">            This argument only applies if `full_html` is True.</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            Representation of figure as an HTML div string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">plotly.io</span> <span class="k">as</span> <span class="nn">pio</span>

        <span class="k">return</span> <span class="n">pio</span><span class="o">.</span><span class="n">write_html</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">to_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert a figure to a static image bytes string</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        format: str or None</span>
<span class="sd">            The desired image format. One of</span>
<span class="sd">              - &#39;png&#39;</span>
<span class="sd">              - &#39;jpg&#39; or &#39;jpeg&#39;</span>
<span class="sd">              - &#39;webp&#39;</span>
<span class="sd">              - &#39;svg&#39;</span>
<span class="sd">              - &#39;pdf&#39;</span>
<span class="sd">              - &#39;eps&#39; (Requires the poppler library to be installed)</span>

<span class="sd">            If not specified, will default to `plotly.io.config.default_format`</span>

<span class="sd">        width: int or None</span>
<span class="sd">            The width of the exported image in layout pixels. If the `scale`</span>
<span class="sd">            property is 1.0, this will also be the width of the exported image</span>
<span class="sd">            in physical pixels.</span>

<span class="sd">            If not specified, will default to `plotly.io.config.default_width`</span>

<span class="sd">        height: int or None</span>
<span class="sd">            The height of the exported image in layout pixels. If the `scale`</span>
<span class="sd">            property is 1.0, this will also be the height of the exported image</span>
<span class="sd">            in physical pixels.</span>

<span class="sd">            If not specified, will default to `plotly.io.config.default_height`</span>

<span class="sd">        scale: int or float or None</span>
<span class="sd">            The scale factor to use when exporting the figure. A scale factor</span>
<span class="sd">            larger than 1.0 will increase the image resolution with respect</span>
<span class="sd">            to the figure&#39;s layout pixel dimensions. Whereas as scale factor of</span>
<span class="sd">            less than 1.0 will decrease the image resolution.</span>

<span class="sd">            If not specified, will default to `plotly.io.config.default_scale`</span>

<span class="sd">        validate: bool</span>
<span class="sd">            True if the figure should be validated before being converted to</span>
<span class="sd">            an image, False otherwise.</span>

<span class="sd">        engine: str</span>
<span class="sd">            Image export engine to use:</span>
<span class="sd">             - &quot;kaleido&quot;: Use Kaleido for image export</span>
<span class="sd">             - &quot;orca&quot;: Use Orca for image export</span>
<span class="sd">             - &quot;auto&quot; (default): Use Kaleido if installed, otherwise use orca</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bytes</span>
<span class="sd">            The image data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">plotly.io</span> <span class="k">as</span> <span class="nn">pio</span>

        <span class="k">return</span> <span class="n">pio</span><span class="o">.</span><span class="n">to_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">write_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert a figure to a static image and write it to a file or writeable</span>
<span class="sd">        object</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        file: str or writeable</span>
<span class="sd">            A string representing a local file path or a writeable object</span>
<span class="sd">            (e.g. an open file descriptor)</span>

<span class="sd">        format: str or None</span>
<span class="sd">            The desired image format. One of</span>
<span class="sd">              - &#39;png&#39;</span>
<span class="sd">              - &#39;jpg&#39; or &#39;jpeg&#39;</span>
<span class="sd">              - &#39;webp&#39;</span>
<span class="sd">              - &#39;svg&#39;</span>
<span class="sd">              - &#39;pdf&#39;</span>
<span class="sd">              - &#39;eps&#39; (Requires the poppler library to be installed)</span>

<span class="sd">            If not specified and `file` is a string then this will default to the</span>
<span class="sd">            file extension. If not specified and `file` is not a string then this</span>
<span class="sd">            will default to `plotly.io.config.default_format`</span>

<span class="sd">        width: int or None</span>
<span class="sd">            The width of the exported image in layout pixels. If the `scale`</span>
<span class="sd">            property is 1.0, this will also be the width of the exported image</span>
<span class="sd">            in physical pixels.</span>

<span class="sd">            If not specified, will default to `plotly.io.config.default_width`</span>

<span class="sd">        height: int or None</span>
<span class="sd">            The height of the exported image in layout pixels. If the `scale`</span>
<span class="sd">            property is 1.0, this will also be the height of the exported image</span>
<span class="sd">            in physical pixels.</span>

<span class="sd">            If not specified, will default to `plotly.io.config.default_height`</span>

<span class="sd">        scale: int or float or None</span>
<span class="sd">            The scale factor to use when exporting the figure. A scale factor</span>
<span class="sd">            larger than 1.0 will increase the image resolution with respect</span>
<span class="sd">            to the figure&#39;s layout pixel dimensions. Whereas as scale factor of</span>
<span class="sd">            less than 1.0 will decrease the image resolution.</span>

<span class="sd">            If not specified, will default to `plotly.io.config.default_scale`</span>

<span class="sd">        validate: bool</span>
<span class="sd">            True if the figure should be validated before being converted to</span>
<span class="sd">            an image, False otherwise.</span>

<span class="sd">        engine: str</span>
<span class="sd">            Image export engine to use:</span>
<span class="sd">             - &quot;kaleido&quot;: Use Kaleido for image export</span>
<span class="sd">             - &quot;orca&quot;: Use Orca for image export</span>
<span class="sd">             - &quot;auto&quot; (default): Use Kaleido if installed, otherwise use orca</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">plotly.io</span> <span class="k">as</span> <span class="nn">pio</span>

        <span class="k">return</span> <span class="n">pio</span><span class="o">.</span><span class="n">write_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1"># Static helpers</span>
    <span class="c1"># --------------</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_is_dict_list</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return true of the input object is a list of dicts</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">dict</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_perform_update</span><span class="p">(</span><span class="n">plotly_obj</span><span class="p">,</span> <span class="n">update_obj</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helper to support the update() methods on :class:`BaseFigure` and</span>
<span class="sd">        :class:`BasePlotlyType`</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        plotly_obj : BasePlotlyType|tuple[BasePlotlyType]</span>
<span class="sd">            Object to up updated</span>
<span class="sd">        update_obj : dict|list[dict]|tuple[dict]</span>
<span class="sd">            When ``plotly_obj`` is an instance of :class:`BaseFigure`,</span>
<span class="sd">            ``update_obj`` should be a dict</span>

<span class="sd">            When ``plotly_obj`` is a tuple of instances of</span>
<span class="sd">            :class:`BasePlotlyType`, ``update_obj`` should be a tuple or list</span>
<span class="sd">            of dicts</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">_plotly_utils.basevalidators</span> <span class="kn">import</span> <span class="p">(</span>
            <span class="n">CompoundValidator</span><span class="p">,</span>
            <span class="n">CompoundArrayValidator</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">update_obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Nothing to do</span>
            <span class="k">return</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">plotly_obj</span><span class="p">,</span> <span class="n">BasePlotlyType</span><span class="p">):</span>

            <span class="c1"># Handle initializing subplot ids</span>
            <span class="c1"># -------------------------------</span>
            <span class="c1"># This should be valid even if xaxis2 hasn&#39;t been initialized:</span>
            <span class="c1"># &gt;&gt;&gt; layout.update(xaxis2={&#39;title&#39;: &#39;xaxis 2&#39;})</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">plotly_obj</span><span class="p">,</span> <span class="n">BaseLayoutType</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">update_obj</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">plotly_obj</span><span class="p">:</span>
                        <span class="n">match</span> <span class="o">=</span> <span class="n">plotly_obj</span><span class="o">.</span><span class="n">_subplot_re_match</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                            <span class="c1"># We need to create a subplotid object</span>
                            <span class="n">plotly_obj</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="c1"># Handle invalid properties</span>
            <span class="c1"># -------------------------</span>
            <span class="n">invalid_props</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">update_obj</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">plotly_obj</span><span class="p">]</span>

            <span class="n">plotly_obj</span><span class="o">.</span><span class="n">_raise_on_invalid_property_error</span><span class="p">(</span><span class="o">*</span><span class="n">invalid_props</span><span class="p">)</span>

            <span class="c1"># Convert update_obj to dict</span>
            <span class="c1"># --------------------------</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">update_obj</span><span class="p">,</span> <span class="n">BasePlotlyType</span><span class="p">):</span>
                <span class="n">update_obj</span> <span class="o">=</span> <span class="n">update_obj</span><span class="o">.</span><span class="n">to_plotly_json</span><span class="p">()</span>

            <span class="c1"># Process valid properties</span>
            <span class="c1"># ------------------------</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">update_obj</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">update_obj</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">overwrite</span><span class="p">:</span>
                    <span class="c1"># Don&#39;t recurse and assign property as-is</span>
                    <span class="n">plotly_obj</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
                    <span class="k">continue</span>

                <span class="n">validator</span> <span class="o">=</span> <span class="n">plotly_obj</span><span class="o">.</span><span class="n">_get_prop_validator</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">validator</span><span class="p">,</span> <span class="n">CompoundValidator</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>

                    <span class="c1"># Update compound objects recursively</span>
                    <span class="c1"># plotly_obj[key].update(val)</span>
                    <span class="n">BaseFigure</span><span class="o">.</span><span class="n">_perform_update</span><span class="p">(</span><span class="n">plotly_obj</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">val</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">validator</span><span class="p">,</span> <span class="n">CompoundArrayValidator</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">plotly_obj</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
                        <span class="c1"># plotly_obj has an existing non-empty array for key</span>
                        <span class="c1"># In this case we merge val into the existing elements</span>
                        <span class="n">BaseFigure</span><span class="o">.</span><span class="n">_perform_update</span><span class="p">(</span><span class="n">plotly_obj</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">val</span><span class="p">)</span>

                        <span class="c1"># If update tuple is longer that current tuple, append the</span>
                        <span class="c1"># extra elements to the end</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span>
                            <span class="n">plotly_obj</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                        <span class="p">):</span>
                            <span class="n">plotly_obj</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">plotly_obj</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">+</span> <span class="nb">tuple</span><span class="p">(</span>
                                <span class="n">val</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">plotly_obj</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="p">:]</span>
                            <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># plotly_obj is an empty or uninitialized list for key</span>
                        <span class="c1"># In this case we accept val as is</span>
                        <span class="n">plotly_obj</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Assign non-compound value</span>
                    <span class="n">plotly_obj</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">plotly_obj</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">update_obj</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># Nothing to do</span>
                <span class="k">return</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">plotly_element</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">plotly_obj</span><span class="p">):</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">update_obj</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">update_obj</span><span class="p">:</span>
                            <span class="n">update_element</span> <span class="o">=</span> <span class="n">update_obj</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">continue</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">update_element</span> <span class="o">=</span> <span class="n">update_obj</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">update_obj</span><span class="p">)]</span>
                    <span class="n">BaseFigure</span><span class="o">.</span><span class="n">_perform_update</span><span class="p">(</span><span class="n">plotly_element</span><span class="p">,</span> <span class="n">update_element</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Unexpected plotly object with type </span><span class="si">{typ}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">typ</span><span class="o">=</span><span class="nb">type</span><span class="p">(</span><span class="n">plotly_obj</span><span class="p">))</span>
            <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_index_is</span><span class="p">(</span><span class="n">iterable</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the index of a value in an iterable using object identity</span>
<span class="sd">        (not object equality as is the case for list.index)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">index_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">curr_val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">iterable</span><span class="p">)</span> <span class="k">if</span> <span class="n">curr_val</span> <span class="ow">is</span> <span class="n">val</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">index_list</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid value&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">index_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>


<span class="k">class</span> <span class="nc">BasePlotlyType</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    BasePlotlyType is the base class for all objects in the trace, layout,</span>
<span class="sd">    and frame object hierarchies</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># ### Mapped (deprecated) properties ###</span>
    <span class="c1"># dict for deprecated property name (e.g. &#39;titlefont&#39;) to tuple</span>
    <span class="c1"># of relative path to new property (e.g. (&#39;title&#39;, &#39;font&#39;)</span>
    <span class="n">_mapped_properties</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">_parent_path_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">_path_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">_valid_props</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plotly_name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Construct a new BasePlotlyType</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        plotly_name : str</span>
<span class="sd">            The lowercase name of the plotly object</span>
<span class="sd">        kwargs : dict</span>
<span class="sd">            Invalid props/values to raise on</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># ### _skip_invalid ##</span>
        <span class="c1"># If True, then invalid properties should be skipped, if False then</span>
        <span class="c1"># invalid properties will result in an exception</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_skip_invalid</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_validate</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Validate inputs</span>
        <span class="c1"># ---------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_process_kwargs</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># Store params</span>
        <span class="c1"># ------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_plotly_name</span> <span class="o">=</span> <span class="n">plotly_name</span>

        <span class="c1"># Initialize properties</span>
        <span class="c1"># ---------------------</span>
        <span class="c1"># ### _compound_props ###</span>
        <span class="c1"># A dict from compound property names to compound objects</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_compound_props</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># ### _compound_array_props ###</span>
        <span class="c1"># A dict from compound array property names to tuples of compound</span>
        <span class="c1"># objects</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_compound_array_props</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># ### _orphan_props ###</span>
        <span class="c1"># A dict of properties for use while object has no parent. When</span>
        <span class="c1"># object has a parent, it requests its properties dict from its</span>
        <span class="c1"># parent and doesn&#39;t use this.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_orphan_props</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># ### _parent ###</span>
        <span class="c1"># The parent of the object. May be another BasePlotlyType or it may</span>
        <span class="c1"># be a BaseFigure (as is the case for the Layout and Trace objects)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># ### _change_callbacks ###</span>
        <span class="c1"># A dict from tuples of child property path tuples to lists</span>
        <span class="c1"># of callbacks that should be executed whenever any of these</span>
        <span class="c1"># properties is modified</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_change_callbacks</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># ### Backing property for backward compatible _validator property ##</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__validators</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># @property</span>
    <span class="c1"># def _validate(self):</span>
    <span class="c1">#     fig = self.figure</span>
    <span class="c1">#     if fig is None:</span>
    <span class="c1">#         return True</span>
    <span class="c1">#     else:</span>
    <span class="c1">#         return fig._validate</span>

    <span class="k">def</span> <span class="nf">_get_validator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">.validator_cache</span> <span class="kn">import</span> <span class="n">ValidatorCache</span>

        <span class="k">return</span> <span class="n">ValidatorCache</span><span class="o">.</span><span class="n">get_validator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path_str</span><span class="p">,</span> <span class="n">prop</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_validators</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validators used to be stored in a private _validators property. This was</span>
<span class="sd">        eliminated when we switched to building validators on demand using the</span>
<span class="sd">        _get_validator method.</span>

<span class="sd">        This property returns a simple object that</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict-like interface for accessing the object&#39;s validators</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__validators</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

            <span class="k">class</span> <span class="nc">ValidatorCompat</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
                <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">_get_validator</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

                <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="fm">__contains__</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

                <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                    <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

                <span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                    <span class="k">return</span> <span class="p">[(</span><span class="n">k</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">__validators</span> <span class="o">=</span> <span class="n">ValidatorCompat</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__validators</span>

    <span class="k">def</span> <span class="nf">_process_kwargs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Process any extra kwargs that are not predefined as constructor params</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">invalid_kwargs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                <span class="c1"># e.g. underscore kwargs like marker_line_color</span>
                <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate</span><span class="p">:</span>
                <span class="c1"># Set extra property as-is</span>
                <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">invalid_kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>

        <span class="k">if</span> <span class="n">invalid_kwargs</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_skip_invalid</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_raise_on_invalid_property_error</span><span class="p">(</span><span class="o">*</span><span class="n">invalid_kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">plotly_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The plotly name of the object</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plotly_name</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_prop_descriptions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Formatted string containing all of this obejcts child properties</span>
<span class="sd">        and their descriptions</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_props</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dictionary used to store this object properties.  When the object</span>
<span class="sd">        has a parent, this dict is retreived from the parent. When the</span>
<span class="sd">        object does not have a parent, this dict is the object&#39;s</span>
<span class="sd">        `_orphan_props` property</span>

<span class="sd">        Note: Property will return None if the object has a parent and the</span>
<span class="sd">        object&#39;s properties have not been initialized using the</span>
<span class="sd">        `_init_props` method.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict|None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Use orphan data</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_orphan_props</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Get data from parent&#39;s dict</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">_get_child_props</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_child_props</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">child</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return properties dict for child</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        child : BasePlotlyType</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_props</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># If this node&#39;s properties are uninitialized then so are its</span>
            <span class="c1"># child&#39;s</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># ### Child a compound property ###</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">plotly_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                <span class="kn">from</span> <span class="nn">_plotly_utils.basevalidators</span> <span class="kn">import</span> <span class="p">(</span>
                    <span class="n">CompoundValidator</span><span class="p">,</span>
                    <span class="n">CompoundArrayValidator</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="n">validator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_validator</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">plotly_name</span><span class="p">)</span>

                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">validator</span><span class="p">,</span> <span class="n">CompoundValidator</span><span class="p">):</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_props</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">plotly_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

                <span class="c1"># ### Child an element of a compound array property ###</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">validator</span><span class="p">,</span> <span class="n">CompoundArrayValidator</span><span class="p">):</span>
                    <span class="n">children</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">child</span><span class="o">.</span><span class="n">plotly_name</span><span class="p">]</span>
                    <span class="n">child_ind</span> <span class="o">=</span> <span class="n">BaseFigure</span><span class="o">.</span><span class="n">_index_is</span><span class="p">(</span><span class="n">children</span><span class="p">,</span> <span class="n">child</span><span class="p">)</span>
                    <span class="k">assert</span> <span class="n">child_ind</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

                    <span class="n">children_props</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_props</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">plotly_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                    <span class="k">return</span> <span class="p">(</span>
                        <span class="n">children_props</span><span class="p">[</span><span class="n">child_ind</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">children_props</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                        <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">children_props</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">child_ind</span>
                        <span class="k">else</span> <span class="kc">None</span>
                    <span class="p">)</span>

            <span class="c1"># ### Invalid child ###</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid child with name: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">child</span><span class="o">.</span><span class="n">plotly_name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_init_props</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ensure that this object&#39;s properties dict has been initialized. When</span>
<span class="sd">        the object has a parent, this ensures that the parent has an</span>
<span class="sd">        initialized properties dict with this object&#39;s plotly_name as a key.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Ensure that _data is initialized.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_props</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">_init_child_props</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_init_child_props</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">child</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ensure that a properties dict has been initialized for a child object</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        child : BasePlotlyType</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Init our own properties</span>
        <span class="c1"># -----------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_props</span><span class="p">()</span>

        <span class="c1"># Child a compound property</span>
        <span class="c1"># -------------------------</span>
        <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">plotly_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compound_props</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">plotly_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_props</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_props</span><span class="p">[</span><span class="n">child</span><span class="o">.</span><span class="n">plotly_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Child an element of a compound array property</span>
        <span class="c1"># ---------------------------------------------</span>
        <span class="k">elif</span> <span class="n">child</span><span class="o">.</span><span class="n">plotly_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compound_array_props</span><span class="p">:</span>
            <span class="n">children</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compound_array_props</span><span class="p">[</span><span class="n">child</span><span class="o">.</span><span class="n">plotly_name</span><span class="p">]</span>
            <span class="n">child_ind</span> <span class="o">=</span> <span class="n">BaseFigure</span><span class="o">.</span><span class="n">_index_is</span><span class="p">(</span><span class="n">children</span><span class="p">,</span> <span class="n">child</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">child_ind</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">plotly_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_props</span><span class="p">:</span>
                <span class="c1"># Initialize list</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_props</span><span class="p">[</span><span class="n">child</span><span class="o">.</span><span class="n">plotly_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="c1"># Make sure list is long enough for child</span>
            <span class="n">children_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_props</span><span class="p">[</span><span class="n">child</span><span class="o">.</span><span class="n">plotly_name</span><span class="p">]</span>
            <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">children_list</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">child_ind</span><span class="p">:</span>
                <span class="n">children_list</span><span class="o">.</span><span class="n">append</span><span class="p">({})</span>

        <span class="c1"># Invalid child</span>
        <span class="c1"># -------------</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid child with name: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">child</span><span class="o">.</span><span class="n">plotly_name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_child_prop_defaults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">child</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return default properties dict for child</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        child : BasePlotlyType</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prop_defaults</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># If this node&#39;s default properties are uninitialized then so are</span>
            <span class="c1"># its child&#39;s</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># ### Child a compound property ###</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">plotly_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compound_props</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prop_defaults</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">plotly_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

            <span class="c1"># ### Child an element of a compound array property ###</span>
            <span class="k">elif</span> <span class="n">child</span><span class="o">.</span><span class="n">plotly_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compound_array_props</span><span class="p">:</span>
                <span class="n">children</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compound_array_props</span><span class="p">[</span><span class="n">child</span><span class="o">.</span><span class="n">plotly_name</span><span class="p">]</span>
                <span class="n">child_ind</span> <span class="o">=</span> <span class="n">BaseFigure</span><span class="o">.</span><span class="n">_index_is</span><span class="p">(</span><span class="n">children</span><span class="p">,</span> <span class="n">child</span><span class="p">)</span>

                <span class="k">assert</span> <span class="n">child_ind</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

                <span class="n">children_props</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prop_defaults</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">plotly_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

                <span class="k">return</span> <span class="p">(</span>
                    <span class="n">children_props</span><span class="p">[</span><span class="n">child_ind</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">children_props</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">children_props</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">child_ind</span>
                    <span class="k">else</span> <span class="kc">None</span>
                <span class="p">)</span>

            <span class="c1"># ### Invalid child ###</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid child with name: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">child</span><span class="o">.</span><span class="n">plotly_name</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_prop_defaults</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return default properties dict</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">_get_child_prop_defaults</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_prop_validator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the validator associated with the specified property</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        prop: str</span>
<span class="sd">            A property that exists in this object</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        BaseValidator</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Handle remapping</span>
        <span class="c1"># ----------------</span>
        <span class="k">if</span> <span class="n">prop</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mapped_properties</span><span class="p">:</span>
            <span class="n">prop_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mapped_properties</span><span class="p">[</span><span class="n">prop</span><span class="p">]</span>
            <span class="n">plotly_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">prop_path</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
            <span class="n">prop</span> <span class="o">=</span> <span class="n">prop_path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">prop_path</span> <span class="o">=</span> <span class="n">BaseFigure</span><span class="o">.</span><span class="n">_str_to_dict_path</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>
            <span class="n">plotly_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">prop_path</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
            <span class="n">prop</span> <span class="o">=</span> <span class="n">prop_path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># Return validator</span>
        <span class="c1"># ----------------</span>
        <span class="k">return</span> <span class="n">plotly_obj</span><span class="o">.</span><span class="n">_get_validator</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">parent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the object&#39;s parent, or None if the object has no parent</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        BasePlotlyType|BaseFigure</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">figure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reference to the top-level Figure or FigureWidget that this object</span>
<span class="sd">        belongs to. None if the object does not belong to a Figure</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Union[BaseFigure, None]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">top_parent</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">while</span> <span class="n">top_parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">top_parent</span><span class="p">,</span> <span class="n">BaseFigure</span><span class="p">):</span>
                <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">top_parent</span> <span class="o">=</span> <span class="n">top_parent</span><span class="o">.</span><span class="n">parent</span>

        <span class="k">return</span> <span class="n">top_parent</span>

    <span class="c1"># Magic Methods</span>
    <span class="c1"># -------------</span>
    <span class="k">def</span> <span class="nf">__reduce__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Custom implementation of reduce is used to support deep copying</span>
<span class="sd">        and pickling</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">props</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_plotly_json</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="p">(</span><span class="n">props</span><span class="p">,))</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get item or nested item from object</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        prop : str|tuple</span>

<span class="sd">            If prop is the name of a property of this object, then the</span>
<span class="sd">            property is returned.</span>

<span class="sd">            If prop is a nested property path string (e.g. &#39;foo[1].bar&#39;),</span>
<span class="sd">            then a nested property is returned (e.g. obj[&#39;foo&#39;][1][&#39;bar&#39;])</span>

<span class="sd">            If prop is a path tuple (e.g. (&#39;foo&#39;, 1, &#39;bar&#39;)), then a nested</span>
<span class="sd">            property is returned (e.g. obj[&#39;foo&#39;][1][&#39;bar&#39;]).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Any</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">_plotly_utils.basevalidators</span> <span class="kn">import</span> <span class="p">(</span>
            <span class="n">CompoundValidator</span><span class="p">,</span>
            <span class="n">CompoundArrayValidator</span><span class="p">,</span>
            <span class="n">BaseDataValidator</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Normalize prop</span>
        <span class="c1"># --------------</span>
        <span class="c1"># Convert into a property tuple</span>
        <span class="n">prop</span> <span class="o">=</span> <span class="n">BaseFigure</span><span class="o">.</span><span class="n">_str_to_dict_path</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>

        <span class="c1"># Handle remapping</span>
        <span class="c1"># ----------------</span>
        <span class="k">if</span> <span class="n">prop</span> <span class="ow">and</span> <span class="n">prop</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mapped_properties</span><span class="p">:</span>
            <span class="n">prop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mapped_properties</span><span class="p">[</span><span class="n">prop</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span> <span class="n">prop</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

        <span class="c1"># Handle scalar case</span>
        <span class="c1"># ------------------</span>
        <span class="c1"># e.g. (&#39;foo&#39;,)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># Unwrap scalar tuple</span>
            <span class="n">prop</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">prop</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_props</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>

            <span class="n">validator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_validator</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">validator</span><span class="p">,</span> <span class="n">CompoundValidator</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compound_props</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">prop</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="c1"># Init compound objects</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_compound_props</span><span class="p">[</span><span class="n">prop</span><span class="p">]</span> <span class="o">=</span> <span class="n">validator</span><span class="o">.</span><span class="n">data_class</span><span class="p">(</span>
                        <span class="n">_parent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">plotly_name</span><span class="o">=</span><span class="n">prop</span>
                    <span class="p">)</span>
                    <span class="c1"># Update plotly_name value in case the validator applies</span>
                    <span class="c1"># non-standard name (e.g. imagedefaults instead of image)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_compound_props</span><span class="p">[</span><span class="n">prop</span><span class="p">]</span><span class="o">.</span><span class="n">_plotly_name</span> <span class="o">=</span> <span class="n">prop</span>

                <span class="k">return</span> <span class="n">validator</span><span class="o">.</span><span class="n">present</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_compound_props</span><span class="p">[</span><span class="n">prop</span><span class="p">])</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">validator</span><span class="p">,</span> <span class="p">(</span><span class="n">CompoundArrayValidator</span><span class="p">,</span> <span class="n">BaseDataValidator</span><span class="p">)):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compound_array_props</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">prop</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="c1"># Init list of compound objects</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_props</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_compound_array_props</span><span class="p">[</span><span class="n">prop</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                            <span class="n">validator</span><span class="o">.</span><span class="n">data_class</span><span class="p">(</span><span class="n">_parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_props</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">prop</span><span class="p">,</span> <span class="p">[])</span>
                        <span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_compound_array_props</span><span class="p">[</span><span class="n">prop</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

                <span class="k">return</span> <span class="n">validator</span><span class="o">.</span><span class="n">present</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_compound_array_props</span><span class="p">[</span><span class="n">prop</span><span class="p">])</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_props</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">prop</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_props</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">validator</span><span class="o">.</span><span class="n">present</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_props</span><span class="p">[</span><span class="n">prop</span><span class="p">])</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prop_defaults</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">validator</span><span class="o">.</span><span class="n">present</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_prop_defaults</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">prop</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># Handle non-scalar case</span>
        <span class="c1"># ----------------------</span>
        <span class="c1"># e.g. (&#39;foo&#39;, 1), ()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">prop</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="n">p</span><span class="p">]</span>

            <span class="k">return</span> <span class="n">res</span>

    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Determine whether object contains a property or nested property</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        prop : str|tuple</span>
<span class="sd">            If prop is a simple string (e.g. &#39;foo&#39;), then return true of the</span>
<span class="sd">            object contains an element named &#39;foo&#39;</span>

<span class="sd">            If prop is a property path string (e.g. &#39;foo[0].bar&#39;),</span>
<span class="sd">            then return true if the obejct contains the nested elements for</span>
<span class="sd">            each entry in the path string (e.g. &#39;bar&#39; in obj[&#39;foo&#39;][0])</span>

<span class="sd">            If prop is a property path tuple (e.g. (&#39;foo&#39;, 0, &#39;bar&#39;)),</span>
<span class="sd">            then return true if the object contains the nested elements for</span>
<span class="sd">            each entry in the path string (e.g. &#39;bar&#39; in obj[&#39;foo&#39;][0])</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">prop</span> <span class="o">=</span> <span class="n">BaseFigure</span><span class="o">.</span><span class="n">_str_to_dict_path</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>

        <span class="c1"># Handle remapping</span>
        <span class="k">if</span> <span class="n">prop</span> <span class="ow">and</span> <span class="n">prop</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mapped_properties</span><span class="p">:</span>
            <span class="n">prop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mapped_properties</span><span class="p">[</span><span class="n">prop</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span> <span class="n">prop</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

        <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">prop</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
                    <span class="n">obj</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[</span><span class="n">p</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">_valid_props</span><span class="p">:</span>
                    <span class="n">obj</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[</span><span class="n">p</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        prop : str</span>
<span class="sd">            The name of a direct child of this object</span>

<span class="sd">            Note: Setting nested properties using property path string or</span>
<span class="sd">            property path tuples is not supported.</span>
<span class="sd">        value</span>
<span class="sd">            New property value</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">_plotly_utils.basevalidators</span> <span class="kn">import</span> <span class="p">(</span>
            <span class="n">CompoundValidator</span><span class="p">,</span>
            <span class="n">CompoundArrayValidator</span><span class="p">,</span>
            <span class="n">BaseDataValidator</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Normalize prop</span>
        <span class="c1"># --------------</span>
        <span class="c1"># Convert into a property tuple</span>
        <span class="n">orig_prop</span> <span class="o">=</span> <span class="n">prop</span>
        <span class="n">prop</span> <span class="o">=</span> <span class="n">BaseFigure</span><span class="o">.</span><span class="n">_str_to_dict_path</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>

        <span class="c1"># Handle empty case</span>
        <span class="c1"># -----------------</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">orig_prop</span><span class="p">)</span>

        <span class="c1"># Handle remapping</span>
        <span class="c1"># ----------------</span>
        <span class="k">if</span> <span class="n">prop</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mapped_properties</span><span class="p">:</span>
            <span class="n">prop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mapped_properties</span><span class="p">[</span><span class="n">prop</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span> <span class="n">prop</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

        <span class="c1"># Handle scalar case</span>
        <span class="c1"># ------------------</span>
        <span class="c1"># e.g. (&#39;foo&#39;,)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>

            <span class="c1"># ### Unwrap scalar tuple ###</span>
            <span class="n">prop</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">prop</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_props</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_raise_on_invalid_property_error</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>

                <span class="c1"># ### Get validator for this property ###</span>
                <span class="n">validator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_validator</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>

                <span class="c1"># ### Handle compound property ###</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">validator</span><span class="p">,</span> <span class="n">CompoundValidator</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_set_compound_prop</span><span class="p">(</span><span class="n">prop</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

                <span class="c1"># ### Handle compound array property ###</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">validator</span><span class="p">,</span> <span class="p">(</span><span class="n">CompoundArrayValidator</span><span class="p">,</span> <span class="n">BaseDataValidator</span><span class="p">)):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_set_array_prop</span><span class="p">(</span><span class="n">prop</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

                <span class="c1"># ### Handle simple property ###</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_set_prop</span><span class="p">(</span><span class="n">prop</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Make sure properties dict is initialized</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_init_props</span><span class="p">()</span>

                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">BasePlotlyType</span><span class="p">):</span>
                    <span class="c1"># Extract json from graph objects</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">to_plotly_json</span><span class="p">()</span>

                <span class="c1"># Check for list/tuple of graph objects</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">))</span>
                    <span class="ow">and</span> <span class="n">value</span>
                    <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">BasePlotlyType</span><span class="p">)</span>
                <span class="p">):</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="n">v</span><span class="o">.</span><span class="n">to_plotly_json</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">BasePlotlyType</span><span class="p">)</span> <span class="k">else</span> <span class="n">v</span>
                        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value</span>
                    <span class="p">]</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_props</span><span class="p">[</span><span class="n">prop</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

                <span class="c1"># Remove any already constructed graph object so that it will be</span>
                <span class="c1"># reconstructed on property access</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_compound_props</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">prop</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_compound_array_props</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">prop</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="c1"># Handle non-scalar case</span>
        <span class="c1"># ----------------------</span>
        <span class="c1"># e.g. (&#39;foo&#39;, 1), ()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">prop</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="n">p</span><span class="p">]</span>

            <span class="n">res</span><span class="o">.</span><span class="n">_validate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate</span>

            <span class="n">res</span><span class="p">[</span><span class="n">prop</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        prop : str</span>
<span class="sd">            The name of a direct child of this object</span>
<span class="sd">        value</span>
<span class="sd">            New property value</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">prop</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop</span><span class="p">)</span> <span class="ow">or</span> <span class="n">prop</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_props</span><span class="p">:</span>
            <span class="c1"># Let known properties and private properties through</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">BasePlotlyType</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">prop</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Raise error on unknown public properties</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_raise_on_invalid_property_error</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return an iterator over the object&#39;s properties</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_valid_props</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">prop</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mapped_properties</span><span class="p">:</span>
            <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test for equality</span>

<span class="sd">        To be considered equal, `other` must have the same type as this object</span>
<span class="sd">        and their `to_plotly_json` representaitons must be identical.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        other</span>
<span class="sd">            The object to compare against</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">):</span>
            <span class="c1"># Require objects to be of the same plotly type</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Compare plotly_json representations</span>

            <span class="c1"># Use _vals_equal instead of `==` to handle cases where</span>
            <span class="c1"># underlying dicts contain numpy arrays</span>
            <span class="k">return</span> <span class="n">BasePlotlyType</span><span class="o">.</span><span class="n">_vals_equal</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_props</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_props</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">{},</span>
                <span class="n">other</span><span class="o">.</span><span class="n">_props</span> <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">_props</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">{},</span>
            <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_build_repr_for_class</span><span class="p">(</span><span class="n">props</span><span class="p">,</span> <span class="n">class_name</span><span class="p">,</span> <span class="n">parent_path_str</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helper to build representation string for a class</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        class_name : str</span>
<span class="sd">            Name of the class being represented</span>
<span class="sd">        parent_path_str : str of None (default)</span>
<span class="sd">            Name of the class&#39;s parent package to display</span>
<span class="sd">        props : dict</span>
<span class="sd">            Properties to unpack into the constructor</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            The representation string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">plotly.utils</span> <span class="kn">import</span> <span class="n">ElidedPrettyPrinter</span>

        <span class="k">if</span> <span class="n">parent_path_str</span><span class="p">:</span>
            <span class="n">class_name</span> <span class="o">=</span> <span class="n">parent_path_str</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="n">class_name</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">props</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">repr_str</span> <span class="o">=</span> <span class="n">class_name</span> <span class="o">+</span> <span class="s2">&quot;()&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pprinter</span> <span class="o">=</span> <span class="n">ElidedPrettyPrinter</span><span class="p">(</span><span class="n">threshold</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">120</span><span class="p">)</span>
            <span class="n">pprint_res</span> <span class="o">=</span> <span class="n">pprinter</span><span class="o">.</span><span class="n">pformat</span><span class="p">(</span><span class="n">props</span><span class="p">)</span>

            <span class="c1"># pprint_res is indented by 1 space. Add extra 3 spaces for PEP8</span>
            <span class="c1"># complaint indent</span>
            <span class="n">body</span> <span class="o">=</span> <span class="s2">&quot;   &quot;</span> <span class="o">+</span> <span class="n">pprint_res</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   &quot;</span><span class="p">)</span>

            <span class="n">repr_str</span> <span class="o">=</span> <span class="n">class_name</span> <span class="o">+</span> <span class="s2">&quot;({</span><span class="se">\n</span><span class="s2"> &quot;</span> <span class="o">+</span> <span class="n">body</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">})&quot;</span>

        <span class="k">return</span> <span class="n">repr_str</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Customize object representation when displayed in the</span>
<span class="sd">        terminal/notebook</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">_plotly_utils.basevalidators</span> <span class="kn">import</span> <span class="n">LiteralValidator</span>

        <span class="c1"># Get all properties</span>
        <span class="n">props</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_props</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_props</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">{}</span>

        <span class="c1"># Remove literals (These can&#39;t be specified in the constructor)</span>
        <span class="n">props</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">p</span><span class="p">:</span> <span class="n">v</span>
            <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">props</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_props</span>
            <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_validator</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="n">LiteralValidator</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="c1"># Elide template</span>
        <span class="k">if</span> <span class="s2">&quot;template&quot;</span> <span class="ow">in</span> <span class="n">props</span><span class="p">:</span>
            <span class="n">props</span><span class="p">[</span><span class="s2">&quot;template&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;...&quot;</span>

        <span class="c1"># Build repr string</span>
        <span class="n">repr_str</span> <span class="o">=</span> <span class="n">BasePlotlyType</span><span class="o">.</span><span class="n">_build_repr_for_class</span><span class="p">(</span>
            <span class="n">props</span><span class="o">=</span><span class="n">props</span><span class="p">,</span>
            <span class="n">class_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
            <span class="n">parent_path_str</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_parent_path_str</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">repr_str</span>

    <span class="k">def</span> <span class="nf">_raise_on_invalid_property_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Raise informative exception when invalid property names are</span>
<span class="sd">        encountered</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        args : list[str]</span>
<span class="sd">            List of property names that have already been determined to be</span>
<span class="sd">            invalid</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            Always</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">invalid_props</span> <span class="o">=</span> <span class="n">args</span>
        <span class="k">if</span> <span class="n">invalid_props</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">invalid_props</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">prop_str</span> <span class="o">=</span> <span class="s2">&quot;property&quot;</span>
                <span class="n">invalid_str</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="n">invalid_props</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">prop_str</span> <span class="o">=</span> <span class="s2">&quot;properties&quot;</span>
                <span class="n">invalid_str</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="n">invalid_props</span><span class="p">)</span>

            <span class="n">module_root</span> <span class="o">=</span> <span class="s2">&quot;plotly.graph_objs.&quot;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent_path_str</span><span class="p">:</span>
                <span class="n">full_obj_name</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">module_root</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent_path_str</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">full_obj_name</span> <span class="o">=</span> <span class="n">module_root</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>

            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Invalid </span><span class="si">{prop_str}</span><span class="s2"> specified for object of type &quot;</span>
                <span class="s2">&quot;</span><span class="si">{full_obj_name}</span><span class="s2">: </span><span class="si">{invalid_str}</span><span class="se">\n\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;    Valid properties:</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;</span><span class="si">{prop_descriptions}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">prop_str</span><span class="o">=</span><span class="n">prop_str</span><span class="p">,</span>
                    <span class="n">full_obj_name</span><span class="o">=</span><span class="n">full_obj_name</span><span class="p">,</span>
                    <span class="n">invalid_str</span><span class="o">=</span><span class="n">invalid_str</span><span class="p">,</span>
                    <span class="n">prop_descriptions</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_prop_descriptions</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dict1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the properties of an object with a dict and/or with</span>
<span class="sd">        keyword arguments.</span>

<span class="sd">        This recursively updates the structure of the original</span>
<span class="sd">        object with the values in the input dict / keyword arguments.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dict1 : dict</span>
<span class="sd">            Dictionary of properties to be updated</span>
<span class="sd">        overwrite: bool</span>
<span class="sd">            If True, overwrite existing properties. If False, apply updates</span>
<span class="sd">            to existing properties recursively, preserving existing</span>
<span class="sd">            properties that are not specified in the update operation.</span>
<span class="sd">        kwargs :</span>
<span class="sd">            Keyword/value pair of properties to be updated</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        BasePlotlyType</span>
<span class="sd">            Updated plotly object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">batch_update</span><span class="p">():</span>
                <span class="n">BaseFigure</span><span class="o">.</span><span class="n">_perform_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dict1</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">)</span>
                <span class="n">BaseFigure</span><span class="o">.</span><span class="n">_perform_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">BaseFigure</span><span class="o">.</span><span class="n">_perform_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dict1</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">)</span>
            <span class="n">BaseFigure</span><span class="o">.</span><span class="n">_perform_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">pop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove the value associated with the specified key and return it</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        key: str</span>
<span class="sd">            Property name</span>
<span class="sd">        dflt</span>
<span class="sd">            The default value to return if key was not found in object</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        value</span>
<span class="sd">            The removed value that was previously associated with key</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        KeyError</span>
<span class="sd">            If key is not in object and no dflt argument specified</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Handle default</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span> <span class="ow">and</span> <span class="n">args</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">return</span> <span class="n">val</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_in_batch_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        True if the object belongs to a figure that is currently in batch mode</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">_in_batch_mode</span>

    <span class="k">def</span> <span class="nf">_set_prop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the value of a simple property</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        prop : str</span>
<span class="sd">            Name of a simple (non-compound, non-array) property</span>
<span class="sd">        val</span>
<span class="sd">            The new property value</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Any</span>
<span class="sd">            The coerced assigned value</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># val is Undefined</span>
        <span class="c1"># ----------------</span>
        <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="n">Undefined</span><span class="p">:</span>
            <span class="c1"># Do nothing</span>
            <span class="k">return</span>

        <span class="c1"># Import value</span>
        <span class="c1"># ------------</span>
        <span class="n">validator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_validator</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">validator</span><span class="o">.</span><span class="n">validate_coerce</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_skip_invalid</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">err</span>

        <span class="c1"># val is None</span>
        <span class="c1"># -----------</span>
        <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Check if we should send null update</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_props</span> <span class="ow">and</span> <span class="n">prop</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_props</span><span class="p">:</span>
                <span class="c1"># Remove property if not in batch mode</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_in_batch_mode</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_props</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>

                <span class="c1"># Send property update message</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_send_prop_set</span><span class="p">(</span><span class="n">prop</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>

        <span class="c1"># val is valid value</span>
        <span class="c1"># ------------------</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Make sure properties dict is initialized</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_init_props</span><span class="p">()</span>

            <span class="c1"># Check whether the value is a change</span>
            <span class="k">if</span> <span class="n">prop</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_props</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">BasePlotlyType</span><span class="o">.</span><span class="n">_vals_equal</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_props</span><span class="p">[</span><span class="n">prop</span><span class="p">],</span> <span class="n">val</span>
            <span class="p">):</span>
                <span class="c1"># Set property value if not in batch mode</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_in_batch_mode</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_props</span><span class="p">[</span><span class="n">prop</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>

                <span class="c1"># Send property update message</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_send_prop_set</span><span class="p">(</span><span class="n">prop</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">val</span>

    <span class="k">def</span> <span class="nf">_set_compound_prop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the value of a compound property</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        prop : str</span>
<span class="sd">            Name of a compound property</span>
<span class="sd">        val</span>
<span class="sd">            The new property value</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        BasePlotlyType</span>
<span class="sd">            The coerced assigned object</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># val is Undefined</span>
        <span class="c1"># ----------------</span>
        <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="n">Undefined</span><span class="p">:</span>
            <span class="c1"># Do nothing</span>
            <span class="k">return</span>

        <span class="c1"># Import value</span>
        <span class="c1"># ------------</span>
        <span class="n">validator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_validator</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">validator</span><span class="o">.</span><span class="n">validate_coerce</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">skip_invalid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_skip_invalid</span><span class="p">)</span>

        <span class="c1"># Save deep copies of current and new states</span>
        <span class="c1"># ------------------------------------------</span>
        <span class="n">curr_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compound_props</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">prop</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">curr_val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">curr_dict_val</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">curr_val</span><span class="o">.</span><span class="n">_props</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">curr_dict_val</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">new_dict_val</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">_props</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_dict_val</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Update _props dict</span>
        <span class="c1"># ------------------</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_in_batch_mode</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">new_dict_val</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_props</span> <span class="ow">and</span> <span class="n">prop</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_props</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_props</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_init_props</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_props</span><span class="p">[</span><span class="n">prop</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_dict_val</span>

        <span class="c1"># Send update if there was a change in value</span>
        <span class="c1"># ------------------------------------------</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">BasePlotlyType</span><span class="o">.</span><span class="n">_vals_equal</span><span class="p">(</span><span class="n">curr_dict_val</span><span class="p">,</span> <span class="n">new_dict_val</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_send_prop_set</span><span class="p">(</span><span class="n">prop</span><span class="p">,</span> <span class="n">new_dict_val</span><span class="p">)</span>

        <span class="c1"># Reparent</span>
        <span class="c1"># --------</span>
        <span class="c1"># ### Reparent new value and clear orphan data ###</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">BasePlotlyType</span><span class="p">):</span>
            <span class="n">val</span><span class="o">.</span><span class="n">_parent</span> <span class="o">=</span> <span class="bp">self</span>
            <span class="n">val</span><span class="o">.</span><span class="n">_orphan_props</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="c1"># ### Unparent old value and update orphan data ###</span>
        <span class="k">if</span> <span class="n">curr_val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">curr_dict_val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">curr_val</span><span class="o">.</span><span class="n">_orphan_props</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">curr_dict_val</span><span class="p">)</span>
            <span class="n">curr_val</span><span class="o">.</span><span class="n">_parent</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Update _compound_props</span>
        <span class="c1"># ----------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_compound_props</span><span class="p">[</span><span class="n">prop</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
        <span class="k">return</span> <span class="n">val</span>

    <span class="k">def</span> <span class="nf">_set_array_prop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the value of a compound property</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        prop : str</span>
<span class="sd">            Name of a compound property</span>
<span class="sd">        val</span>
<span class="sd">            The new property value</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tuple[BasePlotlyType]</span>
<span class="sd">            The coerced assigned object</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># val is Undefined</span>
        <span class="c1"># ----------------</span>
        <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="n">Undefined</span><span class="p">:</span>
            <span class="c1"># Do nothing</span>
            <span class="k">return</span>

        <span class="c1"># Import value</span>
        <span class="c1"># ------------</span>
        <span class="n">validator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_validator</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">validator</span><span class="o">.</span><span class="n">validate_coerce</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">skip_invalid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_skip_invalid</span><span class="p">)</span>

        <span class="c1"># Save deep copies of current and new states</span>
        <span class="c1"># ------------------------------------------</span>
        <span class="n">curr_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compound_array_props</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">prop</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">curr_val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">curr_dict_vals</span> <span class="o">=</span> <span class="p">[</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">cv</span><span class="o">.</span><span class="n">_props</span><span class="p">)</span> <span class="k">for</span> <span class="n">cv</span> <span class="ow">in</span> <span class="n">curr_val</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">curr_dict_vals</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">new_dict_vals</span> <span class="o">=</span> <span class="p">[</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">nv</span><span class="o">.</span><span class="n">_props</span><span class="p">)</span> <span class="k">for</span> <span class="n">nv</span> <span class="ow">in</span> <span class="n">val</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_dict_vals</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Update _props dict</span>
        <span class="c1"># ------------------</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_in_batch_mode</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">new_dict_vals</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_props</span> <span class="ow">and</span> <span class="n">prop</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_props</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_props</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_init_props</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_props</span><span class="p">[</span><span class="n">prop</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_dict_vals</span>

        <span class="c1"># Send update if there was a change in value</span>
        <span class="c1"># ------------------------------------------</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">BasePlotlyType</span><span class="o">.</span><span class="n">_vals_equal</span><span class="p">(</span><span class="n">curr_dict_vals</span><span class="p">,</span> <span class="n">new_dict_vals</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_send_prop_set</span><span class="p">(</span><span class="n">prop</span><span class="p">,</span> <span class="n">new_dict_vals</span><span class="p">)</span>

        <span class="c1"># Reparent</span>
        <span class="c1"># --------</span>
        <span class="c1"># ### Reparent new values and clear orphan data ###</span>
        <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">val</span><span class="p">:</span>
                <span class="n">v</span><span class="o">.</span><span class="n">_orphan_props</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
                <span class="n">v</span><span class="o">.</span><span class="n">_parent</span> <span class="o">=</span> <span class="bp">self</span>

        <span class="c1"># ### Unparent old value and update orphan data ###</span>
        <span class="k">if</span> <span class="n">curr_val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">cv</span><span class="p">,</span> <span class="n">cv_dict</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">curr_val</span><span class="p">,</span> <span class="n">curr_dict_vals</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">cv_dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">cv</span><span class="o">.</span><span class="n">_orphan_props</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">cv_dict</span><span class="p">)</span>
                <span class="n">cv</span><span class="o">.</span><span class="n">_parent</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Update _compound_array_props</span>
        <span class="c1"># ----------------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_compound_array_props</span><span class="p">[</span><span class="n">prop</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
        <span class="k">return</span> <span class="n">val</span>

    <span class="k">def</span> <span class="nf">_send_prop_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop_path_str</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Notify parent that a property has been set to a new value</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        prop_path_str : str</span>
<span class="sd">            Property path string (e.g. &#39;foo[0].bar&#39;) of property that</span>
<span class="sd">            was set, relative to this object</span>
<span class="sd">        val</span>
<span class="sd">            New value for property. Either a simple value, a dict,</span>
<span class="sd">            or a tuple of dicts. This should *not* be a BasePlotlyType object.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_prop_set_child</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">child</span><span class="p">,</span> <span class="n">prop_path_str</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Propagate property setting notification from child to parent</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        child : BasePlotlyType</span>
<span class="sd">            Child object</span>
<span class="sd">        prop_path_str : str</span>
<span class="sd">            Property path string (e.g. &#39;foo[0].bar&#39;) of property that</span>
<span class="sd">            was set, relative to `child`</span>
<span class="sd">        val</span>
<span class="sd">            New value for property. Either a simple value, a dict,</span>
<span class="sd">            or a tuple of dicts. This should *not* be a BasePlotlyType object.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Child is compound array property</span>
        <span class="c1"># --------------------------------</span>
        <span class="n">child_prop_val</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">plotly_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">child_prop_val</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="n">child_ind</span> <span class="o">=</span> <span class="n">BaseFigure</span><span class="o">.</span><span class="n">_index_is</span><span class="p">(</span><span class="n">child_prop_val</span><span class="p">,</span> <span class="n">child</span><span class="p">)</span>
            <span class="n">obj_path</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{child_name}</span><span class="s2">.</span><span class="si">{child_ind}</span><span class="s2">.</span><span class="si">{prop}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">child_name</span><span class="o">=</span><span class="n">child</span><span class="o">.</span><span class="n">plotly_name</span><span class="p">,</span> <span class="n">child_ind</span><span class="o">=</span><span class="n">child_ind</span><span class="p">,</span> <span class="n">prop</span><span class="o">=</span><span class="n">prop_path_str</span>
            <span class="p">)</span>

        <span class="c1"># Child is compound property</span>
        <span class="c1"># --------------------------</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">obj_path</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{child_name}</span><span class="s2">.</span><span class="si">{prop}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">child_name</span><span class="o">=</span><span class="n">child</span><span class="o">.</span><span class="n">plotly_name</span><span class="p">,</span> <span class="n">prop</span><span class="o">=</span><span class="n">prop_path_str</span>
            <span class="p">)</span>

        <span class="c1"># Propagate to parent</span>
        <span class="c1"># -------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_send_prop_set</span><span class="p">(</span><span class="n">obj_path</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_restyle_child</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">child</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Propagate _restyle_child to parent</span>

<span class="sd">        Note: This method must match the name and signature of the</span>
<span class="sd">        corresponding method on BaseFigure</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_prop_set_child</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_relayout_child</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">child</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Propagate _relayout_child to parent</span>

<span class="sd">        Note: This method must match the name and signature of the</span>
<span class="sd">        corresponding method on BaseFigure</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_prop_set_child</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>

    <span class="c1"># Callbacks</span>
    <span class="c1"># ---------</span>
    <span class="k">def</span> <span class="nf">_dispatch_change_callbacks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">changed_paths</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Execute the appropriate change callback functions given a set of</span>
<span class="sd">        changed property path tuples</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        changed_paths : set[tuple[int|str]]</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Loop over registered callbacks</span>
        <span class="c1"># ------------------------------</span>
        <span class="k">for</span> <span class="n">prop_path_tuples</span><span class="p">,</span> <span class="n">callbacks</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_change_callbacks</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># ### Compute callback paths that changed ###</span>
            <span class="n">common_paths</span> <span class="o">=</span> <span class="n">changed_paths</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">prop_path_tuples</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">common_paths</span><span class="p">:</span>

                <span class="c1"># #### Invoke callback ####</span>
                <span class="n">callback_args</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="p">[</span><span class="n">cb_path</span><span class="p">]</span> <span class="k">for</span> <span class="n">cb_path</span> <span class="ow">in</span> <span class="n">prop_path_tuples</span><span class="p">]</span>

                <span class="k">for</span> <span class="n">callback</span> <span class="ow">in</span> <span class="n">callbacks</span><span class="p">:</span>
                    <span class="n">callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">callback_args</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">on_change</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">callback</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Register callback function to be called when certain properties or</span>
<span class="sd">        subproperties of this object are modified.</span>

<span class="sd">        Callback will be invoked whenever ANY of these properties is</span>
<span class="sd">        modified. Furthermore, the callback will only be invoked once even</span>
<span class="sd">        if multiple properties are modified during the same restyle /</span>
<span class="sd">        relayout / update operation.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        callback : function</span>
<span class="sd">            Function that accepts 1 + len(`args`) parameters. First parameter</span>
<span class="sd">            is this object. Second through last parameters are the</span>
<span class="sd">            property / subpropery values referenced by args.</span>
<span class="sd">        args : list[str|tuple[int|str]]</span>
<span class="sd">            List of property references where each reference may be one of:</span>

<span class="sd">              1) A property name string (e.g. &#39;foo&#39;) for direct properties</span>
<span class="sd">              2) A property path string (e.g. &#39;foo[0].bar&#39;) for</span>
<span class="sd">                 subproperties</span>
<span class="sd">              3) A property path tuple (e.g. (&#39;foo&#39;, 0, &#39;bar&#39;)) for</span>
<span class="sd">                 subproperties</span>

<span class="sd">        append : bool</span>
<span class="sd">            True if callback should be appended to previously registered</span>
<span class="sd">            callback on the same properties, False if callback should replace</span>
<span class="sd">            previously registered callbacks on the same properties. Defaults</span>
<span class="sd">            to False.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        Register callback that prints out the range extents of the xaxis and</span>
<span class="sd">        yaxis whenever either either of them changes.</span>

<span class="sd">        &gt;&gt;&gt; import plotly.graph_objects as go</span>
<span class="sd">        &gt;&gt;&gt; fig = go.Figure(go.Scatter(x=[1, 2], y=[1, 0]))</span>
<span class="sd">        &gt;&gt;&gt; fig.layout.on_change(</span>
<span class="sd">        ...   lambda obj, xrange, yrange: print(&quot;%s-%s&quot; % (xrange, yrange)),</span>
<span class="sd">        ...   (&#39;xaxis&#39;, &#39;range&#39;), (&#39;yaxis&#39;, &#39;range&#39;))</span>


<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Warn if object not descendent of a figure</span>
        <span class="c1"># -----------------------------------------</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="p">:</span>
            <span class="n">class_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="si">{class_name}</span><span class="s2"> object is not a descendant of a Figure.</span>
<span class="s2">on_change callbacks are not supported in this case.</span>
<span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">class_name</span><span class="o">=</span><span class="n">class_name</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="c1"># Validate args not empty</span>
        <span class="c1"># -----------------------</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;At least one change property must be specified&quot;</span><span class="p">)</span>

        <span class="c1"># Validate args</span>
        <span class="c1"># -------------</span>
        <span class="n">invalid_args</span> <span class="o">=</span> <span class="p">[</span><span class="n">arg</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span> <span class="k">if</span> <span class="n">arg</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">invalid_args</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid property specification(s): </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">invalid_args</span><span class="p">)</span>

        <span class="c1"># Process append option</span>
        <span class="c1"># ---------------------</span>
        <span class="n">append</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;append&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Normalize args to path tuples</span>
        <span class="c1"># -----------------------------</span>
        <span class="n">arg_tuples</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">BaseFigure</span><span class="o">.</span><span class="n">_str_to_dict_path</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">args</span><span class="p">])</span>

        <span class="c1"># Initialize callbacks list</span>
        <span class="c1"># -------------------------</span>
        <span class="c1"># Initialize an empty callbacks list if there are no previously</span>
        <span class="c1"># defined callbacks for this collection of args, or if append is False</span>
        <span class="k">if</span> <span class="n">arg_tuples</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_change_callbacks</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">append</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_change_callbacks</span><span class="p">[</span><span class="n">arg_tuples</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Register callback</span>
        <span class="c1"># -----------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_change_callbacks</span><span class="p">[</span><span class="n">arg_tuples</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">callback</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">to_plotly_json</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return plotly JSON representation of object as a Python dict</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_props</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_props</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">{})</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_vals_equal</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Recursive equality function that handles nested dicts / tuples / lists</span>
<span class="sd">        that contain numpy arrays.</span>

<span class="sd">        v1</span>
<span class="sd">            First value to compare</span>
<span class="sd">        v2</span>
<span class="sd">            Second value to compare</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            True if v1 and v2 are equal, False otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">np</span> <span class="o">=</span> <span class="n">get_module</span><span class="p">(</span><span class="s2">&quot;numpy&quot;</span><span class="p">,</span> <span class="n">should_load</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span>
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="c1"># Handle recursive equality on lists and tuples</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="nb">isinstance</span><span class="p">(</span><span class="n">v2</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">))</span>
                <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">v1</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">v2</span><span class="p">)</span>
                <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="n">BasePlotlyType</span><span class="o">.</span><span class="n">_vals_equal</span><span class="p">(</span><span class="n">e1</span><span class="p">,</span> <span class="n">e2</span><span class="p">)</span> <span class="k">for</span> <span class="n">e1</span><span class="p">,</span> <span class="n">e2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">))</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="c1"># Handle recursive equality on dicts</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="nb">isinstance</span><span class="p">(</span><span class="n">v2</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span>
                <span class="ow">and</span> <span class="nb">set</span><span class="p">(</span><span class="n">v1</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="n">v2</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="n">BasePlotlyType</span><span class="o">.</span><span class="n">_vals_equal</span><span class="p">(</span><span class="n">v1</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">v2</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">v1</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">v1</span> <span class="o">==</span> <span class="n">v2</span>


<span class="k">class</span> <span class="nc">BaseLayoutHierarchyType</span><span class="p">(</span><span class="n">BasePlotlyType</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for all types in the layout hierarchy</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_parent_path_str</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plotly_name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">BaseLayoutHierarchyType</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">plotly_name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_send_prop_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop_path_str</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">:</span>
            <span class="c1"># ### Inform parent of relayout operation ###</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">_relayout_child</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop_path_str</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">BaseLayoutType</span><span class="p">(</span><span class="n">BaseLayoutHierarchyType</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for the layout type. The Layout class itself is a</span>
<span class="sd">    code-generated subclass.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Dynamic properties</span>
    <span class="c1"># ------------------</span>
    <span class="c1"># Unlike all other plotly types, BaseLayoutType has dynamic properties.</span>
    <span class="c1"># These are used when a layout has multiple instances of subplot types</span>
    <span class="c1"># (xaxis2, yaxis3, geo4, etc.)</span>
    <span class="c1">#</span>
    <span class="c1"># The base version of each suplot type is defined in the schema and code</span>
    <span class="c1"># generated. So the Layout subclass has statically defined properties</span>
    <span class="c1"># for xaxis, yaxis, geo, ternary, and scene. But, we need to dynamically</span>
    <span class="c1"># generated properties/validators as needed for xaxis2, yaxis3, etc.</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_subplotid_validators</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        dict of validator classes for each subplot type</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_subplot_re_match</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plotly_name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Construct a new BaseLayoutType object</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        plotly_name : str</span>
<span class="sd">            Name of the object (should always be &#39;layout&#39;)</span>
<span class="sd">        kwargs : dict[str, any]</span>
<span class="sd">            Properties that were not recognized by the Layout subclass.</span>
<span class="sd">            These are subplot identifiers (xaxis2, geo4, etc.) or they are</span>
<span class="sd">            invalid properties.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Validate inputs</span>
        <span class="c1"># ---------------</span>
        <span class="k">assert</span> <span class="n">plotly_name</span> <span class="o">==</span> <span class="s2">&quot;layout&quot;</span>

        <span class="c1"># Call superclass constructor</span>
        <span class="c1"># ---------------------------</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">BaseLayoutHierarchyType</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">plotly_name</span><span class="p">)</span>

        <span class="c1"># Initialize _subplotid_props</span>
        <span class="c1"># ---------------------------</span>
        <span class="c1"># This is a set storing the names of the layout&#39;s dynamic subplot</span>
        <span class="c1"># properties</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_subplotid_props</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="c1"># Process kwargs</span>
        <span class="c1"># --------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_process_kwargs</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_process_kwargs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Process any extra kwargs that are not predefined as constructor params</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">unknown_kwargs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_subplot_re_match</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">BaseLayoutHierarchyType</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_process_kwargs</span><span class="p">(</span><span class="o">**</span><span class="n">unknown_kwargs</span><span class="p">)</span>

        <span class="n">subplot_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_subplot_re_match</span><span class="p">(</span><span class="n">k</span><span class="p">)}</span>

        <span class="k">for</span> <span class="n">prop</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">subplot_kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_subplotid_prop</span><span class="p">(</span><span class="n">prop</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_subplotid_prop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set a subplot property on the layout</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        prop : str</span>
<span class="sd">            A valid subplot property</span>
<span class="sd">        value</span>
<span class="sd">            Subplot value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Get regular expression match</span>
        <span class="c1"># ----------------------------</span>
        <span class="c1"># Note: we already tested that match exists in the constructor</span>
        <span class="n">match</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_subplot_re_match</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>
        <span class="n">subplot_prop</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">suffix_digit</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>

        <span class="c1"># Validate suffix digit</span>
        <span class="c1"># ---------------------</span>
        <span class="k">if</span> <span class="n">suffix_digit</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;Subplot properties may only be suffixed by an &quot;</span>
                <span class="s2">&quot;integer &gt;= 1</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;Received </span><span class="si">{k}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="n">prop</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="c1"># Handle suffix_digit == 1</span>
        <span class="c1"># ------------------------</span>
        <span class="c1"># In this case we remove suffix digit (e.g. xaxis1 -&gt; xaxis)</span>
        <span class="k">if</span> <span class="n">suffix_digit</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">prop</span> <span class="o">=</span> <span class="n">subplot_prop</span>

        <span class="c1"># Construct and add validator</span>
        <span class="c1"># ---------------------------</span>
        <span class="k">if</span> <span class="n">prop</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_props</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_valid_props</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>

        <span class="c1"># Import value</span>
        <span class="c1"># ------------</span>
        <span class="c1"># Use the standard _set_compound_prop method to</span>
        <span class="c1"># validate/coerce/import subplot value. This must be called AFTER</span>
        <span class="c1"># the validator instance is added to self._validators above.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_compound_prop</span><span class="p">(</span><span class="n">prop</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_subplotid_props</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_strip_subplot_suffix_of_1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Strip the suffix for subplot property names that have a suffix of 1.</span>
<span class="sd">        All other properties are returned unchanged</span>

<span class="sd">        e.g. &#39;xaxis1&#39; -&gt; &#39;xaxis&#39;</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        prop : str|tuple</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str|tuple</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Let parent handle non-scalar cases</span>
        <span class="c1"># ----------------------------------</span>
        <span class="c1"># e.g. (&#39;xaxis&#39;, &#39;range&#39;) or &#39;xaxis.range&#39;</span>
        <span class="n">prop_tuple</span> <span class="o">=</span> <span class="n">BaseFigure</span><span class="o">.</span><span class="n">_str_to_dict_path</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">prop_tuple</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">prop_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">string_types</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">prop</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Unwrap to scalar string</span>
            <span class="n">prop</span> <span class="o">=</span> <span class="n">prop_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Handle subplot suffix digit of 1</span>
        <span class="c1"># --------------------------------</span>
        <span class="c1"># Remove digit of 1 from subplot id (e.g.. xaxis1 -&gt; xaxis)</span>
        <span class="n">match</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_subplot_re_match</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
            <span class="n">subplot_prop</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">suffix_digit</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">subplot_prop</span> <span class="ow">and</span> <span class="n">suffix_digit</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">prop</span> <span class="o">=</span> <span class="n">subplot_prop</span>

        <span class="k">return</span> <span class="n">prop</span>

    <span class="k">def</span> <span class="nf">_get_prop_validator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Custom _get_prop_validator that handles subplot properties</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">prop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_strip_subplot_suffix_of_1</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">BaseLayoutHierarchyType</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_get_prop_validator</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Custom __getattr__ that handles dynamic subplot properties</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">prop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_strip_subplot_suffix_of_1</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">prop</span> <span class="o">!=</span> <span class="s2">&quot;_subplotid_props&quot;</span> <span class="ow">and</span> <span class="n">prop</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_subplotid_props</span><span class="p">:</span>
            <span class="n">validator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_validator</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">validator</span><span class="o">.</span><span class="n">present</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_compound_props</span><span class="p">[</span><span class="n">prop</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">BaseLayoutHierarchyType</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Custom __getitem__ that handles dynamic subplot properties</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">prop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_strip_subplot_suffix_of_1</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">BaseLayoutHierarchyType</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Custom __contains__ that handles dynamic subplot properties</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">prop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_strip_subplot_suffix_of_1</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">BaseLayoutHierarchyType</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__contains__</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Custom __setitem__ that handles dynamic subplot properties</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Convert prop to prop tuple</span>
        <span class="c1"># --------------------------</span>
        <span class="n">prop_tuple</span> <span class="o">=</span> <span class="n">BaseFigure</span><span class="o">.</span><span class="n">_str_to_dict_path</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">prop_tuple</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">prop_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">string_types</span><span class="p">):</span>
            <span class="c1"># Let parent handle non-scalar non-string cases</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">BaseLayoutHierarchyType</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="n">prop</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Unwrap prop tuple</span>
            <span class="n">prop</span> <span class="o">=</span> <span class="n">prop_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Check for subplot assignment</span>
        <span class="c1"># ----------------------------</span>
        <span class="n">match</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_subplot_re_match</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Set as ordinary property</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">BaseLayoutHierarchyType</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="n">prop</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Set as subplotid property</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_subplotid_prop</span><span class="p">(</span><span class="n">prop</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Custom __setattr__ that handles dynamic subplot properties</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Check for subplot assignment</span>
        <span class="c1"># ----------------------------</span>
        <span class="n">match</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_subplot_re_match</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Set as ordinary property</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">BaseLayoutHierarchyType</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">prop</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Set as subplotid property</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_subplotid_prop</span><span class="p">(</span><span class="n">prop</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__dir__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Custom __dir__ that handles dynamic subplot properties</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Include any active subplot values</span>
        <span class="k">if</span> <span class="n">six</span><span class="o">.</span><span class="n">PY2</span><span class="p">:</span>

            <span class="k">def</span> <span class="nf">get_attrs</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
                <span class="kn">import</span> <span class="nn">types</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s2">&quot;__dict__&quot;</span><span class="p">):</span>
                    <span class="k">return</span> <span class="p">[]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">,</span> <span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">DictProxyType</span><span class="p">)):</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.__dict__ is not a dictionary&quot;</span> <span class="s2">&quot;&quot;</span> <span class="o">%</span> <span class="n">obj</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

            <span class="k">def</span> <span class="nf">dir2</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
                <span class="n">attrs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s2">&quot;__bases__&quot;</span><span class="p">):</span>
                    <span class="c1"># obj is an instance</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s2">&quot;__class__&quot;</span><span class="p">):</span>
                        <span class="c1"># slots</span>
                        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">get_attrs</span><span class="p">(</span><span class="n">obj</span><span class="p">))</span>
                    <span class="n">klass</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="vm">__class__</span>
                    <span class="n">attrs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">get_attrs</span><span class="p">(</span><span class="n">klass</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># obj is a class</span>
                    <span class="n">klass</span> <span class="o">=</span> <span class="n">obj</span>

                <span class="k">for</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="n">klass</span><span class="o">.</span><span class="vm">__bases__</span><span class="p">:</span>
                    <span class="n">attrs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">get_attrs</span><span class="p">(</span><span class="bp">cls</span><span class="p">))</span>
                    <span class="n">attrs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">dir2</span><span class="p">(</span><span class="bp">cls</span><span class="p">))</span>
                <span class="n">attrs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">get_attrs</span><span class="p">(</span><span class="n">obj</span><span class="p">))</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">attrs</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">dir2</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">+</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_subplotid_props</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>

            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">super</span><span class="p">(</span><span class="n">BaseLayoutHierarchyType</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__dir__</span><span class="p">())</span> <span class="o">+</span> <span class="nb">sorted</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_subplotid_props</span>
            <span class="p">)</span>


<span class="k">class</span> <span class="nc">BaseTraceHierarchyType</span><span class="p">(</span><span class="n">BasePlotlyType</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for all types in the trace hierarchy</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plotly_name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">BaseTraceHierarchyType</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">plotly_name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_send_prop_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop_path_str</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">:</span>
            <span class="c1"># ### Inform parent of restyle operation ###</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">_restyle_child</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop_path_str</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">BaseTraceType</span><span class="p">(</span><span class="n">BaseTraceHierarchyType</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for the all trace types.</span>

<span class="sd">    Specific trace type classes (Scatter, Bar, etc.) are code generated as</span>
<span class="sd">    subclasses of this class.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plotly_name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">BaseTraceHierarchyType</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">plotly_name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># Initialize callback function lists</span>
        <span class="c1"># ----------------------------------</span>
        <span class="c1"># ### Callbacks to be called on hover ###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hover_callbacks</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># ### Callbacks to be called on unhover ###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_unhover_callbacks</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># ### Callbacks to be called on click ###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_click_callbacks</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># ### Callbacks to be called on selection ###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_select_callbacks</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># ### Callbacks to be called on deselect ###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_deselect_callbacks</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># ### Trace index in figure ###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_trace_ind</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># uid</span>
    <span class="c1"># ---</span>
    <span class="c1"># All trace types must have a top-level UID</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">uid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="nd">@uid</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">uid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="c1"># Hover</span>
    <span class="c1"># -----</span>
    <span class="k">def</span> <span class="nf">on_hover</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">callback</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Register function to be called when the user hovers over one or more</span>
<span class="sd">        points in this trace</span>

<span class="sd">        Note: Callbacks will only be triggered when the trace belongs to a</span>
<span class="sd">        instance of plotly.graph_objs.FigureWidget and it is displayed in an</span>
<span class="sd">        ipywidget context. Callbacks will not be triggered on figures</span>
<span class="sd">        that are displayed using plot/iplot.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        callback</span>
<span class="sd">            Callable function that accepts 3 arguments</span>

<span class="sd">            - this trace</span>
<span class="sd">            - plotly.callbacks.Points object</span>
<span class="sd">            - plotly.callbacks.InputDeviceState object</span>

<span class="sd">        append : bool</span>
<span class="sd">            If False (the default), this callback replaces any previously</span>
<span class="sd">            defined on_hover callbacks for this trace. If True,</span>
<span class="sd">            this callback is appended to the list of any previously defined</span>
<span class="sd">            callbacks.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; import plotly.graph_objects as go</span>
<span class="sd">        &gt;&gt;&gt; from plotly.callbacks import Points, InputDeviceState</span>
<span class="sd">        &gt;&gt;&gt; points, state = Points(), InputDeviceState()</span>

<span class="sd">        &gt;&gt;&gt; def hover_fn(trace, points, state):</span>
<span class="sd">        ...     inds = points.point_inds</span>
<span class="sd">        ...     # Do something</span>

<span class="sd">        &gt;&gt;&gt; trace = go.Scatter(x=[1, 2], y=[3, 0])</span>
<span class="sd">        &gt;&gt;&gt; trace.on_hover(hover_fn)</span>

<span class="sd">        Note: The creation of the `points` and `state` objects is optional,</span>
<span class="sd">        it&#39;s simply a convenience to help the text editor perform completion</span>
<span class="sd">        on the arguments inside `hover_fn`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">append</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hover_callbacks</span><span class="p">[:]</span>

        <span class="k">if</span> <span class="n">callback</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_hover_callbacks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">callback</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_dispatch_on_hover</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">points</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dispatch points and device state all all hover callbacks</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">callback</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hover_callbacks</span><span class="p">:</span>
            <span class="n">callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">points</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>

    <span class="c1"># Unhover</span>
    <span class="c1"># -------</span>
    <span class="k">def</span> <span class="nf">on_unhover</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">callback</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Register function to be called when the user unhovers away from one</span>
<span class="sd">        or more points in this trace.</span>

<span class="sd">        Note: Callbacks will only be triggered when the trace belongs to a</span>
<span class="sd">        instance of plotly.graph_objs.FigureWidget and it is displayed in an</span>
<span class="sd">        ipywidget context. Callbacks will not be triggered on figures</span>
<span class="sd">        that are displayed using plot/iplot.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        callback</span>
<span class="sd">            Callable function that accepts 3 arguments</span>

<span class="sd">            - this trace</span>
<span class="sd">            - plotly.callbacks.Points object</span>
<span class="sd">            - plotly.callbacks.InputDeviceState object</span>

<span class="sd">        append : bool</span>
<span class="sd">            If False (the default), this callback replaces any previously</span>
<span class="sd">            defined on_unhover callbacks for this trace. If True,</span>
<span class="sd">            this callback is appended to the list of any previously defined</span>
<span class="sd">            callbacks.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; import plotly.graph_objects as go</span>
<span class="sd">        &gt;&gt;&gt; from plotly.callbacks import Points, InputDeviceState</span>
<span class="sd">        &gt;&gt;&gt; points, state = Points(), InputDeviceState()</span>

<span class="sd">        &gt;&gt;&gt; def unhover_fn(trace, points, state):</span>
<span class="sd">        ...     inds = points.point_inds</span>
<span class="sd">        ...     # Do something</span>

<span class="sd">        &gt;&gt;&gt; trace = go.Scatter(x=[1, 2], y=[3, 0])</span>
<span class="sd">        &gt;&gt;&gt; trace.on_unhover(unhover_fn)</span>

<span class="sd">        Note: The creation of the `points` and `state` objects is optional,</span>
<span class="sd">        it&#39;s simply a convenience to help the text editor perform completion</span>
<span class="sd">        on the arguments inside `unhover_fn`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">append</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unhover_callbacks</span><span class="p">[:]</span>

        <span class="k">if</span> <span class="n">callback</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_unhover_callbacks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">callback</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_dispatch_on_unhover</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">points</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dispatch points and device state all all hover callbacks</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">callback</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unhover_callbacks</span><span class="p">:</span>
            <span class="n">callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">points</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>

    <span class="c1"># Click</span>
    <span class="c1"># -----</span>
    <span class="k">def</span> <span class="nf">on_click</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">callback</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Register function to be called when the user clicks on one or more</span>
<span class="sd">        points in this trace.</span>

<span class="sd">        Note: Callbacks will only be triggered when the trace belongs to a</span>
<span class="sd">        instance of plotly.graph_objs.FigureWidget and it is displayed in an</span>
<span class="sd">        ipywidget context. Callbacks will not be triggered on figures</span>
<span class="sd">        that are displayed using plot/iplot.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        callback</span>
<span class="sd">            Callable function that accepts 3 arguments</span>

<span class="sd">            - this trace</span>
<span class="sd">            - plotly.callbacks.Points object</span>
<span class="sd">            - plotly.callbacks.InputDeviceState object</span>

<span class="sd">        append : bool</span>
<span class="sd">            If False (the default), this callback replaces any previously</span>
<span class="sd">            defined on_click callbacks for this trace. If True,</span>
<span class="sd">            this callback is appended to the list of any previously defined</span>
<span class="sd">            callbacks.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; import plotly.graph_objects as go</span>
<span class="sd">        &gt;&gt;&gt; from plotly.callbacks import Points, InputDeviceState</span>
<span class="sd">        &gt;&gt;&gt; points, state = Points(), InputDeviceState()</span>

<span class="sd">        &gt;&gt;&gt; def click_fn(trace, points, state):</span>
<span class="sd">        ...     inds = points.point_inds</span>
<span class="sd">        ...     # Do something</span>

<span class="sd">        &gt;&gt;&gt; trace = go.Scatter(x=[1, 2], y=[3, 0])</span>
<span class="sd">        &gt;&gt;&gt; trace.on_click(click_fn)</span>

<span class="sd">        Note: The creation of the `points` and `state` objects is optional,</span>
<span class="sd">        it&#39;s simply a convenience to help the text editor perform completion</span>
<span class="sd">        on the arguments inside `click_fn`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">append</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_click_callbacks</span><span class="p">[:]</span>
        <span class="k">if</span> <span class="n">callback</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_click_callbacks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">callback</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_dispatch_on_click</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">points</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dispatch points and device state all all hover callbacks</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">callback</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_click_callbacks</span><span class="p">:</span>
            <span class="n">callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">points</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>

    <span class="c1"># Select</span>
    <span class="c1"># ------</span>
    <span class="k">def</span> <span class="nf">on_selection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">callback</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Register function to be called when the user selects one or more</span>
<span class="sd">        points in this trace.</span>

<span class="sd">        Note: Callbacks will only be triggered when the trace belongs to a</span>
<span class="sd">        instance of plotly.graph_objs.FigureWidget and it is displayed in an</span>
<span class="sd">        ipywidget context. Callbacks will not be triggered on figures</span>
<span class="sd">        that are displayed using plot/iplot.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        callback</span>
<span class="sd">            Callable function that accepts 4 arguments</span>

<span class="sd">            - this trace</span>
<span class="sd">            - plotly.callbacks.Points object</span>
<span class="sd">            - plotly.callbacks.BoxSelector or plotly.callbacks.LassoSelector</span>

<span class="sd">        append : bool</span>
<span class="sd">            If False (the default), this callback replaces any previously</span>
<span class="sd">            defined on_selection callbacks for this trace. If True,</span>
<span class="sd">            this callback is appended to the list of any previously defined</span>
<span class="sd">            callbacks.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; import plotly.graph_objects as go</span>
<span class="sd">        &gt;&gt;&gt; from plotly.callbacks import Points</span>
<span class="sd">        &gt;&gt;&gt; points = Points()</span>

<span class="sd">        &gt;&gt;&gt; def selection_fn(trace, points, selector):</span>
<span class="sd">        ...     inds = points.point_inds</span>
<span class="sd">        ...     # Do something</span>

<span class="sd">        &gt;&gt;&gt; trace = go.Scatter(x=[1, 2], y=[3, 0])</span>
<span class="sd">        &gt;&gt;&gt; trace.on_selection(selection_fn)</span>

<span class="sd">        Note: The creation of the `points` object is optional,</span>
<span class="sd">        it&#39;s simply a convenience to help the text editor perform completion</span>
<span class="sd">        on the `points` arguments inside `selection_fn`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">append</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_select_callbacks</span><span class="p">[:]</span>

        <span class="k">if</span> <span class="n">callback</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_select_callbacks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">callback</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_dispatch_on_selection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">points</span><span class="p">,</span> <span class="n">selector</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dispatch points and selector info to selection callbacks</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;selectedpoints&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="c1"># Update the selectedpoints property, which will notify all views</span>
            <span class="c1"># of the selection change.  This is a special case because no</span>
            <span class="c1"># restyle event is emitted by plotly.js on selection events</span>
            <span class="c1"># even though these events update the selectedpoints property.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selectedpoints</span> <span class="o">=</span> <span class="n">points</span><span class="o">.</span><span class="n">point_inds</span>

        <span class="k">for</span> <span class="n">callback</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_select_callbacks</span><span class="p">:</span>
            <span class="n">callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">points</span><span class="p">,</span> <span class="n">selector</span><span class="p">)</span>

    <span class="c1"># deselect</span>
    <span class="c1"># --------</span>
    <span class="k">def</span> <span class="nf">on_deselect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">callback</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Register function to be called when the user deselects points</span>
<span class="sd">        in this trace using doubleclick.</span>

<span class="sd">        Note: Callbacks will only be triggered when the trace belongs to a</span>
<span class="sd">        instance of plotly.graph_objs.FigureWidget and it is displayed in an</span>
<span class="sd">        ipywidget context. Callbacks will not be triggered on figures</span>
<span class="sd">        that are displayed using plot/iplot.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        callback</span>
<span class="sd">            Callable function that accepts 3 arguments</span>

<span class="sd">            - this trace</span>
<span class="sd">            - plotly.callbacks.Points object</span>

<span class="sd">        append : bool</span>
<span class="sd">            If False (the default), this callback replaces any previously</span>
<span class="sd">            defined on_deselect callbacks for this trace. If True,</span>
<span class="sd">            this callback is appended to the list of any previously defined</span>
<span class="sd">            callbacks.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; import plotly.graph_objects as go</span>
<span class="sd">        &gt;&gt;&gt; from plotly.callbacks import Points</span>
<span class="sd">        &gt;&gt;&gt; points = Points()</span>

<span class="sd">        &gt;&gt;&gt; def deselect_fn(trace, points):</span>
<span class="sd">        ...     inds = points.point_inds</span>
<span class="sd">        ...     # Do something</span>

<span class="sd">        &gt;&gt;&gt; trace = go.Scatter(x=[1, 2], y=[3, 0])</span>
<span class="sd">        &gt;&gt;&gt; trace.on_deselect(deselect_fn)</span>

<span class="sd">        Note: The creation of the `points` object is optional,</span>
<span class="sd">        it&#39;s simply a convenience to help the text editor perform completion</span>
<span class="sd">        on the `points` arguments inside `selection_fn`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">append</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deselect_callbacks</span><span class="p">[:]</span>

        <span class="k">if</span> <span class="n">callback</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_deselect_callbacks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">callback</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_dispatch_on_deselect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">points</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dispatch points info to deselection callbacks</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;selectedpoints&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="c1"># Update the selectedpoints property, which will notify all views</span>
            <span class="c1"># of the selection change.  This is a special case because no</span>
            <span class="c1"># restyle event is emitted by plotly.js on selection events</span>
            <span class="c1"># even though these events update the selectedpoints property.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selectedpoints</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">for</span> <span class="n">callback</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deselect_callbacks</span><span class="p">:</span>
            <span class="n">callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">points</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">BaseFrameHierarchyType</span><span class="p">(</span><span class="n">BasePlotlyType</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for all types in the trace hierarchy</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plotly_name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">BaseFrameHierarchyType</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">plotly_name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_send_prop_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop_path_str</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="c1"># Note: Frames are not supported by FigureWidget, and updates are not</span>
        <span class="c1"># propagated to parents</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">_restyle_child</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">child</span><span class="p">,</span> <span class="n">key_path_str</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="c1"># Note: Frames are not supported by FigureWidget, and updates are not</span>
        <span class="c1"># propagated to parents</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">on_change</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">callback</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Change callbacks are not supported on Frames&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_child_props</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">child</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the properties dict for a child trace or child layout</span>

<span class="sd">        Note: this method must match the name/signature of one on</span>
<span class="sd">        BasePlotlyType</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        child : BaseTraceType | BaseLayoutType</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Try to find index of child as a trace</span>
        <span class="c1"># -------------------------------------</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">trace_index</span> <span class="o">=</span> <span class="n">BaseFigure</span><span class="o">.</span><span class="n">_index_is</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">child</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">_</span><span class="p">:</span>
            <span class="n">trace_index</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Child is a trace</span>
        <span class="c1"># ----------------</span>
        <span class="k">if</span> <span class="n">trace_index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;data&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_props</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_props</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="n">trace_index</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># Child is the layout</span>
        <span class="c1"># -------------------</span>
        <span class="k">elif</span> <span class="n">child</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_props</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;layout&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="c1"># Unknown child</span>
        <span class="c1"># -------------</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unrecognized child: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">child</span><span class="p">)</span>
</pre></div>

              </div>
              
              
              <div class='prev-next-bottom'>
                

              </div>
              
          </main>
          

      </div>
    </div>

    
  <script src="../../_static/js/index.30270b6e4c972e43c488.js"></script>


    <footer class="footer mt-5 mt-md-0">
  <div class="container">
    <p>
          &copy; Copyright 2020, Kaleidoscope Team.<br/>
        Last updated on 2020/10/08.<br/>
        Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.2.1.<br/>
    </p>
  </div>
</footer>
  </body>
</html>